# S25016 지출결의서 데이터베이스 스키마

## 📋 개요
- **데이터베이스명**: S25016 지출결의서
- **목적**: 출장신청서와 연동된 지출결의 관리
- **저장소**: Notion
- **연동**: S25016 출장신청서 (Relation)

---

## 🗂️ 필드 정의

### 1. 기본 정보

| 필드명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| **제목** | Title | ✅ | 지출결의서 제목 | "SPS24110 삼성중공업 12월 출장 지결" |
| **출장신청서** | Relation | ✅ | 출장신청서 DB 연결 | → S25016 출장신청서 |
| **문서번호** | Text | ✅ | 자동생성 문서번호 | "에스피시스템스-개발팀-20260106-003" |
| **신청번호** | Text | | 지결 신청번호 (자동) | "EXP-2026-001" |
| **기안일** | Date | ✅ | 기안 작성일 | 2026-01-15 |
| **기안자** | Select | ✅ | 작성자 | 심태양, 이광재, ... |
| **상태** | Select | ✅ | 결재 상태 | 작성중, 제출, 승인, 반려 |

**상태 옵션**:
- 🟡 작성중 (기본값)
- 🔵 제출
- 🟢 승인
- 🔴 반려

---

### 2. 지출 합계

| 필드명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| **총교통비** | Number | ✅ | 톨비 합계 (원) | 107,800 |
| **총유류비** | Number | ✅ | 유류비 합계 (원) | 174,000 |
| **총출장비** | Number | ✅ | 출장비 합계 (원) | 317,500 |
| **총식대** | Number | ✅ | 식비 합계 (원) | 645,000 |
| **총합계** | Formula | | 자동 계산 | 1,244,300 |

**Formula (총합계)**:
```
prop("총교통비") + prop("총유류비") + prop("총출장비") + prop("총식대")
```

---

### 3. 일별 지출 내역

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| **지출내역** | Long Text | ✅ | 일별 지출 JSON 또는 마크다운 테이블 |

**지출내역 JSON 형식**:
```json
[
  {
    "date": "2025-12-01",
    "toll": 11800,
    "fuel": 17000,
    "fuelDistance": 94.5,
    "allowance": 15000,
    "meal": 30000,
    "note": "양산 ↔ 거제, 톨비"
  },
  {
    "date": "2025-12-02",
    "toll": 0,
    "fuel": 0,
    "fuelDistance": 0,
    "allowance": 15000,
    "meal": 30000,
    "note": "출장비, 출장식대"
  }
]
```

**지출내역 마크다운 테이블 형식** (선택):
```markdown
| 날짜 | 교통비 | 유류비 | 거리(km) | 출장비 | 식대 | 비고 |
|------|--------|--------|----------|--------|------|------|
| 12/01 | 11,800 | 17,000 | 94.5 | 15,000 | 30,000 | 양산↔거제 |
| 12/02 | 0 | 0 | 0 | 15,000 | 30,000 | 출장비, 식대 |
```

---

### 4. 유류비 계산 정보

| 필드명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| **유류단가** | Number | ✅ | 전월 경유 평균단가 (원/리터) | 1,619.10 |
| **연비** | Number | | 차량 연비 (km/리터) | 9.0 |
| **유류단가출처** | Text | | 출처 URL 또는 메모 | "오피넷 전국 평균" |

**유류비 계산식**:
```
유류비 = (주행거리 km × 유류단가) ÷ 연비
예시: (94.5 × 1,619.10) ÷ 9 = 17,000원
```

---

### 5. 첨부 및 비고

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| **영수증첨부** | Files & media | | Cloudinary URL 또는 Notion 파일 |
| **비고** | Long Text | | 특이사항, 참고사항 |

---

### 6. 회계 정보

| 필드명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| **전표번호** | Text | | 회계 전표번호 | "20251229-0011" |
| **전표유형** | Select | | 전표 구분 | 일반분개전표 |
| **기표일자** | Date | | 회계 기표일 | 2025-12-29 |
| **계정과목** | Text | | 회계 과목 | "(제)여비교통비(기계설비공사)" |
| **코스트센터** | Text | | 프로젝트 코드 | "SPS24110 삼성중공업" |

---

## 📊 데이터베이스 뷰 (Views)

### 기본 뷰: 전체 목록
- 정렬: 기안일 내림차순
- 필터: 없음
- 표시: 제목, 출장신청서, 기안일, 기안자, 상태, 총합계

### 상태별 뷰
1. **작성중**: 상태 = 작성중
2. **제출됨**: 상태 = 제출
3. **승인완료**: 상태 = 승인
4. **반려됨**: 상태 = 반려

### 월별 뷰
- 그룹: 기안일 (월별)
- 정렬: 기안일 내림차순

---

## 🔗 Relation 설정

### 출장신청서 → 지출결의서 (1:N)
- **출장신청서 DB**에 "지출결의서" Relation 필드 추가
- 양방향 연결
- 한 출장신청서에 여러 지결 가능 (예: 선급, 정산)

---

## 🎨 생성 후 확인 사항

1. ✅ 데이터베이스 ID 복사 (Notion URL에서 확인)
2. ✅ Vercel 환경변수 추가: `NOTION_EXPENSE_DATABASE_ID`
3. ✅ 출장신청서 DB에 Relation 필드 추가
4. ✅ 테스트 데이터 1건 생성 (12월 지결)

---

## 📝 Notion 생성 가이드

1. Notion에서 "새 데이터베이스" 생성
2. 이름: "S25016 지출결의서"
3. 위 필드를 순서대로 추가:
   - 제목 (Title) - 자동 생성됨
   - 출장신청서 (Relation) - "S25016 출장신청서" 선택
   - 문서번호 (Text)
   - 신청번호 (Text)
   - ... (나머지 필드)
4. Formula 필드 설정:
   - 총합계 = `prop("총교통비") + prop("총유류비") + prop("총출장비") + prop("총식대")`
5. Select 필드 옵션 추가:
   - 상태: 작성중(노랑), 제출(파랑), 승인(초록), 반려(빨강)
   - 기안자: 심태양, 이광재, 김나래, 변재태 등
   - 전표유형: 일반분개전표 등

---

## 🚀 다음 단계

스키마 검토 완료 후:
1. Notion에서 데이터베이스 생성
2. Database ID 공유
3. UI 개발 시작 (지결 작성 페이지)
