<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API ì—°ê²° í…ŒìŠ¤íŠ¸ - ê·¼ë¬´ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .test-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .test-btn:hover {
            opacity: 0.9;
        }

        .result {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .result.error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .result.info {
            border-color: #17a2b8;
            background: #d1ecf1;
            color: #0c5460;
        }

        .url-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
        }

        .url-box label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .url-box input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .checklist {
            list-style: none;
            margin-top: 15px;
        }

        .checklist li {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #e0e0e0;
        }

        .checklist li.ok {
            border-left-color: #28a745;
        }

        .checklist li.fail {
            border-left-color: #dc3545;
        }

        .back-link {
            text-align: center;
            margin-top: 30px;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” API ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">Google Sheets ë™ê¸°í™” ë¬¸ì œë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤</p>

        <!-- 1. URL í™•ì¸ -->
        <div class="section">
            <h2>1ï¸âƒ£ Google Apps Script URL í™•ì¸</h2>
            <div class="url-box">
                <label>í˜„ì¬ ì„¤ì •ëœ URL:</label>
                <input type="text" id="scriptUrl" value="https://script.google.com/macros/s/AKfycbygAg88Vk2cJwhkDUJQPn2OO18J9IhzvF0l85otx4khWGh8y4XxAJhpQlOZnVvATxQ/exec" readonly>
            </div>
            <button class="test-btn" onclick="testUrlAccess()">URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
            <div id="urlResult"></div>
        </div>

        <!-- 2. ì¸ì› ëª©ë¡ ë¡œë“œ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2>2ï¸âƒ£ ì¸ì› ëª©ë¡ ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
            <button class="test-btn" onclick="testGetEmployees()">ì¸ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
            <button class="test-btn" onclick="clearCache('employees')">ìºì‹œ ì‚­ì œ</button>
            <div id="employeesResult"></div>
        </div>

        <!-- 3. ì¥ì†Œ ëª©ë¡ ë¡œë“œ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2>3ï¸âƒ£ ì¥ì†Œ ëª©ë¡ ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
            <button class="test-btn" onclick="testGetLocations()">ì¥ì†Œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
            <button class="test-btn" onclick="clearCache('locations')">ìºì‹œ ì‚­ì œ</button>
            <div id="locationsResult"></div>
        </div>

        <!-- 4. LocalStorage í™•ì¸ -->
        <div class="section">
            <h2>4ï¸âƒ£ ë¸Œë¼ìš°ì € ìºì‹œ (LocalStorage) í™•ì¸</h2>
            <button class="test-btn" onclick="checkLocalStorage()">ìºì‹œ í™•ì¸</button>
            <button class="test-btn" onclick="clearAllCache()">ëª¨ë“  ìºì‹œ ì‚­ì œ</button>
            <div id="storageResult"></div>
        </div>

        <!-- 5. ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <div class="section">
            <h2>5ï¸âƒ£ ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
            <ul class="checklist" id="checklist">
                <li>â³ Google Apps Script ì½”ë“œ ì—…ë°ì´íŠ¸ ì—¬ë¶€</li>
                <li>â³ ì›¹ ì•± ì¬ë°°í¬ ì—¬ë¶€</li>
                <li>â³ "ì¸ì›ëª©ë¡", "ì¥ì†Œëª©ë¡" ì‹œíŠ¸ ì¡´ì¬ ì—¬ë¶€</li>
                <li>â³ ì›¹ ì•± ì•¡ì„¸ìŠ¤ ê¶Œí•œ ì„¤ì • (ëª¨ë“  ì‚¬ìš©ì)</li>
            </ul>
            <button class="test-btn" onclick="runFullDiagnostic()">ì „ì²´ ì§„ë‹¨ ì‹¤í–‰</button>
        </div>

        <div class="back-link">
            <a href="../pages/input.html">â† ì…ë ¥ í˜ì´ì§€ë¡œ</a> |
            <a href="/index.html">ëŒ€ì‹œë³´ë“œë¡œ</a>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbygAg88Vk2cJwhkDUJQPn2OO18J9IhzvF0l85otx4khWGh8y4XxAJhpQlOZnVvATxQ/exec';
        const DEFAULT_EMPLOYEES = ['ì‹¬íƒœì–‘', 'ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜'];
        const DEFAULT_LOCATIONS = ['34bay Aë¼ì¸', '34bay Bë¼ì¸', '35bay Aë¼ì¸', '35bay Bë¼ì¸', 'ì‚¬ë¬´ì‹¤', 'íšŒì˜ì‹¤'];

        // URL ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        async function testUrlAccess() {
            const resultDiv = document.getElementById('urlResult');
            resultDiv.innerHTML = '<div class="result info">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                const response = await fetch(SCRIPT_URL);
                const text = await response.text();

                resultDiv.innerHTML = `<div class="result success">
âœ… URL ì ‘ê·¼ ì„±ê³µ!

ì‘ë‹µ ë‚´ìš©:
${text}

ìƒíƒœ ì½”ë“œ: ${response.status}
</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
âŒ URL ì ‘ê·¼ ì‹¤íŒ¨!

ì—ëŸ¬ ë©”ì‹œì§€:
${error.message}

ê°€ëŠ¥í•œ ì›ì¸:
1. ì›¹ ì•±ì´ ë°°í¬ë˜ì§€ ì•ŠìŒ
2. URLì´ ì˜ëª»ë¨
3. ì•¡ì„¸ìŠ¤ ê¶Œí•œ ì„¤ì • ë¬¸ì œ
</div>`;
            }
        }

        // ì¸ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸
        async function testGetEmployees() {
            const resultDiv = document.getElementById('employeesResult');
            resultDiv.innerHTML = '<div class="result info">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                const response = await fetch(`${SCRIPT_URL}?action=getEmployees`);
                const data = await response.json();

                if (data.error) {
                    resultDiv.innerHTML = `<div class="result error">
âš ï¸ API ì—ëŸ¬ ë°œìƒ

ì—ëŸ¬: ${data.error}

Fallback ë°ì´í„° ì‚¬ìš©:
${JSON.stringify(data.fallback, null, 2)}
</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result success">
âœ… ì¸ì› ëª©ë¡ ë¡œë“œ ì„±ê³µ!

ì´ ${data.length}ëª…:
${JSON.stringify(data, null, 2)}

LocalStorageì— ìºì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
</div>`;
                    // ìºì‹œì— ì €ì¥
                    localStorage.setItem('workManagement_employees', JSON.stringify(data));
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
âŒ ì¸ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨!

ì—ëŸ¬: ${error.message}

LocalStorage ìºì‹œ í™•ì¸:
${localStorage.getItem('workManagement_employees') || 'ì—†ìŒ'}

ê¸°ë³¸ê°’ ì‚¬ìš©:
${JSON.stringify(DEFAULT_EMPLOYEES, null, 2)}
</div>`;
            }
        }

        // ì¥ì†Œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸
        async function testGetLocations() {
            const resultDiv = document.getElementById('locationsResult');
            resultDiv.innerHTML = '<div class="result info">í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

            try {
                const response = await fetch(`${SCRIPT_URL}?action=getLocations`);
                const data = await response.json();

                if (data.error) {
                    resultDiv.innerHTML = `<div class="result error">
âš ï¸ API ì—ëŸ¬ ë°œìƒ

ì—ëŸ¬: ${data.error}

Fallback ë°ì´í„° ì‚¬ìš©:
${JSON.stringify(data.fallback, null, 2)}
</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result success">
âœ… ì¥ì†Œ ëª©ë¡ ë¡œë“œ ì„±ê³µ!

ì´ ${data.length}ê°œ:
${JSON.stringify(data, null, 2)}

LocalStorageì— ìºì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
</div>`;
                    // ìºì‹œì— ì €ì¥
                    localStorage.setItem('workManagement_locations', JSON.stringify(data));
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
âŒ ì¥ì†Œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨!

ì—ëŸ¬: ${error.message}

LocalStorage ìºì‹œ í™•ì¸:
${localStorage.getItem('workManagement_locations') || 'ì—†ìŒ'}

ê¸°ë³¸ê°’ ì‚¬ìš©:
${JSON.stringify(DEFAULT_LOCATIONS, null, 2)}
</div>`;
            }
        }

        // LocalStorage í™•ì¸
        function checkLocalStorage() {
            const resultDiv = document.getElementById('storageResult');

            const employees = localStorage.getItem('workManagement_employees');
            const locations = localStorage.getItem('workManagement_locations');

            resultDiv.innerHTML = `<div class="result info">
ğŸ“¦ LocalStorage ìºì‹œ ë‚´ìš©

ì¸ì› ëª©ë¡ (workManagement_employees):
${employees || 'âŒ ìºì‹œ ì—†ìŒ'}

ì¥ì†Œ ëª©ë¡ (workManagement_locations):
${locations || 'âŒ ìºì‹œ ì—†ìŒ'}

ìºì‹œ ìƒíƒœ:
${employees && locations ? 'âœ… ì •ìƒ' : 'âš ï¸ ìºì‹œê°€ ì—†ê±°ë‚˜ ë¶ˆì™„ì „í•©ë‹ˆë‹¤'}
</div>`;
        }

        // íŠ¹ì • ìºì‹œ ì‚­ì œ
        function clearCache(type) {
            if (type === 'employees') {
                localStorage.removeItem('workManagement_employees');
                alert('âœ… ì¸ì› ëª©ë¡ ìºì‹œ ì‚­ì œ ì™„ë£Œ');
            } else if (type === 'locations') {
                localStorage.removeItem('workManagement_locations');
                alert('âœ… ì¥ì†Œ ëª©ë¡ ìºì‹œ ì‚­ì œ ì™„ë£Œ');
            }
            checkLocalStorage();
        }

        // ëª¨ë“  ìºì‹œ ì‚­ì œ
        function clearAllCache() {
            if (confirm('ëª¨ë“  ìºì‹œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('workManagement_employees');
                localStorage.removeItem('workManagement_locations');
                alert('âœ… ëª¨ë“  ìºì‹œ ì‚­ì œ ì™„ë£Œ');
                checkLocalStorage();
            }
        }

        // ì „ì²´ ì§„ë‹¨
        async function runFullDiagnostic() {
            console.log('=== ì „ì²´ ì§„ë‹¨ ì‹œì‘ ===');

            // 1. URL í…ŒìŠ¤íŠ¸
            await testUrlAccess();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 2. ì¸ì› ëª©ë¡ í…ŒìŠ¤íŠ¸
            await testGetEmployees();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 3. ì¥ì†Œ ëª©ë¡ í…ŒìŠ¤íŠ¸
            await testGetLocations();
            await new Promise(resolve => setTimeout(resolve, 1000));

            // 4. LocalStorage í™•ì¸
            checkLocalStorage();

            // 5. ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateChecklist();

            alert('âœ… ì „ì²´ ì§„ë‹¨ ì™„ë£Œ! ê° ì„¹ì…˜ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateChecklist() {
            const checklist = document.getElementById('checklist');
            const employees = localStorage.getItem('workManagement_employees');
            const locations = localStorage.getItem('workManagement_locations');

            // ê°„ë‹¨í•œ ì²´í¬ (ì‹¤ì œë¡œëŠ” ë” ì •êµí•œ ê²€ì‚¬ í•„ìš”)
            const items = [
                'â³ Google Apps Script ì½”ë“œ ì—…ë°ì´íŠ¸ ì—¬ë¶€ (ìˆ˜ë™ í™•ì¸ í•„ìš”)',
                'â³ ì›¹ ì•± ì¬ë°°í¬ ì—¬ë¶€ (ìˆ˜ë™ í™•ì¸ í•„ìš”)',
                employees && locations ? 'âœ… LocalStorage ìºì‹œ ì¡´ì¬' : 'âŒ LocalStorage ìºì‹œ ì—†ìŒ',
                'â³ ì›¹ ì•± ì•¡ì„¸ìŠ¤ ê¶Œí•œ ì„¤ì • (ìˆ˜ë™ í™•ì¸ í•„ìš”)'
            ];

            checklist.innerHTML = items.map(item => {
                const isOk = item.startsWith('âœ…');
                const isFail = item.startsWith('âŒ');
                const className = isOk ? 'ok' : (isFail ? 'fail' : '');
                return `<li class="${className}">${item}</li>`;
            }).join('');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            checkLocalStorage();
            updateChecklist();
        });
    </script>
</body>
</html>
