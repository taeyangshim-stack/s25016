<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“€ì–¼ í† ì¹˜ ìš©ì ‘ ëª¨ì…˜ ë·°ì–´ | S25016</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            font-size: 14px;
            color: #555;
        }

        select, button, input[type="file"] {
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        select {
            background: white;
        }

        .views-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        .view-box {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #fafafa;
        }

        .view-header {
            background: #667eea;
            color: white;
            padding: 10px;
            font-weight: 600;
            text-align: center;
        }

        canvas {
            display: block;
            width: 100%;
            background: white;
            cursor: crosshair;
        }

        .timeline-container {
            padding: 20px;
            background: #f8f9fa;
            border-top: 2px solid #e0e0e0;
        }

        .timeline-label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .timeline-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .timeline-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border: none;
        }

        .timeline-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .data-display {
            padding: 20px;
            background: white;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .data-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .data-item.warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .data-item.danger {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .data-item-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .data-item-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .legend {
            display: flex;
            gap: 20px;
            padding: 15px 20px;
            background: #f8f9fa;
            justify-content: center;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .file-drop-zone {
            padding: 40px;
            margin: 20px;
            border: 3px dashed #667eea;
            border-radius: 12px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-drop-zone:hover {
            background: #e8eaf6;
            border-color: #5568d3;
        }

        .file-drop-zone.drag-over {
            background: #e8eaf6;
            border-color: #5568d3;
            transform: scale(1.02);
        }

        @media (max-width: 768px) {
            .views-container {
                grid-template-columns: 1fr;
            }

            .data-display {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ë“€ì–¼ í† ì¹˜ ìš©ì ‘ ëª¨ì…˜ ë·°ì–´</h1>
            <p>XYZR ê° íŠ¸ë¦¬ + 2ê°œ ë¡œë´‡ TCP ê²½ë¡œ ì‹œê°í™” ë° ë¶„ì„ ë„êµ¬</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="caseSelect">ì¼€ì´ìŠ¤ ì„ íƒ:</label>
                <select id="caseSelect">
                    <option value="">-- CSV íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš” --</option>
                </select>
            </div>

            <div class="control-group">
                <label for="fileInput">CSV ë¡œë“œ:</label>
                <input type="file" id="fileInput" accept=".csv" multiple>
            </div>

            <div class="control-group">
                <button id="playBtn" disabled>â–¶ ì¬ìƒ</button>
                <button id="pauseBtn" disabled>â¸ ì¼ì‹œì •ì§€</button>
                <button id="resetBtn" disabled>â® ì²˜ìŒìœ¼ë¡œ</button>
            </div>

            <div class="control-group">
                <label for="speedSelect">ì†ë„:</label>
                <select id="speedSelect">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="1" selected>1x</option>
                    <option value="2">2x</option>
                    <option value="5">5x</option>
                </select>
            </div>
        </div>

        <div id="dropZone" class="file-drop-zone">
            <h3>ğŸ“ CSV íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­</h3>
            <p>ë˜ëŠ” ìœ„ì˜ "CSV ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
            <p style="margin-top: 10px; font-size: 12px; color: #666;">
                í•„ìˆ˜ ì»¬ëŸ¼: Time, Gantry_X, Gantry_Y, Gantry_Z, Gantry_R, TCP1_X, TCP1_Y, TCP1_Z, TCP2_X, TCP2_Y, TCP2_Z
            </p>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #f44336;"></div>
                <span>TCP1 (í† ì¹˜ 1)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #2196f3;"></div>
                <span>TCP2 (í† ì¹˜ 2)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4caf50;"></div>
                <span>ê° íŠ¸ë¦¬ ì¤‘ì‹¬</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff9800;"></div>
                <span>ê²½ê³  ê±°ë¦¬ (< 500mm)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f44336;"></div>
                <span>ìœ„í—˜ ê±°ë¦¬ (< 300mm)</span>
            </div>
        </div>

        <div class="views-container">
            <div class="view-box">
                <div class="view-header">í‰ë©´ë„ (X-Y View)</div>
                <canvas id="canvasXY" width="600" height="600"></canvas>
            </div>
            <div class="view-box">
                <div class="view-header">ì¸¡ë©´ë„ (X-Z View)</div>
                <canvas id="canvasXZ" width="600" height="600"></canvas>
            </div>
        </div>

        <div class="timeline-container">
            <div class="timeline-label">íƒ€ì„ë¼ì¸</div>
            <input type="range" id="timelineSlider" class="timeline-slider" min="0" max="100" value="0" disabled>
            <div class="timeline-info">
                <span id="currentTime">00:00.0</span>
                <span id="totalTime">00:00.0</span>
            </div>
        </div>

        <div class="data-display" id="dataDisplay">
            <div class="data-item">
                <div class="data-item-label">ê° íŠ¸ë¦¬ X</div>
                <div class="data-item-value" id="gantryX">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">ê° íŠ¸ë¦¬ Y</div>
                <div class="data-item-value" id="gantryY">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">ê° íŠ¸ë¦¬ Z</div>
                <div class="data-item-value" id="gantryZ">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">ê° íŠ¸ë¦¬ R (íšŒì „)</div>
                <div class="data-item-value" id="gantryR">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">TCP1 ìœ„ì¹˜</div>
                <div class="data-item-value" id="tcp1Pos">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">TCP2 ìœ„ì¹˜</div>
                <div class="data-item-value" id="tcp2Pos">-</div>
            </div>
            <div class="data-item" id="distanceItem">
                <div class="data-item-label">í† ì¹˜ ê°„ ê±°ë¦¬</div>
                <div class="data-item-value" id="torchDistance">-</div>
            </div>
            <div class="data-item">
                <div class="data-item-label">ì‚¬ì´í´ íƒ€ì„</div>
                <div class="data-item-value" id="cycleTime">-</div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let motionData = {};
        let currentCase = null;
        let currentFrameIndex = 0;
        let isPlaying = false;
        let animationId = null;
        let playbackSpeed = 1.0;
        let lastUpdateTime = 0;

        // DOM ìš”ì†Œ
        const fileInput = document.getElementById('fileInput');
        const caseSelect = document.getElementById('caseSelect');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const speedSelect = document.getElementById('speedSelect');
        const timelineSlider = document.getElementById('timelineSlider');
        const dropZone = document.getElementById('dropZone');

        const canvasXY = document.getElementById('canvasXY');
        const canvasXZ = document.getElementById('canvasXZ');
        const ctxXY = canvasXY.getContext('2d');
        const ctxXZ = canvasXZ.getContext('2d');

        // ì¸ì¦ ì²´í¬
        function checkAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const authToken = urlParams.get('auth');
            const validToken = 'c49d872f-4bf0-4721-a5c6-5efb8fa9d8e1';

            if (authToken !== validToken) {
                document.body.innerHTML = '<div style="text-align:center; padding:100px;"><h1>â›” ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h1><p>ì˜¬ë°”ë¥¸ ì¸ì¦ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.</p></div>';
                return false;
            }
            return true;
        }

        // CSV íŒŒì‹±
        function parseCSV(text, filename) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());

            // í•„ìˆ˜ ì»¬ëŸ¼ ê²€ì¦
            const requiredColumns = ['Time', 'Gantry_X', 'Gantry_Y', 'Gantry_Z', 'Gantry_R',
                                     'TCP1_X', 'TCP1_Y', 'TCP1_Z', 'TCP2_X', 'TCP2_Y', 'TCP2_Z'];
            const missingColumns = requiredColumns.filter(col => !headers.includes(col));

            if (missingColumns.length > 0) {
                throw new Error(`í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: ${missingColumns.join(', ')}`);
            }

            const frames = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => parseFloat(v.trim()));
                if (values.length !== headers.length) continue;

                const frame = {};
                headers.forEach((header, index) => {
                    frame[header] = values[index];
                });
                frames.push(frame);
            }

            const caseName = filename.replace('.csv', '');
            motionData[caseName] = frames;

            // ì¼€ì´ìŠ¤ ì„ íƒ ì˜µì…˜ ì¶”ê°€
            const option = document.createElement('option');
            option.value = caseName;
            option.textContent = caseName;
            caseSelect.appendChild(option);

            return caseName;
        }

        // íŒŒì¼ ë¡œë“œ ì´ë²¤íŠ¸
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            loadFiles(files);
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = Array.from(e.dataTransfer.files).filter(f => f.name.endsWith('.csv'));
            loadFiles(files);
        });

        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        function loadFiles(files) {
            if (files.length === 0) return;

            dropZone.innerHTML = '<div class="loading">ğŸ“‚ íŒŒì¼ ë¡œë”© ì¤‘...</div>';

            let loaded = 0;
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        parseCSV(e.target.result, file.name);
                        loaded++;

                        if (loaded === files.length) {
                            dropZone.style.display = 'none';
                            caseSelect.selectedIndex = 1;
                            caseSelect.dispatchEvent(new Event('change'));
                        }
                    } catch (error) {
                        dropZone.innerHTML = `<div class="error">âŒ ${file.name} ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
                    }
                };
                reader.readAsText(file);
            });
        }

        // ì¼€ì´ìŠ¤ ì„ íƒ
        caseSelect.addEventListener('change', (e) => {
            const caseName = e.target.value;
            if (!caseName || !motionData[caseName]) return;

            currentCase = caseName;
            currentFrameIndex = 0;
            isPlaying = false;

            const frames = motionData[currentCase];
            timelineSlider.max = frames.length - 1;
            timelineSlider.value = 0;

            enableControls();
            updateDisplay();
        });

        function enableControls() {
            playBtn.disabled = false;
            pauseBtn.disabled = false;
            resetBtn.disabled = false;
            timelineSlider.disabled = false;
        }

        // ì¬ìƒ ì»¨íŠ¸ë¡¤
        playBtn.addEventListener('click', () => {
            isPlaying = true;
            lastUpdateTime = performance.now();
            animate();
        });

        pauseBtn.addEventListener('click', () => {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });

        resetBtn.addEventListener('click', () => {
            isPlaying = false;
            currentFrameIndex = 0;
            timelineSlider.value = 0;
            updateDisplay();
        });

        speedSelect.addEventListener('change', (e) => {
            playbackSpeed = parseFloat(e.target.value);
        });

        timelineSlider.addEventListener('input', (e) => {
            currentFrameIndex = parseInt(e.target.value);
            updateDisplay();
        });

        // ì• ë‹ˆë©”ì´ì…˜
        function animate(currentTime) {
            if (!isPlaying) return;

            const deltaTime = currentTime - lastUpdateTime;
            const frames = motionData[currentCase];

            // í”„ë ˆì„ ì†ë„ ê³„ì‚° (ê°€ì •: 0.5ì´ˆ ê°„ê²©)
            const frameInterval = 500 / playbackSpeed;

            if (deltaTime >= frameInterval) {
                currentFrameIndex++;

                if (currentFrameIndex >= frames.length) {
                    currentFrameIndex = frames.length - 1;
                    isPlaying = false;
                    return;
                }

                timelineSlider.value = currentFrameIndex;
                updateDisplay();
                lastUpdateTime = currentTime;
            }

            animationId = requestAnimationFrame(animate);
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            if (!currentCase || !motionData[currentCase]) return;

            const frames = motionData[currentCase];
            const frame = frames[currentFrameIndex];

            // ë°ì´í„° í‘œì‹œ
            document.getElementById('gantryX').textContent = `${frame.Gantry_X.toFixed(1)} mm`;
            document.getElementById('gantryY').textContent = `${frame.Gantry_Y.toFixed(1)} mm`;
            document.getElementById('gantryZ').textContent = `${frame.Gantry_Z.toFixed(1)} mm`;
            document.getElementById('gantryR').textContent = `${frame.Gantry_R.toFixed(1)}Â°`;

            document.getElementById('tcp1Pos').textContent =
                `(${frame.TCP1_X.toFixed(0)}, ${frame.TCP1_Y.toFixed(0)}, ${frame.TCP1_Z.toFixed(0)})`;
            document.getElementById('tcp2Pos').textContent =
                `(${frame.TCP2_X.toFixed(0)}, ${frame.TCP2_Y.toFixed(0)}, ${frame.TCP2_Z.toFixed(0)})`;

            // í† ì¹˜ ê°„ ê±°ë¦¬ ê³„ì‚°
            const dx = frame.TCP2_X - frame.TCP1_X;
            const dy = frame.TCP2_Y - frame.TCP1_Y;
            const dz = frame.TCP2_Z - frame.TCP1_Z;
            const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);

            const distanceItem = document.getElementById('distanceItem');
            distanceItem.className = 'data-item';
            if (distance < 300) {
                distanceItem.classList.add('danger');
            } else if (distance < 500) {
                distanceItem.classList.add('warning');
            }
            document.getElementById('torchDistance').textContent = `${distance.toFixed(1)} mm`;

            // ì‹œê°„ í‘œì‹œ
            document.getElementById('currentTime').textContent = formatTime(frame.Time);
            document.getElementById('totalTime').textContent = formatTime(frames[frames.length - 1].Time);
            document.getElementById('cycleTime').textContent = formatTime(frames[frames.length - 1].Time);

            // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸°
            drawXYView(frames, currentFrameIndex);
            drawXZView(frames, currentFrameIndex);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = (seconds % 60).toFixed(1);
            return `${mins.toString().padStart(2, '0')}:${secs.padStart(4, '0')}`;
        }

        // XY í‰ë©´ë„ ê·¸ë¦¬ê¸°
        function drawXYView(frames, currentIndex) {
            const width = canvasXY.width;
            const height = canvasXY.height;

            ctxXY.clearRect(0, 0, width, height);

            // ì¢Œí‘œ ë²”ìœ„ ê³„ì‚°
            const allX = frames.flatMap(f => [f.Gantry_X, f.TCP1_X, f.TCP2_X]);
            const allY = frames.flatMap(f => [f.Gantry_Y, f.TCP1_Y, f.TCP2_Y]);
            const minX = Math.min(...allX);
            const maxX = Math.max(...allX);
            const minY = Math.min(...allY);
            const maxY = Math.max(...allY);

            const margin = 50;
            const scaleX = (width - 2 * margin) / (maxX - minX);
            const scaleY = (height - 2 * margin) / (maxY - minY);
            const scale = Math.min(scaleX, scaleY);

            function toCanvasX(x) {
                return margin + (x - minX) * scale;
            }

            function toCanvasY(y) {
                return height - margin - (y - minY) * scale;
            }

            // ê·¸ë¦¬ë“œ
            ctxXY.strokeStyle = '#e0e0e0';
            ctxXY.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = margin + (width - 2 * margin) * i / 10;
                const y = margin + (height - 2 * margin) * i / 10;
                ctxXY.beginPath();
                ctxXY.moveTo(x, margin);
                ctxXY.lineTo(x, height - margin);
                ctxXY.stroke();
                ctxXY.beginPath();
                ctxXY.moveTo(margin, y);
                ctxXY.lineTo(width - margin, y);
                ctxXY.stroke();
            }

            // ê²½ë¡œ ê·¸ë¦¬ê¸° (TCP1 - ë¹¨ê°•)
            ctxXY.strokeStyle = '#f44336';
            ctxXY.lineWidth = 2;
            ctxXY.beginPath();
            for (let i = 0; i <= currentIndex; i++) {
                const x = toCanvasX(frames[i].TCP1_X);
                const y = toCanvasY(frames[i].TCP1_Y);
                if (i === 0) {
                    ctxXY.moveTo(x, y);
                } else {
                    ctxXY.lineTo(x, y);
                }
            }
            ctxXY.stroke();

            // ê²½ë¡œ ê·¸ë¦¬ê¸° (TCP2 - íŒŒë‘)
            ctxXY.strokeStyle = '#2196f3';
            ctxXY.lineWidth = 2;
            ctxXY.beginPath();
            for (let i = 0; i <= currentIndex; i++) {
                const x = toCanvasX(frames[i].TCP2_X);
                const y = toCanvasY(frames[i].TCP2_Y);
                if (i === 0) {
                    ctxXY.moveTo(x, y);
                } else {
                    ctxXY.lineTo(x, y);
                }
            }
            ctxXY.stroke();

            // í˜„ì¬ ìœ„ì¹˜
            const currentFrame = frames[currentIndex];

            // ê° íŠ¸ë¦¬ ì¤‘ì‹¬ (ë…¹ìƒ‰)
            ctxXY.fillStyle = '#4caf50';
            ctxXY.beginPath();
            ctxXY.arc(toCanvasX(currentFrame.Gantry_X), toCanvasY(currentFrame.Gantry_Y), 8, 0, Math.PI * 2);
            ctxXY.fill();

            // TCP1 (ë¹¨ê°•)
            ctxXY.fillStyle = '#f44336';
            ctxXY.beginPath();
            ctxXY.arc(toCanvasX(currentFrame.TCP1_X), toCanvasY(currentFrame.TCP1_Y), 10, 0, Math.PI * 2);
            ctxXY.fill();

            // TCP2 (íŒŒë‘)
            ctxXY.fillStyle = '#2196f3';
            ctxXY.beginPath();
            ctxXY.arc(toCanvasX(currentFrame.TCP2_X), toCanvasY(currentFrame.TCP2_Y), 10, 0, Math.PI * 2);
            ctxXY.fill();

            // í† ì¹˜ ê°„ ê±°ë¦¬ì„ 
            const dx = currentFrame.TCP2_X - currentFrame.TCP1_X;
            const dy = currentFrame.TCP2_Y - currentFrame.TCP1_Y;
            const dz = currentFrame.TCP2_Z - currentFrame.TCP1_Z;
            const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);

            if (distance < 500) {
                ctxXY.strokeStyle = distance < 300 ? '#f44336' : '#ff9800';
                ctxXY.lineWidth = 3;
                ctxXY.setLineDash([5, 5]);
                ctxXY.beginPath();
                ctxXY.moveTo(toCanvasX(currentFrame.TCP1_X), toCanvasY(currentFrame.TCP1_Y));
                ctxXY.lineTo(toCanvasX(currentFrame.TCP2_X), toCanvasY(currentFrame.TCP2_Y));
                ctxXY.stroke();
                ctxXY.setLineDash([]);
            }

            // ì¶• ë¼ë²¨
            ctxXY.fillStyle = '#333';
            ctxXY.font = '14px Arial';
            ctxXY.fillText('X â†’', width - 40, height - 10);
            ctxXY.fillText('Y â†‘', 10, 20);
        }

        // XZ ì¸¡ë©´ë„ ê·¸ë¦¬ê¸°
        function drawXZView(frames, currentIndex) {
            const width = canvasXZ.width;
            const height = canvasXZ.height;

            ctxXZ.clearRect(0, 0, width, height);

            // ì¢Œí‘œ ë²”ìœ„ ê³„ì‚°
            const allX = frames.flatMap(f => [f.Gantry_X, f.TCP1_X, f.TCP2_X]);
            const allZ = frames.flatMap(f => [f.Gantry_Z, f.TCP1_Z, f.TCP2_Z]);
            const minX = Math.min(...allX);
            const maxX = Math.max(...allX);
            const minZ = Math.min(...allZ);
            const maxZ = Math.max(...allZ);

            const margin = 50;
            const scaleX = (width - 2 * margin) / (maxX - minX);
            const scaleZ = (height - 2 * margin) / (maxZ - minZ);
            const scale = Math.min(scaleX, scaleZ);

            function toCanvasX(x) {
                return margin + (x - minX) * scale;
            }

            function toCanvasZ(z) {
                return height - margin - (z - minZ) * scale;
            }

            // ê·¸ë¦¬ë“œ
            ctxXZ.strokeStyle = '#e0e0e0';
            ctxXZ.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const x = margin + (width - 2 * margin) * i / 10;
                const z = margin + (height - 2 * margin) * i / 10;
                ctxXZ.beginPath();
                ctxXZ.moveTo(x, margin);
                ctxXZ.lineTo(x, height - margin);
                ctxXZ.stroke();
                ctxXZ.beginPath();
                ctxXZ.moveTo(margin, z);
                ctxXZ.lineTo(width - margin, z);
                ctxXZ.stroke();
            }

            // ê²½ë¡œ ê·¸ë¦¬ê¸° (TCP1 - ë¹¨ê°•)
            ctxXZ.strokeStyle = '#f44336';
            ctxXZ.lineWidth = 2;
            ctxXZ.beginPath();
            for (let i = 0; i <= currentIndex; i++) {
                const x = toCanvasX(frames[i].TCP1_X);
                const z = toCanvasZ(frames[i].TCP1_Z);
                if (i === 0) {
                    ctxXZ.moveTo(x, z);
                } else {
                    ctxXZ.lineTo(x, z);
                }
            }
            ctxXZ.stroke();

            // ê²½ë¡œ ê·¸ë¦¬ê¸° (TCP2 - íŒŒë‘)
            ctxXZ.strokeStyle = '#2196f3';
            ctxXZ.lineWidth = 2;
            ctxXZ.beginPath();
            for (let i = 0; i <= currentIndex; i++) {
                const x = toCanvasX(frames[i].TCP2_X);
                const z = toCanvasZ(frames[i].TCP2_Z);
                if (i === 0) {
                    ctxXZ.moveTo(x, z);
                } else {
                    ctxXZ.lineTo(x, z);
                }
            }
            ctxXZ.stroke();

            // í˜„ì¬ ìœ„ì¹˜
            const currentFrame = frames[currentIndex];

            // ê° íŠ¸ë¦¬ ì¤‘ì‹¬ (ë…¹ìƒ‰)
            ctxXZ.fillStyle = '#4caf50';
            ctxXZ.beginPath();
            ctxXZ.arc(toCanvasX(currentFrame.Gantry_X), toCanvasZ(currentFrame.Gantry_Z), 8, 0, Math.PI * 2);
            ctxXZ.fill();

            // TCP1 (ë¹¨ê°•)
            ctxXZ.fillStyle = '#f44336';
            ctxXZ.beginPath();
            ctxXZ.arc(toCanvasX(currentFrame.TCP1_X), toCanvasZ(currentFrame.TCP1_Z), 10, 0, Math.PI * 2);
            ctxXZ.fill();

            // TCP2 (íŒŒë‘)
            ctxXZ.fillStyle = '#2196f3';
            ctxXZ.beginPath();
            ctxXZ.arc(toCanvasX(currentFrame.TCP2_X), toCanvasZ(currentFrame.TCP2_Z), 10, 0, Math.PI * 2);
            ctxXZ.fill();

            // ì¶• ë¼ë²¨
            ctxXZ.fillStyle = '#333';
            ctxXZ.font = '14px Arial';
            ctxXZ.fillText('X â†’', width - 40, height - 10);
            ctxXZ.fillText('Z â†‘', 10, 20);
        }

        // ì´ˆê¸°í™”
        if (checkAuth()) {
            console.log('âœ… ì¸ì¦ ì™„ë£Œ');
        }
    </script>
</body>
</html>
