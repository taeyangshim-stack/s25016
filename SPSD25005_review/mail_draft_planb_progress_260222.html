<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body style="font-family:'맑은 고딕','Malgun Gothic',sans-serif; font-size:10pt; color:#333; line-height:1.7; max-width:800px; margin:0 auto;">

<div style="border-bottom:3px solid #1a5276; padding-bottom:10px; margin-bottom:20px;">
  <h2 style="color:#1a5276; margin:0;">[S25016] PlanB RAPID 진행보고 — Robot TCP 좌표/자세 수정 및 향후 계획 (2026.02.22)</h2>
</div>

<table style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:9.5pt;">
  <tr><td style="width:60px; padding:4px 8px; background:#f0f4f8; font-weight:bold;">수신</td><td style="padding:4px 8px;">삼성중공업 담당자님, 이마룬 사원</td></tr>
  <tr><td style="padding:4px 8px; background:#f0f4f8; font-weight:bold;">참조</td><td style="padding:4px 8px;">GR자동화, 디파인시스템</td></tr>
  <tr><td style="padding:4px 8px; background:#f0f4f8; font-weight:bold;">발신</td><td style="padding:4px 8px;">심태양 / 에스피시스템스</td></tr>
  <tr><td style="padding:4px 8px; background:#f0f4f8; font-weight:bold;">일자</td><td style="padding:4px 8px;">2026년 2월 22일</td></tr>
  <tr><td style="padding:4px 8px; background:#f0f4f8; font-weight:bold;">첨부</td><td style="padding:4px 8px;">SpGantry_1200_526406_BACKUP_v1-9-51.zip (620KB)</td></tr>
</table>

<p>안녕하십니까, 에스피시스템스 심태양입니다.</p>
<p>S25016 B라인 자동용접 로봇 시스템의 <b>PlanB RAPID 프로그램 최근 진행사항</b>을 보고드립니다.<br>
2/18 보고 이후 진행한 Robot TCP 좌표 및 자세 관련 4건의 수정사항과 향후 계획을 정리하였습니다.</p>

<!-- ========== 1. 이전 보고 요약 ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">1. 이전 보고 요약</h3>

<table style="width:100%; border-collapse:collapse; margin:10px 0; font-size:9pt;">
  <tr style="background:#1a5276; color:#fff;">
    <th style="padding:6px 10px; text-align:left; width:80px;">일자</th>
    <th style="padding:6px 10px; text-align:left;">제목</th>
    <th style="padding:6px 10px; text-align:left; width:120px;">주요 내용</th>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd;">02/13</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">PlanB RAPID 수정 진행경과 보고 (종합)</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">주요 문제 5건 해결</td>
  </tr>
  <tr>
    <td style="padding:5px 10px; border:1px solid #ddd;">02/18</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">PlanB 개발 히스토리 + PlanC Phase 1</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">40-Segment 드라이런</td>
  </tr>
</table>

<!-- ========== 2. 금주 진행사항 (4건) ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">2. 금주 진행사항 (2/21~22, 4건)</h3>

<!-- Issue 1: 488mm -->
<div style="background:#f8f9fa; border:1px solid #dee2e6; border-radius:6px; padding:15px; margin:15px 0;">
  <h4 style="color:#c0392b; margin:0 0 8px 0;">#1. Robot2 TCP 488mm 오프셋 문제 수정 (v2.0.1~v2.0.2)</h4>
  <table style="width:100%; border-collapse:collapse; font-size:9pt;">
    <tr>
      <td style="width:70px; padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">문제</td>
      <td style="padding:4px 8px;">Robot2 베이스가 R축 중심에서 <b>488mm</b> 떨어져 있어, R축 회전 시 TCP Floor 좌표가 부정확</td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">원인</td>
      <td style="padding:4px 8px;">CalcCurrentTcp에서 Robot2 위치 계산 시 488mm Y오프셋을 R축 회전 <b>전에</b> 빼지 않음 + 오리엔테이션에 갠트리 각도 보정 누락</td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">수정</td>
      <td style="padding:4px 8px;">
        &bull; R2 위치: 488mm Y오프셋을 R회전 적용 전에 차감<br>
        &bull; R2 오리엔테이션: EulerZYX(\Z) - gantryAngle 보정 추가<br>
        &bull; T_BG 시작 시 버전 로깅 (HOME:/t_bg_version.txt)
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">상태</td>
      <td style="padding:4px 8px; color:#1a7a2e; font-weight:bold;">해결 완료</td>
    </tr>
  </table>
</div>

<!-- Issue 2: Non-home init -->
<div style="background:#f8f9fa; border:1px solid #dee2e6; border-radius:6px; padding:15px; margin:15px 0;">
  <h4 style="color:#c0392b; margin:0 0 8px 0;">#2. Robot1 초기화 — 갠트리 비원점 위치 에러 수정 (v1.9.49)</h4>
  <table style="width:100%; border-collapse:collapse; font-size:9pt;">
    <tr>
      <td style="width:70px; padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">문제</td>
      <td style="padding:4px 8px;">갠트리가 HOME(원점)이 아닌 위치에서 Robot1 초기화 시 <b>unreachable 에러</b> 또는 비정상 동작</td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">원인</td>
      <td style="padding:4px 8px;">
        &bull; CRobT에서 wobj0 사용 → 갠트리 XYZ≠0일 때 월드 좌표가 커져서 보정량 과대 → unreachable<br>
        &bull; 하드코딩 confdata [-1,-1,0,4] → R≠0 시 유효하지 않은 관절 구성
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">수정</td>
      <td style="padding:4px 8px;">
        &bull; CRobT wobj0 → <b>WobjGantry</b>로 변경 (갠트리 상대좌표)<br>
        &bull; ConfJ \Off / ConfL \Off 추가 (유연한 관절 구성 허용)
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">상태</td>
      <td style="padding:4px 8px; color:#1a7a2e; font-weight:bold;">해결 완료</td>
    </tr>
  </table>
</div>

<!-- Issue 3: TestInitNonHome -->
<div style="background:#f8f9fa; border:1px solid #dee2e6; border-radius:6px; padding:15px; margin:15px 0;">
  <h4 style="color:#2471a3; margin:0 0 8px 0;">#3. 비원점 초기화 자동 테스트 추가 (v1.9.50)</h4>
  <table style="width:100%; border-collapse:collapse; font-size:9pt;">
    <tr>
      <td style="width:70px; padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">내용</td>
      <td style="padding:4px 8px;">TestInitNonHome — 4개 시나리오 자동 검증 테스트 추가</td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">시나리오</td>
      <td style="padding:4px 8px;">
        A: HOME (R=0, 기준) / B: R=30° (R축 회전) / C: XYZ 오프셋 / D: XYZ+R=30° (복합)
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">출력</td>
      <td style="padding:4px 8px;">HOME:/test_init_nonhome.txt (시나리오별 PASS/FAIL, TCP 오차, 관절 각도)</td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">발견</td>
      <td style="padding:4px 8px; color:#c0392b;">TCP 위치는 PASS이나, <b>R=30° 시나리오에서 관절 자세 이상</b> 발견 → #4에서 수정</td>
    </tr>
  </table>
</div>

<!-- Issue 4: Posture fix -->
<div style="background:#f8f9fa; border:1px solid #dee2e6; border-radius:6px; padding:15px; margin:15px 0;">
  <h4 style="color:#c0392b; margin:0 0 8px 0;">#4. R≠0 이상 자세 수정 (v1.9.51) — 금일 핵심 수정</h4>
  <table style="width:100%; border-collapse:collapse; font-size:9pt;">
    <tr>
      <td style="width:70px; padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">문제</td>
      <td style="padding:4px 8px;">R=30° 시 TCP 위치는 정확하나 <b>관절 자세가 완전히 다름</b><br>
        정상: rax_5=8.26° → 이상: rax_5=<b>-94.59°</b></td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">원인</td>
      <td style="padding:4px 8px;">
        Step 2에서 오리엔테이션 [0.45452,-0.54167,0.54167,0.45453]이 <b>R=0에서 교시된 값으로 하드코딩</b><br>
        → R≠0일 때 로봇 베이스가 물리적으로 회전되어 있으므로, 동일 WobjGantry 오리엔테이션 달성에 다른 관절 구성 필요<br>
        → ConfJ \Off 상태에서 로봇이 <b>비정상 자세</b> 선택
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">수정</td>
      <td style="padding:4px 8px;">
        하드코딩 오리엔테이션 → <b>CRobT로 현재 오리엔테이션 읽기</b><br>
        Step 1(MoveAbsJ) 이후 정상 관절 자세에서 CRobT가 반환하는 오리엔테이션을 그대로 사용<br>
        위치만 [0, 0, 1000]으로 변경, MoveJ → <b>MoveL</b>로 변경
      </td>
    </tr>
    <tr>
      <td style="padding:4px 8px; font-weight:bold; vertical-align:top; color:#666;">상태</td>
      <td style="padding:4px 8px; color:#1a7a2e; font-weight:bold;">해결 완료</td>
    </tr>
  </table>
</div>

<!-- ========== 3. 검증 결과 ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">3. 검증 결과 (v1.9.51)</h3>

<p style="font-size:9.5pt;">TestInitNonHome 4개 시나리오 결과: <b style="color:#1a7a2e;">4/4 PASSED</b></p>

<table style="width:100%; border-collapse:collapse; margin:10px 0; font-size:9pt;">
  <tr style="background:#1a5276; color:#fff;">
    <th style="padding:6px 10px; text-align:left;">시나리오</th>
    <th style="padding:6px 10px; text-align:center;">rax_1</th>
    <th style="padding:6px 10px; text-align:center;">rax_2</th>
    <th style="padding:6px 10px; text-align:center;">rax_3</th>
    <th style="padding:6px 10px; text-align:center;">rax_4</th>
    <th style="padding:6px 10px; text-align:center;">rax_5</th>
    <th style="padding:6px 10px; text-align:center;">rax_6</th>
    <th style="padding:6px 10px; text-align:center;">TCP 오차</th>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd;">A: HOME (R=0)</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-48.88</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">6.22</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">0.01</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">8.26</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center; color:#1a7a2e;">0.047mm</td>
  </tr>
  <tr>
    <td style="padding:5px 10px; border:1px solid #ddd;">B: R=30°</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-48.88</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">6.22</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">8.26</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center; color:#1a7a2e;">0.058mm</td>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd;">C: XYZ offset</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-48.88</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">6.22</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">8.26</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center; color:#1a7a2e;">0.058mm</td>
  </tr>
  <tr>
    <td style="padding:5px 10px; border:1px solid #ddd;">D: XYZ+R=30°</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-48.88</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">6.22</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">8.26</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">-0.00</td>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center; color:#1a7a2e;">0.058mm</td>
  </tr>
</table>

<div style="background:#d4efdf; border:1px solid #a9dfbf; border-radius:4px; padding:10px; margin:10px 0; font-size:9.5pt;">
  <b>핵심 확인:</b> 모든 시나리오에서 관절 각도가 교시값과 ±0.01° 이내 일치, TCP 오차 0.06mm 이하.<br>
  <b>수정 전 B:R=30°</b>: rax_5=<span style="color:#c0392b;"><b>-94.59°</b></span> (이상) → <b>수정 후</b>: rax_5=<span style="color:#1a7a2e;"><b>8.26°</b></span> (정상)
</div>

<!-- ========== 4. 향후 계획 및 질문 ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">4. 향후 계획</h3>

<table style="width:100%; border-collapse:collapse; margin:10px 0; font-size:9pt;">
  <tr style="background:#1a5276; color:#fff;">
    <th style="padding:6px 10px; text-align:left; width:30px;">#</th>
    <th style="padding:6px 10px; text-align:left;">항목</th>
    <th style="padding:6px 10px; text-align:left;">내용</th>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">1</td>
    <td style="padding:5px 10px; border:1px solid #ddd; font-weight:bold;">용접조건 스왑</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">PlanA/PlanC의 용접 파라미터(welddata, weavedata)를 PlanB 시퀀스에 적용</td>
  </tr>
  <tr>
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">2</td>
    <td style="padding:5px 10px; border:1px solid #ddd; font-weight:bold;">가상축 가능성 검증</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">PlanB 구성에서 가상축(Virtual Axis) 활용 가능성 검토 및 시뮬레이션 검증</td>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd; text-align:center;">3</td>
    <td style="padding:5px 10px; border:1px solid #ddd; font-weight:bold;">Phase 2~5 계속</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">ArcL 실용접, welddata 세그먼트별 적용, 터치센싱, 어곡 실기 검증</td>
  </tr>
</table>

<!-- ========== 5. 이마룬 사원 확인 요청 ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">5. 확인 요청 사항 (이마룬 사원)</h3>

<div style="background:#fef9e7; border:1px solid #f9e79f; border-radius:6px; padding:15px; margin:15px 0; font-size:9.5pt;">
  <p style="margin:0 0 10px 0;">이마룬 사원님께 아래 사항 확인 부탁드립니다:</p>
  <ol style="margin:0; padding-left:20px;">
    <li style="margin-bottom:8px;">
      <b>PlanA / PlanC에서 UI 화면에 툴(TCP)의 위치가 표시되고 있는 것으로 알고 있는데,<br>
      툴의 <span style="color:#c0392b;">방향(오리엔테이션)</span>도 함께 표시되고 있습니까?</b><br>
      <span style="color:#666;">(PlanB에서 CalcCurrentTcp의 위치/방향 정확도를 검증한 상태이므로, UI 연동 범위 확인 필요)</span>
    </li>
    <li style="margin-bottom:8px;">
      <b>마룬님 관점에서, 현재 PlanB 시뮬레이션이 여기까지 진행된 상황에서<br>
      <span style="color:#2471a3;">이후 스텝이 무엇이라고 생각하시는지</span> 의견 부탁드립니다.</b><br>
      <span style="color:#666;">(제 쪽에서는 위 항목 1~2번: 용접조건 스왑, 가상축 가능성 검증을 우선 진행하려 합니다)</span>
    </li>
  </ol>
</div>

<!-- ========== 6. 첨부 파일 ========== -->
<h3 style="color:#1a5276; border-left:4px solid #1a5276; padding-left:10px; margin-top:30px;">6. 첨부 파일</h3>

<table style="width:100%; border-collapse:collapse; margin:10px 0; font-size:9pt;">
  <tr style="background:#1a5276; color:#fff;">
    <th style="padding:6px 10px; text-align:left;">파일명</th>
    <th style="padding:6px 10px; text-align:left;">크기</th>
    <th style="padding:6px 10px; text-align:left;">내용</th>
  </tr>
  <tr style="background:#f9f9f9;">
    <td style="padding:5px 10px; border:1px solid #ddd;">SpGantry_1200_526406_BACKUP_v1-9-51.zip</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">620KB</td>
    <td style="padding:5px 10px; border:1px solid #ddd;">RAPID 전체 백업 (TASK1~9, SYSPAR, HOME 포함)<br>TASK1_VERSION=v1.9.51, TASK2_VERSION=v1.9.43, T_BG=v2.0.1</td>
  </tr>
</table>

<hr style="border:none; border-top:1px solid #ddd; margin:25px 0;">

<p style="font-size:9.5pt;">
Robot TCP 좌표 및 자세 관련 주요 이슈를 해결하여, 갠트리가 어떤 위치/각도에 있든 Robot1 초기화가 정상 동작하는 것을 확인하였습니다.<br>
향후 용접조건 이식 및 가상축 검토를 진행하겠습니다.
</p>

<p style="font-size:9.5pt;">문의사항이 있으시면 말씀 부탁드립니다.<br>감사합니다.</p>

<div style="margin-top:20px; padding-top:10px; border-top:1px solid #ccc; font-size:8.5pt; color:#888;">
  심태양 / 에스피시스템스 개발팀<br>
  taeyang@spsystems.kr
</div>

</body>
</html>
