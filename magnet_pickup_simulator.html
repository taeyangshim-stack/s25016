<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆê·¸ë„¤íŠ¸ í”½ì—… ìœ„ì¹˜ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QESESDFLGY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-QESESDFLGY');
    </script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Malgun Gothic', 'Segoe UI', sans-serif;
        }
        body {
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: #2563eb;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 0;
        }
        .tab {
            padding: 12px 24px;
            background: #e5e7eb;
            border: none;
            color: #666;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 14px;
            transition: all 0.3s;
        }
        .tab.active {
            background: #fff;
            color: #2563eb;
            font-weight: bold;
        }
        .tab:hover {
            color: #2563eb;
        }
        .tab-content {
            display: none;
            background: #fff;
            padding: 20px;
            border-radius: 0 8px 8px 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group label {
            min-width: 120px;
            color: #555;
            font-weight: 500;
        }
        .form-group input, .form-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fff;
            color: #333;
            width: 150px;
            font-size: 14px;
        }
        .form-group input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .form-group .unit {
            color: #888;
            font-size: 12px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: #fff;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(37, 99, 235, 0.4);
        }
        .btn-secondary {
            background: #ef4444;
            color: #fff;
        }
        .btn-secondary:hover {
            background: #dc2626;
        }
        .canvas-container {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            overflow: auto;
            border: 1px solid #e5e7eb;
        }
        canvas {
            display: block;
            margin: 0 auto;
            border: 1px solid #ddd;
            background: #fff;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-table th, .results-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        .results-table th {
            background: #f1f5f9;
            color: #2563eb;
            font-weight: 600;
        }
        .results-table tr:nth-child(even) {
            background: #f8fafc;
        }
        .results-table tr:hover {
            background: #eff6ff;
        }
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #2563eb;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        .info-box h3 {
            margin: 0 0 10px 0;
            color: #2563eb;
        }
        .info-box p {
            color: #555;
            margin: 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #2563eb;
        }
        .stat-card .label {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #555;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }
        .shape-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .preset-btn {
            padding: 8px 16px;
            background: #fff;
            border: 1px solid #ddd;
            color: #555;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .preset-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
            background: #eff6ff;
        }
        .section-title {
            color: #2563eb;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
            margin: 25px 0 15px 0;
        }
    </style>
</head>
<body>
    <h1>ë§ˆê·¸ë„¤íŠ¸ í”½ì—… ìœ„ì¹˜ ì‹œë®¬ë ˆì´í„°</h1>

    <div class="tabs">
        <button class="tab active" onclick="showTab('tab1')">1. ê°•íŒ ì„¤ì •</button>
        <button class="tab" onclick="showTab('tab2')">2. í˜•ìƒ ìƒì„± & ì‹œë®¬ë ˆì´ì…˜</button>
        <button class="tab" onclick="showTab('tab3')">3. ê²°ê³¼ ë°ì´í„°</button>
    </div>

    <!-- íƒ­1: ê°•íŒ ì„¤ì • -->
    <div id="tab1" class="tab-content active">
        <div class="info-box">
            <h3>ê°•íŒ ê·œê²© ì„¤ì •</h3>
            <p>ë ˆì´ì € ì ˆë‹¨ì— ì‚¬ìš©í•  ì›íŒ ê°•íŒì˜ í¬ê¸°ì™€ ë¬¼ì„±ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
        </div>

        <h3 class="section-title">í‘œì¤€ ê·œê²© ì„ íƒ</h3>
        <div class="shape-controls">
            <button class="preset-btn" onclick="setPlatePreset(1219, 2438, '4x8')">4' x 8'</button>
            <button class="preset-btn" onclick="setPlatePreset(1524, 3048, '5x10')">5' x 10'</button>
            <button class="preset-btn" onclick="setPlatePreset(1524, 6096, '5x20')">5' x 20'</button>
            <button class="preset-btn" onclick="setPlatePreset(1829, 6096, '6x20')">6' x 20' (ê¸°ë³¸)</button>
        </div>

        <h3 class="section-title">ê°•íŒ í¬ê¸°</h3>
        <div class="form-group">
            <label>í­ (W)</label>
            <input type="number" id="plateWidth" value="1829">
            <span class="unit">mm</span>
        </div>
        <div class="form-group">
            <label>ê¸¸ì´ (L)</label>
            <input type="number" id="plateLength" value="6096">
            <span class="unit">mm</span>
        </div>

        <h3 class="section-title">ì†Œì¬ ë¬¼ì„±</h3>
        <div class="form-group">
            <label>ë‘ê»˜ (t)</label>
            <input type="number" id="plateThickness" value="10">
            <span class="unit">mm</span>
        </div>
        <div class="form-group">
            <label>ë¹„ì¤‘</label>
            <input type="number" id="plateDensity" value="7850">
            <span class="unit">kg/mÂ³</span>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="value" id="plateArea">11.15</div>
                <div class="label">ê°•íŒ ë©´ì  (mÂ²)</div>
            </div>
            <div class="stat-card">
                <div class="value" id="plateWeight">875.3</div>
                <div class="label">ê°•íŒ ì¤‘ëŸ‰ (kg)</div>
            </div>
        </div>

        <button class="btn btn-primary" onclick="applyPlateSettings(); showTab('tab2');">
            ì„¤ì • ì ìš© â†’ ì‹œë®¬ë ˆì´ì…˜
        </button>
    </div>

    <!-- íƒ­2: í˜•ìƒ ìƒì„± & ì‹œë®¬ë ˆì´ì…˜ -->
    <div id="tab2" class="tab-content">
        <div class="info-box">
            <h3>ëœë¤ í˜•ìƒ ìƒì„±</h3>
            <p>ê°•íŒ ìœ„ì— ëœë¤ ì ˆë‹¨ í˜•ìƒì„ ìƒì„±í•˜ê³ , ê° í˜•ìƒì˜ ë§ˆê·¸ë„¤íŠ¸ í”½ì—… ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
        </div>

        <h3 class="section-title">í˜•ìƒ ìƒì„± ì˜µì…˜</h3>
        <div class="form-group">
            <label>í˜•ìƒ ê°œìˆ˜</label>
            <input type="number" id="shapeCount" value="5" min="1" max="20">
            <span class="unit">ê°œ</span>
        </div>
        <div class="form-group">
            <label>í˜•ìƒ ìœ í˜•</label>
            <select id="shapeType">
                <option value="mixed">í˜¼í•© (ëœë¤)</option>
                <option value="rectangle">ì§ì‚¬ê°í˜•</option>
                <option value="triangle">ì‚¼ê°í˜•</option>
                <option value="polygon">ë‹¤ê°í˜• (4~6ê°)</option>
                <option value="lshape">Lí˜•</option>
            </select>
        </div>
        <div class="form-group">
            <label>ìµœì†Œ í¬ê¸°</label>
            <input type="number" id="minSize" value="200">
            <span class="unit">mm</span>
        </div>
        <div class="form-group">
            <label>ìµœëŒ€ í¬ê¸°</label>
            <input type="number" id="maxSize" value="800">
            <span class="unit">mm</span>
        </div>

        <div class="shape-controls" style="margin: 20px 0;">
            <button class="btn btn-primary" onclick="generateShapes()">
                ğŸ² ëœë¤ í˜•ìƒ ìƒì„±
            </button>
            <button class="btn btn-secondary" onclick="clearShapes()">
                ğŸ—‘ï¸ ì´ˆê¸°í™”
            </button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #d1d5db;"></div>
                <span>ê°•íŒ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(37, 99, 235, 0.4);"></div>
                <span>ì ˆë‹¨ í˜•ìƒ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #dc2626; border-radius: 50%;"></div>
                <span>í”½ì—… ìœ„ì¹˜ (ë¬´ê²Œì¤‘ì‹¬)</span>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="simulationCanvas" width="900" height="400"></canvas>
        </div>

        <div class="stats" id="simStats">
            <div class="stat-card">
                <div class="value" id="totalShapes">0</div>
                <div class="label">ìƒì„±ëœ í˜•ìƒ</div>
            </div>
            <div class="stat-card">
                <div class="value" id="totalCutArea">0</div>
                <div class="label">ì´ ì ˆë‹¨ ë©´ì  (mÂ²)</div>
            </div>
            <div class="stat-card">
                <div class="value" id="totalCutWeight">0</div>
                <div class="label">ì´ ì ˆë‹¨ ì¤‘ëŸ‰ (kg)</div>
            </div>
            <div class="stat-card">
                <div class="value" id="utilizationRate">0</div>
                <div class="label">ì¬ë£Œ ì´ìš©ë¥  (%)</div>
            </div>
        </div>
    </div>

    <!-- íƒ­3: ê²°ê³¼ ë°ì´í„° -->
    <div id="tab3" class="tab-content">
        <div class="info-box">
            <h3>í”½ì—… ìœ„ì¹˜ ë°ì´í„°</h3>
            <p>ê° í˜•ìƒë³„ ë¬´ê²Œì¤‘ì‹¬ ì¢Œí‘œ ë° ë§ˆê·¸ë„¤íŠ¸ í”½ì—… ìœ„ì¹˜ì…ë‹ˆë‹¤. ë¡œë´‡ ì¸í„°í˜ì´ìŠ¤ë¡œ ì „ì†¡í•  ë°ì´í„°ì…ë‹ˆë‹¤.</p>
        </div>

        <button class="btn btn-primary" onclick="exportData()" style="margin-bottom: 20px;">
            ğŸ“‹ ë°ì´í„° ë³µì‚¬ (CSV)
        </button>
        <button class="btn btn-secondary" onclick="exportJSON()" style="margin-bottom: 20px;">
            ğŸ“¦ JSON ë‚´ë³´ë‚´ê¸°
        </button>

        <table class="results-table">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>í˜•ìƒ</th>
                    <th>Pickup X (mm)</th>
                    <th>Pickup Y (mm)</th>
                    <th>ë©´ì  (mmÂ²)</th>
                    <th>ì¤‘ëŸ‰ (kg)</th>
                    <th>ê¼­ì§€ì  ìˆ˜</th>
                </tr>
            </thead>
            <tbody id="resultsBody">
                <tr>
                    <td colspan="7" style="color: #666;">í˜•ìƒì„ ìƒì„±í•˜ë©´ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</td>
                </tr>
            </tbody>
        </table>

        <h3 class="section-title">ì¢Œí‘œ ìƒì„¸ ë°ì´í„°</h3>
        <div id="detailData" style="background: #f8fafc; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow: auto; border: 1px solid #e5e7eb; color: #555;">
            í˜•ìƒì„ ìƒì„±í•˜ë©´ ìƒì„¸ ì¢Œí‘œê°€ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let plate = {
            width: 1829,
            length: 6096,
            thickness: 10,
            density: 7850
        };
        let shapes = [];
        let canvas, ctx;
        let scale = 1;

        // ì´ˆê¸°í™”
        window.onload = function() {
            canvas = document.getElementById('simulationCanvas');
            ctx = canvas.getContext('2d');
            updatePlateStats();
            drawPlate();
        };

        // íƒ­ ì „í™˜
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            if (tabId === 'tab2') {
                updateCanvas();
            }
        }

        // ê°•íŒ í”„ë¦¬ì…‹
        function setPlatePreset(w, l, name) {
            document.getElementById('plateWidth').value = w;
            document.getElementById('plateLength').value = l;
            updatePlateStats();
        }

        // ê°•íŒ í†µê³„ ì—…ë°ì´íŠ¸
        function updatePlateStats() {
            plate.width = parseFloat(document.getElementById('plateWidth').value) || 1829;
            plate.length = parseFloat(document.getElementById('plateLength').value) || 6096;
            plate.thickness = parseFloat(document.getElementById('plateThickness').value) || 10;
            plate.density = parseFloat(document.getElementById('plateDensity').value) || 7850;

            const areaM2 = (plate.width * plate.length) / 1000000;
            const weight = areaM2 * (plate.thickness / 1000) * plate.density;

            document.getElementById('plateArea').textContent = areaM2.toFixed(2);
            document.getElementById('plateWeight').textContent = weight.toFixed(1);
        }

        // ê°•íŒ ì„¤ì • ì ìš©
        function applyPlateSettings() {
            updatePlateStats();
            updateCanvas();
        }

        // ìº”ë²„ìŠ¤ ì—…ë°ì´íŠ¸
        function updateCanvas() {
            // ìŠ¤ì¼€ì¼ ê³„ì‚° (ìº”ë²„ìŠ¤ì— ë§ì¶”ê¸°)
            const maxCanvasWidth = 880;
            const maxCanvasHeight = 380;

            scale = Math.min(maxCanvasWidth / plate.length, maxCanvasHeight / plate.width);

            canvas.width = plate.length * scale + 20;
            canvas.height = plate.width * scale + 20;

            drawPlate();
            drawShapes();
        }

        // ê°•íŒ ê·¸ë¦¬ê¸°
        function drawPlate() {
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ê°•íŒ
            ctx.fillStyle = '#d1d5db';
            ctx.fillRect(10, 10, plate.length * scale, plate.width * scale);

            // í…Œë‘ë¦¬
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, plate.length * scale, plate.width * scale);

            // ì¹˜ìˆ˜ í‘œì‹œ
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${plate.length} mm`, 10 + (plate.length * scale) / 2, canvas.height - 2);

            ctx.save();
            ctx.translate(5, 10 + (plate.width * scale) / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(`${plate.width} mm`, 0, 0);
            ctx.restore();
        }

        // í˜•ìƒ ìƒì„± (ê²¹ì¹¨ ë°©ì§€)
        function generateShapes() {
            shapes = [];
            const count = parseInt(document.getElementById('shapeCount').value) || 5;
            const type = document.getElementById('shapeType').value;
            const minSize = parseInt(document.getElementById('minSize').value) || 200;
            const maxSize = parseInt(document.getElementById('maxSize').value) || 800;
            const maxRetries = 100; // ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
            const spacing = 20; // í˜•ìƒ ê°„ ìµœì†Œ ê°„ê²© (mm)

            let successCount = 0;
            let totalAttempts = 0;

            for (let i = 0; i < count; i++) {
                let shapeType = type;
                if (type === 'mixed') {
                    const types = ['rectangle', 'triangle', 'polygon', 'lshape'];
                    shapeType = types[Math.floor(Math.random() * types.length)];
                }

                let shape = null;
                let retries = 0;

                // ê²¹ì¹˜ì§€ ì•ŠëŠ” ìœ„ì¹˜ ì°¾ê¸°
                while (retries < maxRetries) {
                    totalAttempts++;
                    const candidate = generateRandomShape(shapeType, minSize, maxSize, successCount);

                    if (candidate && !isOverlapping(candidate, spacing)) {
                        shape = candidate;
                        break;
                    }
                    retries++;
                }

                if (shape) {
                    shapes.push(shape);
                    successCount++;
                }
            }

            // í˜•ìƒ ID ì¬ì •ë ¬
            shapes.forEach((s, idx) => s.id = idx + 1);

            updateCanvas();
            updateResults();
            updateSimStats();

            // ìƒì„± ê²°ê³¼ ì•Œë¦¼
            if (successCount < count) {
                console.log(`${count}ê°œ ìš”ì²­ ì¤‘ ${successCount}ê°œ ìƒì„± (ê³µê°„ ë¶€ì¡±)`);
            }
        }

        // í˜•ìƒ ê²¹ì¹¨ ê²€ì‚¬
        function isOverlapping(newShape, spacing) {
            const newBBox = getBoundingBox(newShape.points, spacing);

            for (const existingShape of shapes) {
                const existingBBox = getBoundingBox(existingShape.points, spacing);

                // Bounding Box ê²¹ì¹¨ ê²€ì‚¬
                if (bboxOverlap(newBBox, existingBBox)) {
                    // ë” ì •ë°€í•œ í´ë¦¬ê³¤ ê²¹ì¹¨ ê²€ì‚¬
                    if (polygonsOverlap(newShape.points, existingShape.points)) {
                        return true;
                    }
                }
            }
            return false;
        }

        // Bounding Box ê³„ì‚°
        function getBoundingBox(points, padding = 0) {
            const xs = points.map(p => p.x);
            const ys = points.map(p => p.y);
            return {
                minX: Math.min(...xs) - padding,
                maxX: Math.max(...xs) + padding,
                minY: Math.min(...ys) - padding,
                maxY: Math.max(...ys) + padding
            };
        }

        // Bounding Box ê²¹ì¹¨ ê²€ì‚¬
        function bboxOverlap(a, b) {
            return !(a.maxX < b.minX || a.minX > b.maxX ||
                     a.maxY < b.minY || a.minY > b.maxY);
        }

        // í´ë¦¬ê³¤ ê²¹ì¹¨ ê²€ì‚¬ (Separating Axis Theorem ê°„ì†Œí™”)
        function polygonsOverlap(poly1, poly2) {
            // í•œ í´ë¦¬ê³¤ì˜ ì ì´ ë‹¤ë¥¸ í´ë¦¬ê³¤ ë‚´ë¶€ì— ìˆëŠ”ì§€ ê²€ì‚¬
            for (const p of poly1) {
                if (pointInPolygon(p, poly2)) return true;
            }
            for (const p of poly2) {
                if (pointInPolygon(p, poly1)) return true;
            }

            // ë³€ êµì°¨ ê²€ì‚¬
            for (let i = 0; i < poly1.length; i++) {
                const a1 = poly1[i];
                const a2 = poly1[(i + 1) % poly1.length];
                for (let j = 0; j < poly2.length; j++) {
                    const b1 = poly2[j];
                    const b2 = poly2[(j + 1) % poly2.length];
                    if (lineSegmentsIntersect(a1, a2, b1, b2)) return true;
                }
            }

            return false;
        }

        // ì ì´ í´ë¦¬ê³¤ ë‚´ë¶€ì— ìˆëŠ”ì§€ ê²€ì‚¬ (Ray casting)
        function pointInPolygon(point, polygon) {
            let inside = false;
            const n = polygon.length;

            for (let i = 0, j = n - 1; i < n; j = i++) {
                const xi = polygon[i].x, yi = polygon[i].y;
                const xj = polygon[j].x, yj = polygon[j].y;

                if (((yi > point.y) !== (yj > point.y)) &&
                    (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi)) {
                    inside = !inside;
                }
            }

            return inside;
        }

        // ì„ ë¶„ êµì°¨ ê²€ì‚¬
        function lineSegmentsIntersect(a1, a2, b1, b2) {
            const d1 = direction(b1, b2, a1);
            const d2 = direction(b1, b2, a2);
            const d3 = direction(a1, a2, b1);
            const d4 = direction(a1, a2, b2);

            if (((d1 > 0 && d2 < 0) || (d1 < 0 && d2 > 0)) &&
                ((d3 > 0 && d4 < 0) || (d3 < 0 && d4 > 0))) {
                return true;
            }

            return false;
        }

        // ë°©í–¥ ê³„ì‚° (ì™¸ì )
        function direction(p1, p2, p3) {
            return (p3.x - p1.x) * (p2.y - p1.y) - (p2.x - p1.x) * (p3.y - p1.y);
        }

        // ëœë¤ í˜•ìƒ ìƒì„±
        function generateRandomShape(type, minSize, maxSize, index) {
            const margin = 50;
            const w = randomBetween(minSize, maxSize);
            const h = randomBetween(minSize, maxSize);

            // ëœë¤ ìœ„ì¹˜ (ê°•íŒ ë‚´)
            const maxX = plate.length - w - margin;
            const maxY = plate.width - h - margin;

            if (maxX < margin || maxY < margin) return null;

            const x = randomBetween(margin, maxX);
            const y = randomBetween(margin, maxY);

            let points = [];
            let shapeName = '';

            switch (type) {
                case 'rectangle':
                    points = [
                        {x: x, y: y},
                        {x: x + w, y: y},
                        {x: x + w, y: y + h},
                        {x: x, y: y + h}
                    ];
                    shapeName = 'ì§ì‚¬ê°í˜•';
                    break;

                case 'triangle':
                    points = [
                        {x: x + w/2, y: y},
                        {x: x + w, y: y + h},
                        {x: x, y: y + h}
                    ];
                    shapeName = 'ì‚¼ê°í˜•';
                    break;

                case 'polygon':
                    const sides = randomBetween(4, 6);
                    const cx = x + w/2;
                    const cy = y + h/2;
                    const r = Math.min(w, h) / 2;
                    for (let i = 0; i < sides; i++) {
                        const angle = (i / sides) * Math.PI * 2 - Math.PI / 2;
                        const px = cx + r * Math.cos(angle) * (0.7 + Math.random() * 0.3);
                        const py = cy + r * Math.sin(angle) * (0.7 + Math.random() * 0.3);
                        points.push({x: px, y: py});
                    }
                    shapeName = `${sides}ê°í˜•`;
                    break;

                case 'lshape':
                    const cutW = w * 0.4;
                    const cutH = h * 0.4;
                    points = [
                        {x: x, y: y},
                        {x: x + w, y: y},
                        {x: x + w, y: y + h - cutH},
                        {x: x + w - cutW, y: y + h - cutH},
                        {x: x + w - cutW, y: y + h},
                        {x: x, y: y + h}
                    ];
                    shapeName = 'Lí˜•';
                    break;
            }

            // ë¬´ê²Œì¤‘ì‹¬ ê³„ì‚°
            const centroid = calculateCentroid(points);
            const area = calculateArea(points);
            const weight = (area / 1000000) * (plate.thickness / 1000) * plate.density;

            return {
                id: index + 1,
                type: shapeName,
                points: points,
                centroid: centroid,
                area: area,
                weight: weight,
                color: `hsla(${randomBetween(200, 240)}, 70%, 60%, 0.5)`
            };
        }

        // ë¬´ê²Œì¤‘ì‹¬ ê³„ì‚° (í´ë¦¬ê³¤)
        function calculateCentroid(points) {
            let cx = 0, cy = 0;
            let area = 0;
            const n = points.length;

            for (let i = 0; i < n; i++) {
                const j = (i + 1) % n;
                const cross = points[i].x * points[j].y - points[j].x * points[i].y;
                area += cross;
                cx += (points[i].x + points[j].x) * cross;
                cy += (points[i].y + points[j].y) * cross;
            }

            area /= 2;
            cx /= (6 * area);
            cy /= (6 * area);

            return {x: Math.abs(cx), y: Math.abs(cy)};
        }

        // ë©´ì  ê³„ì‚° (Shoelace formula)
        function calculateArea(points) {
            let area = 0;
            const n = points.length;

            for (let i = 0; i < n; i++) {
                const j = (i + 1) % n;
                area += points[i].x * points[j].y;
                area -= points[j].x * points[i].y;
            }

            return Math.abs(area / 2);
        }

        // í˜•ìƒ ê·¸ë¦¬ê¸°
        function drawShapes() {
            shapes.forEach(shape => {
                // í˜•ìƒ ì±„ìš°ê¸°
                ctx.beginPath();
                ctx.moveTo(10 + shape.points[0].x * scale, 10 + shape.points[0].y * scale);
                for (let i = 1; i < shape.points.length; i++) {
                    ctx.lineTo(10 + shape.points[i].x * scale, 10 + shape.points[i].y * scale);
                }
                ctx.closePath();
                ctx.fillStyle = shape.color;
                ctx.fill();
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 2;
                ctx.stroke();

                // í”½ì—… ìœ„ì¹˜ (ë¬´ê²Œì¤‘ì‹¬)
                const px = 10 + shape.centroid.x * scale;
                const py = 10 + shape.centroid.y * scale;

                // ì‹­ì í‘œì‹œ
                ctx.strokeStyle = '#dc2626';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(px - 8, py);
                ctx.lineTo(px + 8, py);
                ctx.moveTo(px, py - 8);
                ctx.lineTo(px, py + 8);
                ctx.stroke();

                // ì›
                ctx.beginPath();
                ctx.arc(px, py, 6, 0, Math.PI * 2);
                ctx.fillStyle = '#dc2626';
                ctx.fill();

                // ë²ˆí˜¸
                ctx.fillStyle = '#1f2937';
                ctx.font = 'bold 11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(shape.id, px, py + 20);
            });
        }

        // ê²°ê³¼ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateResults() {
            const tbody = document.getElementById('resultsBody');

            if (shapes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="color: #666;">í˜•ìƒì„ ìƒì„±í•˜ë©´ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</td></tr>';
                return;
            }

            tbody.innerHTML = shapes.map(s => `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.type}</td>
                    <td><strong>${s.centroid.x.toFixed(1)}</strong></td>
                    <td><strong>${s.centroid.y.toFixed(1)}</strong></td>
                    <td>${s.area.toFixed(0)}</td>
                    <td>${s.weight.toFixed(2)}</td>
                    <td>${s.points.length}</td>
                </tr>
            `).join('');

            // ìƒì„¸ ë°ì´í„°
            const detailDiv = document.getElementById('detailData');
            detailDiv.innerHTML = shapes.map(s => {
                const pointsStr = s.points.map((p, i) => `  P${i+1}: (${p.x.toFixed(1)}, ${p.y.toFixed(1)})`).join('\n');
                return `<div style="margin-bottom: 15px; padding: 10px; background: #f1f5f9; border-radius: 5px; border: 1px solid #e5e7eb;">
                    <strong style="color: #2563eb;">[${s.id}] ${s.type}</strong><br>
                    <span style="color: #dc2626; font-weight: bold;">Pickup: (${s.centroid.x.toFixed(1)}, ${s.centroid.y.toFixed(1)})</span><br>
                    <span style="color: #666;">ì¢Œí‘œ:</span><br>
                    <pre style="margin: 5px 0; color: #555;">${pointsStr}</pre>
                </div>`;
            }).join('');
        }

        // ì‹œë®¬ë ˆì´ì…˜ í†µê³„
        function updateSimStats() {
            const totalArea = shapes.reduce((sum, s) => sum + s.area, 0);
            const totalWeight = shapes.reduce((sum, s) => sum + s.weight, 0);
            const plateArea = plate.width * plate.length;
            const utilization = (totalArea / plateArea) * 100;

            document.getElementById('totalShapes').textContent = shapes.length;
            document.getElementById('totalCutArea').textContent = (totalArea / 1000000).toFixed(3);
            document.getElementById('totalCutWeight').textContent = totalWeight.toFixed(2);
            document.getElementById('utilizationRate').textContent = utilization.toFixed(1);
        }

        // ì´ˆê¸°í™”
        function clearShapes() {
            shapes = [];
            updateCanvas();
            updateResults();
            updateSimStats();
        }

        // CSV ë‚´ë³´ë‚´ê¸°
        function exportData() {
            if (shapes.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            let csv = 'No,Type,Pickup_X,Pickup_Y,Area_mm2,Weight_kg,Vertices\n';
            shapes.forEach(s => {
                csv += `${s.id},${s.type},${s.centroid.x.toFixed(1)},${s.centroid.y.toFixed(1)},${s.area.toFixed(0)},${s.weight.toFixed(2)},${s.points.length}\n`;
            });

            navigator.clipboard.writeText(csv).then(() => {
                alert('CSV ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        // JSON ë‚´ë³´ë‚´ê¸°
        function exportJSON() {
            if (shapes.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const data = {
                plate: plate,
                shapes: shapes.map(s => ({
                    id: s.id,
                    type: s.type,
                    pickup: {x: parseFloat(s.centroid.x.toFixed(1)), y: parseFloat(s.centroid.y.toFixed(1))},
                    area: parseFloat(s.area.toFixed(0)),
                    weight: parseFloat(s.weight.toFixed(2)),
                    vertices: s.points.map(p => ({x: parseFloat(p.x.toFixed(1)), y: parseFloat(p.y.toFixed(1))}))
                }))
            };

            const json = JSON.stringify(data, null, 2);
            navigator.clipboard.writeText(json).then(() => {
                alert('JSON ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ìœ í‹¸ë¦¬í‹°
        function randomBetween(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>
