# 갠트리 XYZ-R T-bar 용접 시각화 요구사항

## 1. 시스템 개요
- XYZ 선형축 위에 R축이 설치된 갠트리 구조이며, R축 바디에 두 대의 로봇이 부착되어 각자 한 개의 토치를 운용한다.
- 목적은 다양한 용접 모션 케이스를 여러 이해관계자가 직관적으로 검토할 수 있는 시각화/시뮬레이션 플랫폼을 구축하는 것이다.
- 주요 용접 대상은 z축 방향으로 세워진 T-bar(ㅗ 형태)이며, 용접선은 x축 진행방향을 따른다. 갠트리 이동(X/Y/Z)과 R축 회전이 결합되어 용접을 수행한다.

## 2. 좌표계 및 기준
- T-bar가 놓인 정반 좌표계를 절대 기준으로 사용하며 오른손 좌표계를 따른다. 이 좌표계의 x축, y축은 각각 갠트리 X, Y축과 일치하며 Z 성분도 존재할 수 있다.
- R축 중심 좌표 = `(Gantry_X, Gantry_Y, Gantry_Z)`이며, R축은 용접선(웹)과 항상 수직으로 정렬된 상태에서 회전한다.
- 터치 센싱으로 XYZ 오차를 보정할 수 있으며, 시퀀스 상 R축이 먼저 정렬되고 이어서 갠트리가 따라간다.

## 3. 로봇·바디 배치
- R축 하단에 하나의 바디가 있고, 이 바디 양쪽에 로봇이 설치된다.
  ```
  ├─ Robot1 (R축 중심에서 +488 mm)
  └─ Robot2 (R축 중심에서 -488 mm)
  ```
- 바디를 선 또는 박스로 표현하면 직관성이 높아지며, R축 회전에 따라 바디 전체와 두 로봇이 동일한 각도로 기울어진 상태를 유지한다.
- R축 회전 범위는 ±100°이며 기본적으로 직선 용접 동안 한 번만 회전한다. 회전 후에는 갠트리 XYZ 이동이 주 모션이 되고 로봇은 위빙 및 ABB WeldGuide 보정만 수행한다.

## 4. 용접 시나리오
- 두 로봇은 T-bar 웹의 양쪽 면을 '동시 또는 교대' 방식으로 용접한다.
- 기본 패턴(Option A): 웹 두께 12T 기준으로 각 로봇이 한쪽 모서리에서 6 mm 이동 후 1500 mm 직선 용접, 다시 6 mm 마감 구간을 진행한다.
- Option B: T-bar 좌우 대칭 소재에도 대응하며 일반적으로 교차 용접을 채택한다.
- 초기 구간과 종료 구간에서는 로봇이 추가 자세 제어를 하고, 본 용접 구간에서는 갠트리 이동이 주된 진행축이다.

## 5. R축 회전 및 스왑 조건
- R축 = 용접선에 수직한 구조물로 유지되어야 하며, 평면도 기준 T-bar 웹 중심에 위치한다.
- 회전 예시
  - R = 0°: 웹이 Y축과 수직
  - R = 45°: 웹이 45° 회전
  - R = 90°: 웹이 X축과 평행
- R축 회전이 ±100° 제한을 초과할 위험이 있는 경우 로봇 담당 면을 스왑한다. 실무 조건: 스타트 포인트의 X값이 엔드 포인트 X값보다 큰 경우 스왑이 필요하다.
- 스왑 후에도 로봇1은 웹 기준 좌측, 로봇2는 우측이라는 논리를 유지해야 하며, 회전각이 커져도 R축 구조물과 용접선은 수직 관계를 유지해야 한다.

## 6. 시각화 요구사항
- TCP 경로 표기
- R축 회전각도 및 방향 표기
- 갠트리 이동 vs 로봇 자체 모션 구분
- 위빙 경로 가시화
- 비전으로 얻는 4개 포인트(스타트/엔드 각각 2개) 하이라이트
- T-bar 형상(평판 + 세워진 웹) 오버레이, ㅗ 형태 유지
- 토치 자세를 방향 벡터로 표현
- R축 바디와 두 로봇이 함께 회전하는 모습을 전체 뷰에서 확인 가능하도록 카메라 구성을 개선(현재 Robot2가 자주 화면에서 잘림).

## 7. 비전·데이터 입력
- 비전 계측으로 T-bar의 네 개 포인트(스타트 2개, 엔드 2개)를 입력받으며, 각 포인트는 XYZ 성분을 가진다.
- CSV 등 데이터 소스에 이 네 포인트를 기록하고, 중간 경로는 알고리즘으로 자동 계산한다.
- R축 센서는 T-bar 벽 중심에 위치하도록 계획되어 있으며, 해당 센싱 정보로 용접선 방향을 정의한다.

## 8. 추가 설계 메모
- R축 높이는 지면에서 약 1200 mm이며 항상 용접선에 수직으로 초기 정렬한다.
- 평면도에서는 모든 요소가 표시되도록 배치/스케일을 조정하고, 정면도에서는 웹이 바닥 아래로 과도하게 내려가지 않도록 ㅗ형상 비율을 유지한다.
- 바닥면(FL)과 평판 상면, 그리고 웹의 상대적 위치가 명확히 드러나야 시각적으로 혼동이 없다.

## 9. 열려 있는 확인 항목
- 시각화 구현이 위 요구사항을 충족하는지 검증 필요(현재 "아니요" 상태).
- 회전 스왑 로직이 실제 시뮬레이션 상에서 R축 구조물과 용접선의 수직 조건을 지키는지 재확인.
- CSV 입력 포맷, 중간 포인트 계산식, 터치 센싱 보정 적용 방식 도출 필요.

위 내용을 기준으로 플랫폼 요구사항 및 시뮬레이션 가이드를 계속 보완한다.
