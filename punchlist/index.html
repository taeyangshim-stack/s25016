<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S25016 í€ì¹˜ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</title>

    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="../shared/styles/variables.css">
    <link rel="stylesheet" href="../shared/styles/reset.css">
    <link rel="stylesheet" href="../shared/styles/components.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: var(--space-5);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .header {
            background: var(--color-primary-gradient);
            color: var(--color-white);
            padding: var(--space-10);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: var(--space-3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-5);
            padding: var(--space-8);
            background: var(--color-gray-50);
        }

        .stat-card {
            background: var(--color-white);
            padding: var(--space-6);
            border-radius: var(--border-radius-lg);
            text-align: center;
            border-left: 4px solid var(--color-primary);
            transition: var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: var(--font-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
        }

        .stat-label {
            font-size: var(--font-sm);
            color: var(--color-gray-600);
        }

        .filter-bar {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-6);
            background: var(--color-white);
            border-bottom: 2px solid var(--color-gray-200);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .filter-group label {
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
        }

        .filter-group select,
        .filter-group input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius-base);
            font-size: var(--font-sm);
        }

        .content {
            padding: var(--space-8);
        }

        .table-container {
            overflow-x: auto;
            margin-top: var(--space-6);
        }

        .issue-table {
            width: 100%;
            border-collapse: collapse;
        }

        .issue-table th {
            background: var(--color-gray-100);
            padding: var(--space-4);
            text-align: left;
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
            border-bottom: 2px solid var(--color-gray-300);
            position: sticky;
            top: 0;
        }

        .issue-table td {
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-gray-200);
        }

        .issue-table tr:hover {
            background: var(--color-gray-50);
        }

        .issue-id {
            font-family: var(--font-mono);
            font-weight: var(--font-semibold);
            color: var(--color-primary);
        }

        .issue-title {
            font-weight: var(--font-medium);
            color: var(--color-gray-900);
        }

        .badge {
            display: inline-block;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--border-radius-full);
            font-size: var(--font-xs);
            font-weight: var(--font-semibold);
            color: var(--color-white);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-6);
        }

        .loading {
            text-align: center;
            padding: var(--space-10);
            color: var(--color-gray-500);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-16);
            color: var(--color-gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ S25016 í€ì¹˜ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</h1>
            <p>í”„ë¡œì íŠ¸ ì´ìŠˆ ì¶”ì  ë° ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ì „ì²´ ì´ìŠˆ</div>
            </div>
            <div class="stat-card" style="border-left-color: #f59e0b;">
                <div class="stat-number" style="color: #f59e0b;" id="progressCount">0</div>
                <div class="stat-label">ì§„í–‰ì¤‘</div>
            </div>
            <div class="stat-card" style="border-left-color: #6b7280;">
                <div class="stat-number" style="color: #6b7280;" id="pendingCount">0</div>
                <div class="stat-label">ë³´ë¥˜</div>
            </div>
            <div class="stat-card" style="border-left-color: #10b981;">
                <div class="stat-number" style="color: #10b981;" id="completeCount">0</div>
                <div class="stat-label">ì™„ë£Œ</div>
            </div>
            <div class="stat-card" style="border-left-color: #dc2626;">
                <div class="stat-number" style="color: #dc2626;" id="overdueCount">0</div>
                <div class="stat-label">ì§€ì—°</div>
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-group">
                <label>ë¶„ë¥˜</label>
                <select id="filterCategory">
                    <option value="all">ì „ì²´</option>
                    <option value="ê¸°ê³„">ê¸°ê³„</option>
                    <option value="ì „ê¸°">ì „ê¸°</option>
                    <option value="ì œì–´">ì œì–´</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ì„¸ë¶€ë¶„ë¥˜</label>
                <select id="filterSubcategory">
                    <option value="all">ì „ì²´</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ìƒíƒœ</label>
                <select id="filterStatus">
                    <option value="all">ì „ì²´</option>
                    <option value="ì‹ ê·œ">ì‹ ê·œ</option>
                    <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                    <option value="ë³´ë¥˜">ë³´ë¥˜</option>
                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                    <option value="ê²€ì¦ì¤‘">ê²€ì¦ì¤‘</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ìš°ì„ ìˆœìœ„</label>
                <select id="filterPriority">
                    <option value="all">ì „ì²´</option>
                    <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                    <option value="ë†’ìŒ">ë†’ìŒ</option>
                    <option value="ë³´í†µ">ë³´í†µ</option>
                    <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                </select>
            </div>

            <div class="filter-group">
                <label>ë‹´ë‹¹ì</label>
                <select id="filterOwner">
                    <option value="all">ì „ì²´</option>
                </select>
            </div>

            <div class="filter-group" style="flex: 1; min-width: 200px;">
                <label>ê²€ìƒ‰</label>
                <input type="text" id="searchInput" placeholder="ì œëª©, ë‚´ìš©, ID ê²€ìƒ‰...">
            </div>
        </div>

        <div class="content">
            <div class="action-buttons">
                <a href="pages/create.html" class="btn btn-primary">
                    â• ìƒˆ ì´ìŠˆ ë“±ë¡
                </a>
                <a href="pages/list.html" class="btn btn-secondary">
                    ğŸ“‹ ì „ì²´ ëª©ë¡ ë³´ê¸°
                </a>
                <button class="btn btn-outline" onclick="refreshIssues()">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
                <div style="position: relative; display: inline-block;">
                    <button class="btn btn-outline" onclick="toggleAdminMenu()">
                        âš™ï¸ ê´€ë¦¬
                    </button>
                    <div id="adminMenu" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 5px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 100; min-width: 180px;">
                        <a href="pages/admin/categories.html" style="display: block; padding: 12px 16px; color: #374151; text-decoration: none; border-bottom: 1px solid #f3f4f6;">
                            ğŸ“‚ êµ¬ë¶„ ê´€ë¦¬
                        </a>
                        <a href="pages/admin/owners.html" style="display: block; padding: 12px 16px; color: #374151; text-decoration: none;">
                            ğŸ‘¥ ë‹´ë‹¹ì ê´€ë¦¬
                        </a>
                    </div>
                </div>
                <a href="/index.html" class="btn btn-outline">
                    ğŸ  ë©”ì¸ ëŒ€ì‹œë³´ë“œ
                </a>
            </div>

            <div id="loadingState" class="loading">
                <div>â³ ì´ìŠˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">ğŸ“‹</div>
                <h3>ë“±ë¡ëœ ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ìƒˆ ì´ìŠˆë¥¼ ë“±ë¡í•˜ì—¬ í”„ë¡œì íŠ¸ ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”</p>
                <a href="pages/create.html" class="btn btn-primary" style="margin-top: var(--space-4);">
                    â• ì²« ì´ìŠˆ ë“±ë¡í•˜ê¸°
                </a>
            </div>

            <div id="tableContainer" class="table-container" style="display: none;">
                <table class="issue-table">
                    <thead>
                        <tr>
                            <th style="width: 120px;">ID</th>
                            <th>ì œëª©</th>
                            <th style="width: 100px;">ë¶„ë¥˜</th>
                            <th style="width: 100px;">ì„¸ë¶€ë¶„ë¥˜</th>
                            <th style="width: 80px;">ìš°ì„ ìˆœìœ„</th>
                            <th style="width: 80px;">ìƒíƒœ</th>
                            <th style="width: 100px;">ë‹´ë‹¹ì</th>
                            <th style="width: 100px;">ëª©í‘œì¼</th>
                        </tr>
                    </thead>
                    <tbody id="issueTableBody">
                        <!-- ë™ì  ìƒì„± -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="../shared/scripts/utils.js"></script>
    <script src="scripts/punchlist.js"></script>
    <script>
        let allIssues = [];
        let filteredIssues = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            initFilters();
            loadIssues();

            // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('filterCategory').addEventListener('change', onFilterChange);
            document.getElementById('filterSubcategory').addEventListener('change', applyFilters);
            document.getElementById('filterStatus').addEventListener('change', applyFilters);
            document.getElementById('filterPriority').addEventListener('change', applyFilters);
            document.getElementById('filterOwner').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        });

        // í•„í„° ì´ˆê¸°í™”
        function initFilters() {
            // ë‹´ë‹¹ì ì˜µì…˜
            const ownerSelect = document.getElementById('filterOwner');
            PunchListAPI.OWNERS.forEach(owner => {
                const option = document.createElement('option');
                option.value = owner;
                option.textContent = owner;
                ownerSelect.appendChild(option);
            });
        }

        // ë¶„ë¥˜ ë³€ê²½ ì‹œ ì„¸ë¶€ë¶„ë¥˜ ì—…ë°ì´íŠ¸
        function onFilterChange() {
            const category = document.getElementById('filterCategory').value;
            const subcategorySelect = document.getElementById('filterSubcategory');

            subcategorySelect.innerHTML = '<option value="all">ì „ì²´</option>';

            if (category !== 'all' && PunchListAPI.CATEGORIES[category]) {
                PunchListAPI.CATEGORIES[category].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subcategorySelect.appendChild(option);
                });
            }

            applyFilters();
        }

        // ì´ìŠˆ ë¡œë“œ
        async function loadIssues() {
            try {
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('tableContainer').style.display = 'none';
                document.getElementById('emptyState').style.display = 'none';

                allIssues = await PunchListAPI.loadAllIssues();
                filteredIssues = [...allIssues];

                if (allIssues.length === 0) {
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('emptyState').style.display = 'block';
                } else {
                    updateStats();
                    applyFilters();
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('tableContainer').style.display = 'block';
                }
            } catch (error) {
                console.error('ì´ìŠˆ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì´ìŠˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Google Sheets ì—°ë™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                document.getElementById('loadingState').innerHTML = '<div style="color: #dc2626;">âŒ ì´ìŠˆ ë¡œë“œ ì‹¤íŒ¨</div>';
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const stats = PunchListAPI.calculateStats(allIssues);

            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('progressCount').textContent = stats.byStatus['ì§„í–‰ì¤‘'] || 0;
            document.getElementById('pendingCount').textContent = stats.byStatus['ë³´ë¥˜'] || 0;
            document.getElementById('completeCount').textContent = stats.byStatus['ì™„ë£Œ'] || 0;
            document.getElementById('overdueCount').textContent = stats.overdue;
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const filters = {
                category: document.getElementById('filterCategory').value,
                subcategory: document.getElementById('filterSubcategory').value,
                status: document.getElementById('filterStatus').value,
                priority: document.getElementById('filterPriority').value,
                owner: document.getElementById('filterOwner').value,
                search: document.getElementById('searchInput').value
            };

            filteredIssues = PunchListAPI.filterIssues(allIssues, filters);
            filteredIssues = PunchListAPI.sortIssues(filteredIssues, 'priority', 'asc');

            renderTable();
        }

        // í…Œì´ë¸” ë Œë”ë§
        function renderTable() {
            const tbody = document.getElementById('issueTableBody');
            tbody.innerHTML = '';

            if (filteredIssues.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #6b7280;">í•„í„° ì¡°ê±´ì— ë§ëŠ” ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            filteredIssues.forEach(issue => {
                const row = document.createElement('tr');
                row.style.cursor = 'pointer';
                row.onclick = () => window.location.href = `pages/detail.html?id=${issue.id}`;

                row.innerHTML = `
                    <td class="issue-id">${issue.id}</td>
                    <td class="issue-title">${issue.title}</td>
                    <td>${issue.category}</td>
                    <td>${issue.subcategory}</td>
                    <td>${PunchListAPI.getPriorityBadge(issue.priority)}</td>
                    <td>${PunchListAPI.getStatusBadge(issue.status)}</td>
                    <td>${issue.owner}</td>
                    <td>${PunchListAPI.formatDate(issue.target_date)}</td>
                `;

                tbody.appendChild(row);
            });
        }

        // ìƒˆë¡œê³ ì¹¨
        function refreshIssues() {
            loadIssues();
        }

        // ê´€ë¦¬ ë©”ë‰´ í† ê¸€
        function toggleAdminMenu() {
            const menu = document.getElementById('adminMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('adminMenu');
            const btn = e.target.closest('button');
            if (menu && !btn) {
                menu.style.display = 'none';
            }
        });
    </script>
</body>
</html>
