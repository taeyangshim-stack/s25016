<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ì´ìŠˆ ë“±ë¡ - S25016 í€ì¹˜ë¦¬ìŠ¤íŠ¸</title>

    <link rel="stylesheet" href="../../shared/styles/variables.css">
    <link rel="stylesheet" href="../../shared/styles/reset.css">
    <link rel="stylesheet" href="../../shared/styles/components.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: var(--space-5);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .header {
            background: var(--color-primary-gradient);
            color: var(--color-white);
            padding: var(--space-8);
            text-align: center;
        }

        .form-content {
            padding: var(--space-8);
        }

        .form-group {
            margin-bottom: var(--space-6);
        }

        .form-group label {
            display: block;
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
            color: var(--color-gray-700);
        }

        .form-group label .required {
            color: var(--color-danger);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius-base);
            font-size: var(--font-base);
            transition: var(--transition-base);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .button-group {
            display: flex;
            gap: var(--space-4);
            margin-top: var(--space-8);
        }

        .helper-text {
            font-size: var(--font-sm);
            color: var(--color-gray-500);
            margin-top: var(--space-2);
        }

        .section-title {
            font-size: var(--font-lg);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
            margin: var(--space-8) 0 var(--space-4);
            padding-bottom: var(--space-2);
            border-bottom: 2px solid var(--color-gray-200);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>â• ìƒˆ ì´ìŠˆ ë“±ë¡</h1>
            <p>í€ì¹˜ë¦¬ìŠ¤íŠ¸ì— ìƒˆë¡œìš´ ì´ìŠˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤</p>
        </div>

        <div class="form-content">
            <form id="createIssueForm">
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</div>

                <div class="form-group">
                    <label>ì œëª© <span class="required">*</span></label>
                    <input type="text" id="title" name="title" required placeholder="ì´ìŠˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ë¶„ë¥˜ <span class="required">*</span></label>
                        <select id="category" name="category" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê¸°ê³„">ğŸ”§ ê¸°ê³„</option>
                            <option value="ì „ê¸°">âš¡ ì „ê¸°</option>
                            <option value="ì œì–´">ğŸ’» ì œì–´</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ì„¸ë¶€ë¶„ë¥˜ <span class="required">*</span></label>
                        <select id="subcategory" name="subcategory" required>
                            <option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ìš°ì„ ìˆœìœ„ <span class="required">*</span></label>
                        <select id="priority" name="priority" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê¸´ê¸‰">ğŸš¨ ê¸´ê¸‰</option>
                            <option value="ë†’ìŒ">âš ï¸ ë†’ìŒ</option>
                            <option value="ë³´í†µ">â„¹ï¸ ë³´í†µ</option>
                            <option value="ë‚®ìŒ">â– ë‚®ìŒ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ìƒíƒœ</label>
                        <select id="status" name="status">
                            <option value="ì‹ ê·œ" selected>ì‹ ê·œ</option>
                            <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                            <option value="ë³´ë¥˜">ë³´ë¥˜</option>
                            <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                            <option value="ê²€ì¦ì¤‘">ê²€ì¦ì¤‘</option>
                        </select>
                    </div>
                </div>

                <!-- ë¬¸ì œ ìƒí™© -->
                <div class="section-title">ğŸ“ ë¬¸ì œ ìƒí™©</div>

                <div class="form-group">
                    <label>ë¬¸ì œ ìƒí™© <span class="required">*</span></label>
                    <textarea id="description" name="description" required placeholder="ë¬¸ì œ ìƒí™©ì„ ìƒì„¸íˆ ê¸°ìˆ í•˜ì„¸ìš”"></textarea>
                    <div class="helper-text">ë°œìƒí•œ ë¬¸ì œì˜ í˜„ìƒê³¼ ì˜í–¥ì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”</div>
                </div>

                <div class="form-group">
                    <label>ì›ì¸ ë¶„ì„</label>
                    <textarea id="cause" name="cause" placeholder="ë¬¸ì œì˜ ì›ì¸ì„ ë¶„ì„í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <!-- ì¡°ì¹˜ ê³„íš -->
                <div class="section-title">ğŸ”§ ì¡°ì¹˜ ê³„íš ë° ê²°ê³¼</div>

                <div class="form-group">
                    <label>ì¡°ì¹˜ ê³„íš</label>
                    <textarea id="action_plan" name="action_plan" placeholder="ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì¡°ì¹˜ ê³„íšì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label>ì¡°ì¹˜ ê²°ê³¼</label>
                    <textarea id="action_result" name="action_result" placeholder="ì¡°ì¹˜ë¥¼ ì‹¤í–‰í•œ í›„ ê²°ê³¼ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <!-- ë‹´ë‹¹ ì •ë³´ -->
                <div class="section-title">ğŸ‘¥ ë‹´ë‹¹ ì •ë³´</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ë‹´ë‹¹ì <span class="required">*</span></label>
                        <select id="owner" name="owner" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ìŠ¹ì¸ì</label>
                        <select id="approver" name="approver">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>í˜‘ì˜ì</label>
                    <input type="text" id="collaborators" name="collaborators" placeholder="í˜‘ì˜ìë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ì˜ˆ: ê¹€ì² ìˆ˜, ë°•ì˜í¬)">
                    <div class="helper-text">ì—¬ëŸ¬ ëª…ì¸ ê²½ìš° ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì„¸ìš”</div>
                </div>

                <!-- ì¼ì • ì •ë³´ -->
                <div class="section-title">ğŸ“… ì¼ì • ì •ë³´</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ìš”ì²­ì¼ <span class="required">*</span></label>
                        <input type="date" id="request_date" name="request_date" required>
                    </div>

                    <div class="form-group">
                        <label>ëª©í‘œ ì™„ë£Œì¼ <span class="required">*</span></label>
                        <input type="date" id="target_date" name="target_date" required>
                    </div>

                    <div class="form-group">
                        <label>ì‹¤ì œ ì™„ë£Œì¼</label>
                        <input type="date" id="complete_date" name="complete_date">
                    </div>
                </div>

                <!-- ë²„íŠ¼ -->
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        âœ… ì´ìŠˆ ë“±ë¡
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        ğŸ”„ ì´ˆê¸°í™”
                    </button>
                    <a href="../index.html" class="btn btn-outline">
                        âŒ ì·¨ì†Œ
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script src="../../shared/scripts/utils.js"></script>
    <script src="../scripts/punchlist.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            initForm();
            setDefaultDates();

            // ë¶„ë¥˜ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('category').addEventListener('change', updateSubcategories);

            // í¼ ì œì¶œ ì´ë²¤íŠ¸
            document.getElementById('createIssueForm').addEventListener('submit', handleSubmit);
        });

        // í¼ ì´ˆê¸°í™”
        function initForm() {
            // ë‹´ë‹¹ì ì˜µì…˜
            const ownerSelect = document.getElementById('owner');
            const approverSelect = document.getElementById('approver');

            PunchListAPI.OWNERS.forEach(owner => {
                const option1 = document.createElement('option');
                option1.value = owner;
                option1.textContent = owner;
                ownerSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = owner;
                option2.textContent = owner;
                approverSelect.appendChild(option2);
            });
        }

        // ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            const oneWeekLater = new Date();
            oneWeekLater.setDate(oneWeekLater.getDate() + 7);
            const targetDate = oneWeekLater.toISOString().split('T')[0];

            document.getElementById('request_date').value = today;
            document.getElementById('target_date').value = targetDate;
        }

        // ì„¸ë¶€ë¶„ë¥˜ ì—…ë°ì´íŠ¸
        function updateSubcategories() {
            const category = document.getElementById('category').value;
            const subcategorySelect = document.getElementById('subcategory');

            subcategorySelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';

            if (category && PunchListAPI.CATEGORIES[category]) {
                PunchListAPI.CATEGORIES[category].forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub;
                    option.textContent = sub;
                    subcategorySelect.appendChild(option);
                });
            }
        }

        // í¼ ì œì¶œ
        async function handleSubmit(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const issueData = Object.fromEntries(formData.entries());

            // ë¹ˆ ê°’ ì²˜ë¦¬
            Object.keys(issueData).forEach(key => {
                if (!issueData[key]) {
                    issueData[key] = '';
                }
            });

            try {
                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'â³ ë“±ë¡ ì¤‘...';

                await PunchListAPI.createIssue(issueData);

                alert('âœ… ì´ìŠˆê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                window.location.href = '../index.html';
            } catch (error) {
                console.error('ì´ìŠˆ ë“±ë¡ ì‹¤íŒ¨:', error);
                alert('âŒ ì´ìŠˆ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');

                const submitButton = e.target.querySelector('button[type="submit"]');
                submitButton.disabled = false;
                submitButton.textContent = 'âœ… ì´ìŠˆ ë“±ë¡';
            }
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            if (confirm('ì…ë ¥í•œ ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('createIssueForm').reset();
                setDefaultDates();
                document.getElementById('subcategory').innerHTML = '<option value="">ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
            }
        }
    </script>
</body>
</html>
