<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ìŠˆ ëª©ë¡ - S25016 í€ì¹˜ë¦¬ìŠ¤íŠ¸</title>

    <link rel="stylesheet" href="../../shared/styles/variables.css">
    <link rel="stylesheet" href="../../shared/styles/reset.css">
    <link rel="stylesheet" href="../../shared/styles/components.css">

    <style>
        body {
            background: var(--color-gray-50);
            min-height: 100vh;
            padding: var(--space-5);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--color-white);
            padding: var(--space-6);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .header h1 {
            font-size: var(--font-2xl);
            color: var(--color-gray-900);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
        }

        .stat-card {
            background: var(--color-gray-50);
            padding: var(--space-4);
            border-radius: var(--border-radius-base);
            text-align: center;
            position: relative;
        }

        .stat-number {
            font-size: var(--font-2xl);
            font-weight: var(--font-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-1);
        }

        .stat-total {
            font-size: var(--font-sm);
            color: var(--color-gray-500);
            margin-left: 6px;
        }

        .stat-delta {
            font-size: var(--font-xs);
            font-weight: var(--font-semibold);
            color: var(--color-gray-500);
        }

        .stat-delta.positive {
            color: #16a34a;
        }

        .stat-delta.negative {
            color: #dc2626;
        }

        .stat-card-clickable {
            cursor: pointer;
            transition: box-shadow 0.2s ease, transform 0.2s ease;
        }

        .stat-card-clickable:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-note {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
            text-align: right;
            margin-top: var(--space-2);
        }

        .stat-label {
            font-size: var(--font-sm);
            color: var(--color-gray-600);
        }

        .filters {
            background: var(--color-white);
            padding: var(--space-5);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
            margin-bottom: var(--space-2);
        }

        .filter-group select,
        .filter-group input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius-base);
            font-size: var(--font-base);
        }

        .filter-actions {
            display: flex;
            gap: var(--space-3);
        }

        .table-container {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .table-header {
            padding: var(--space-5);
            border-bottom: 1px solid var(--color-gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: var(--font-lg);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
        }

        .table-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .view-toggle {
            display: inline-flex;
            padding: 4px;
            background: var(--color-gray-50);
            border-radius: var(--border-radius-full);
            border: 1px solid var(--color-gray-200);
        }

        .view-btn {
            border: none;
            background: transparent;
            padding: 6px 14px;
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
            border-radius: var(--border-radius-full);
            cursor: pointer;
            color: var(--color-gray-500);
            transition: all 0.2s ease;
        }

        .view-btn.active {
            background: var(--color-white);
            color: var(--color-gray-900);
            box-shadow: var(--shadow-sm);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .hidden {
            display: none !important;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: var(--space-4);
            padding: var(--space-5);
        }

        .matrix-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: var(--space-4);
            padding: var(--space-5);
        }

        .matrix-controls {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-2);
            padding: 0 var(--space-5);
            margin-bottom: -var(--space-3);
        }

        .matrix-controls button {
            padding: 4px 10px;
            border: 1px solid var(--color-gray-300);
            background: var(--color-white);
            border-radius: var(--border-radius-full);
            font-size: var(--font-xs);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .matrix-controls button:hover {
            background: var(--color-gray-50);
        }

        .matrix-column {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--color-gray-200);
            padding: var(--space-2) var(--space-3);
            box-shadow: var(--shadow-sm);
        }

        .matrix-column[open] {
            border-color: var(--color-primary-light, #bfdbfe);
        }

        .matrix-column summary {
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-base);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
            cursor: pointer;
            padding: var(--space-1) 0;
        }

        .matrix-column summary::-webkit-details-marker {
            display: none;
        }

        .matrix-column-header span {
            font-size: var(--font-sm);
            color: var(--color-gray-600);
        }

        .matrix-column:not([open]) .matrix-subgrid {
            display: none;
        }

        .matrix-subgrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-3);
        }

        .matrix-cell {
            background: var(--color-gray-50);
            border-radius: var(--border-radius-base);
            border: 1px solid var(--color-gray-200);
            padding: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            min-height: 140px;
        }

        .matrix-cell-hmi {
            border-color: #c084fc;
            box-shadow: 0 0 0 1px #c084fc;
            background: #faf5ff;
        }

        .matrix-cell-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
        }

        .matrix-count {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
            background: var(--color-white);
            border-radius: var(--border-radius-full);
            padding: 2px 6px;
            border: 1px solid var(--color-gray-300);
        }

        .matrix-issue-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .matrix-issue {
            background: var(--color-white);
            border-radius: var(--border-radius-base);
            border: 1px solid var(--color-gray-200);
            padding: var(--space-2);
            font-size: var(--font-xs);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .matrix-issue:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-sm);
        }

        .matrix-issue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
            gap: var(--space-2);
        }

        .matrix-issue-id {
            font-family: 'Consolas', monospace;
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
        }

        .matrix-issue-title {
            font-size: var(--font-xs);
            color: var(--color-gray-800);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .matrix-issue-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
            color: var(--color-gray-500);
        }

        .matrix-priority {
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
        }

        .matrix-empty {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
            text-align: center;
            padding: var(--space-2);
        }

        .matrix-more {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
            text-align: right;
        }

        .issue-card {
            border: 1px solid var(--color-gray-200);
            border-radius: var(--border-radius-lg);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            box-shadow: var(--shadow-sm);
            background: var(--color-white);
            transition: var(--transition-base);
            position: relative;
        }

        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .issue-card.priority-ê¸´ê¸‰ {
            border-left: 4px solid #dc2626;
        }

        .issue-card.priority-ë†’ìŒ {
            border-left: 4px solid #f97316;
        }

        .issue-card.priority-ë³´í†µ {
            border-left: 4px solid #2563eb;
        }

        .issue-card.priority-ë‚®ìŒ {
            border-left: 4px solid #6b7280;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .card-priority {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-weight: var(--font-semibold);
            font-size: var(--font-sm);
        }

        .card-priority::before {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .card-priority-ê¸´ê¸‰::before {
            background: #dc2626;
        }

        .card-priority-ë†’ìŒ::before {
            background: #f97316;
        }

        .card-priority-ë³´í†µ::before {
            background: #2563eb;
        }

        .card-priority-ë‚®ìŒ::before {
            background: #6b7280;
        }

        .card-title {
            font-size: var(--font-base);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
            line-height: 1.5;
        }

        .card-id {
            font-family: 'Consolas', monospace;
            font-size: var(--font-xs);
            color: var(--color-gray-500);
        }

        .card-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-3);
            font-size: var(--font-xs);
            color: var(--color-gray-600);
        }

        .card-meta strong {
            display: block;
            color: var(--color-gray-900);
            margin-bottom: 2px;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .card-line {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--font-xs);
            color: var(--color-gray-600);
        }

        .card-category {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
        }

        .card-dates {
            background: var(--color-gray-50);
            border-radius: var(--border-radius-base);
            padding: var(--space-2) var(--space-3);
            font-size: var(--font-xs);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-3);
        }

        .card-updated {
            font-size: var(--font-xs);
            color: var(--color-gray-500);
        }

        .card-actions {
            display: flex;
            justify-content: flex-end;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--color-gray-50);
        }

        th {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
            font-size: var(--font-sm);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: var(--color-gray-100);
        }

        th .sort-icon {
            margin-left: var(--space-1);
            opacity: 0.5;
        }

        th.sorted .sort-icon {
            opacity: 1;
        }

        tbody tr {
            border-bottom: 1px solid var(--color-gray-100);
            transition: var(--transition-base);
            cursor: pointer;
        }

        tbody tr:hover {
            background: var(--color-gray-50);
        }

        tbody tr.recent-update {
            background: #fef9c3;
        }

        tbody tr.recent-update:hover {
            background: #fef3c7;
        }

        td {
            padding: var(--space-3) var(--space-4);
            font-size: var(--font-sm);
        }

        .badge {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--border-radius-base);
            font-size: var(--font-xs);
            font-weight: var(--font-semibold);
            white-space: nowrap;
        }

        .recent-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: var(--space-1);
            color: #b45309;
            font-size: var(--font-xs);
            font-weight: var(--font-semibold);
        }

        .badge-priority-ê¸´ê¸‰ {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-priority-ë†’ìŒ {
            background: #fed7aa;
            color: #9a3412;
        }

        .badge-priority-ë³´í†µ {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-priority-ë‚®ìŒ {
            background: #e5e7eb;
            color: #4b5563;
        }

        .badge-status-ì‹ ê·œ {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-status-ì§„í–‰ì¤‘ {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-status-ë³´ë¥˜ {
            background: #f3f4f6;
            color: #6b7280;
        }

        .badge-status-ì™„ë£Œ {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-status-ê²€ì¦ì¤‘ {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* ===== ê°€ë…ì„± ê°œì„ : ìš°ì„ ìˆœìœ„ë³„ í–‰ ë°°ê²½ìƒ‰ ===== */
        tbody tr.priority-ê¸´ê¸‰ {
            background: #fef2f2 !important;
            border-left: 4px solid #dc2626;
        }

        tbody tr.priority-ê¸´ê¸‰:hover {
            background: #fee2e2 !important;
        }

        tbody tr.priority-ë†’ìŒ {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }

        tbody tr.priority-ë†’ìŒ:hover {
            background: #fef3c7;
        }

        tbody tr.priority-ë³´í†µ {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }

        tbody tr.priority-ë³´í†µ:hover {
            background: #dbeafe;
        }

        tbody tr.priority-ë‚®ìŒ {
            background: #f9fafb;
            border-left: 4px solid #9ca3af;
        }

        tbody tr.priority-ë‚®ìŒ:hover {
            background: #f3f4f6;
        }

        /* ë¼ì¸ë³„ ìƒ‰ìƒ ë±ƒì§€ */
        .line-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
            display: inline-block;
        }

        .line-badge.badge-Aë¼ì¸ {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        .line-badge.badge-Bë¼ì¸ {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .line-badge.badge-ê³µí†µ {
            background: #e5e7eb;
            color: #374151;
            border: 1px solid #9ca3af;
        }

        .line-badge.badge-A_Bë¼ì¸ {
            background: #dcfce7;
            color: #15803d;
            border: 1px solid #16a34a;
        }

        /* ===== Week 2: í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ê°œì„  ===== */
        /* ìš°ì„ ìˆœìœ„ ì»¬ëŸ¼ - ì•„ì´ì½˜ ì¤‘ì‹¬ */
        .priority-cell {
            text-align: center;
            padding: 8px 4px !important;
        }

        .priority-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .priority-icon {
            font-size: 20px;
            line-height: 1;
        }

        .priority-text {
            font-size: 10px;
            font-weight: 600;
            color: #6b7280;
        }

        /* ID/ì œëª© ì»¬ëŸ¼ - 2ì¤„ ë ˆì´ì•„ì›ƒ */
        .issue-cell {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 12px 16px !important;
        }

        .issue-id {
            font-family: 'Consolas', monospace;
            font-size: 11px;
            color: #6b7280;
            font-weight: 600;
        }

        .issue-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            line-height: 1.4;
            /* 2ì¤„ê¹Œì§€ í‘œì‹œ */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .issue-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 10px;
            padding: 2px 6px;
            background: #f3f4f6;
            border-radius: 8px;
            color: #4b5563;
        }

        /* ë¼ì¸Â·ë¶„ë¥˜ ì»¬ëŸ¼ */
        .line-category-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .line-category-cell .line-badge {
            margin-bottom: 2px;
        }

        .line-category-cell .category-text {
            font-size: 11px;
            color: #6b7280;
        }

        /* ì¼ì • ì»¬ëŸ¼ - í™”ì‚´í‘œ í‘œì‹œ */
        .schedule-cell {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .schedule-date {
            font-weight: 500;
            color: #374151;
        }

        .schedule-arrow {
            color: #9ca3af;
            font-weight: 600;
        }

        .schedule-overdue {
            color: #dc2626;
            font-weight: 600;
        }

        /* ì•¡ì…˜ ì»¬ëŸ¼ */
        .action-cell {
            text-align: center;
            padding: 8px !important;
        }

        .action-btn {
            padding: 4px 12px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #4b5563;
            color: white;
            border-color: #4b5563;
        }

        /* í…Œì´ë¸” í–‰ ë†’ì´ ì¡°ì ˆ */
        tbody tr {
            height: auto;
            min-height: 70px;
        }

        tbody td {
            vertical-align: middle;
        }

        /* í•„í„° í”„ë¦¬ì…‹ ë²„íŠ¼ */
        .filter-presets {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            padding: var(--space-4);
            background: var(--color-gray-50);
            border-radius: var(--border-radius-lg);
            flex-wrap: wrap;
        }

        .preset-btn {
            padding: var(--space-2) var(--space-4);
            background: white;
            border: 2px solid var(--color-gray-300);
            border-radius: var(--border-radius-full);
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
            color: var(--color-gray-700);
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .preset-btn:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .preset-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-4);
            color: var(--color-gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }

        .loading {
            text-align: center;
            padding: var(--space-8);
            color: var(--color-gray-500);
        }

        .overdue {
            color: var(--color-danger);
            font-weight: var(--font-semibold);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-5);
            border-top: 1px solid var(--color-gray-200);
        }

        .pagination button {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--color-gray-300);
            background: var(--color-white);
            border-radius: var(--border-radius-base);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .pagination button:hover:not(:disabled) {
            background: var(--color-gray-50);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: var(--font-sm);
            color: var(--color-gray-600);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="header-top">
                <h1>ğŸ“‹ ì´ìŠˆ ëª©ë¡</h1>
                <div style="display: flex; gap: var(--space-3);">
                    <a href="create.html" class="btn btn-primary">â• ìƒˆ ì´ìŠˆ ë“±ë¡</a>
                    <a href="../index.html" class="btn btn-outline">ğŸ  ëŒ€ì‹œë³´ë“œ</a>
                </div>
            </div>

            <!-- í†µê³„ -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-delta" id="totalDelta">-</div>
                    <div class="stat-label">ì „ì²´ ì´ìŠˆ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="verifyingCount">0</div>
                    <div class="stat-delta" id="verifyingDelta">-</div>
                    <div class="stat-label">ê²€ì¦ì¤‘</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingCount">0</div>
                    <div class="stat-delta" id="pendingDelta">-</div>
                    <div class="stat-label">ë³´ë¥˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="newCount">0</div>
                    <div class="stat-delta" id="newDelta">-</div>
                    <div class="stat-label">ì‹ ê·œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completeCount">0</div>
                    <div class="stat-delta" id="completeDelta">-</div>
                    <div class="stat-label">ì™„ë£Œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="progressCount">0</div>
                    <div class="stat-delta" id="progressDelta">-</div>
                    <div class="stat-label">ì§„í–‰ì¤‘</div>
                </div>
                <div class="stat-card stat-card-clickable" role="button" tabindex="0" onclick="handleOverdueCardClick(event)" onkeydown="if(event.key==='Enter'||event.key===' '){handleOverdueCardClick(event);}">
                    <div class="stat-number">
                        <span id="overdueCount">0</span>
                        <span class="stat-total" id="overduePercent">0%</span>
                    </div>
                    <div class="stat-delta" id="overdueDelta">-</div>
                    <div class="stat-label">ì§€ì—° (ì§„í–‰/ë³´ë¥˜ ë‚´)</div>
                </div>
            </div>
            <div class="stat-note">* ì§€ì—° ì´ìŠˆëŠ” ì§„í–‰/ë³´ë¥˜ ìƒíƒœ ê±´ìˆ˜ ì•ˆì—ì„œ ì¤‘ë³µ ì§‘ê³„ë©ë‹ˆë‹¤.</div>
        </div>

        <!-- í•„í„° -->
        <div class="filters">
            <!-- í•„í„° í”„ë¦¬ì…‹ ë²„íŠ¼ -->
            <div class="filter-presets">
                <button class="preset-btn" data-preset="urgent-b" onclick="applyPreset('urgent-b', this)">
                    ğŸš¨ ê¸´ê¸‰ ì´ìŠˆ (Bë¼ì¸)
                </button>
                <button class="preset-btn" data-preset="overdue" onclick="applyPreset('overdue', this)">
                    âš ï¸ ì§€ì—° ì¤‘ì¸ ì´ìŠˆ
                </button>
                <button class="preset-btn" data-preset="this-week" onclick="applyPreset('this-week', this)">
                    ğŸ“… ì´ë²ˆ ì£¼ ë§ˆê°
                </button>
                <button class="preset-btn" data-preset="all" onclick="resetFilters()">
                    ğŸ”„ ì „ì²´ ë³´ê¸°
                </button>
            </div>

            <div class="filter-row">
                <div class="filter-group">
                    <label>ë¶„ë¥˜</label>
                    <select id="filterCategory">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ë¼ì¸ ë¶„ë¥˜</label>
                    <select id="filterLine">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ì„¸ë¶€ë¶„ë¥˜</label>
                    <select id="filterSubcategory">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ìƒíƒœ</label>
                    <select id="filterStatus">
                        <option value="">ì „ì²´</option>
                        <option value="ì‹ ê·œ">ì‹ ê·œ</option>
                        <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                        <option value="ë³´ë¥˜">ë³´ë¥˜</option>
                        <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                        <option value="ê²€ì¦ì¤‘">ê²€ì¦ì¤‘</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ìš°ì„ ìˆœìœ„</label>
                    <select id="filterPriority">
                        <option value="">ì „ì²´</option>
                        <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                        <option value="ë†’ìŒ">ë†’ìŒ</option>
                        <option value="ë³´í†µ">ë³´í†µ</option>
                        <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ë‹´ë‹¹ì</label>
                    <select id="filterOwner">
                        <option value="">ì „ì²´</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ê²€ìƒ‰</label>
                    <input type="text" id="searchInput" placeholder="ì œëª©, ID ê²€ìƒ‰...">
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-primary" onclick="applyFilters()">ğŸ” ê²€ìƒ‰</button>
                <button class="btn btn-outline" onclick="resetFilters()">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>

            <div class="filter-row" style="margin-top: var(--space-4); border-top: 1px solid var(--color-gray-200); padding-top: var(--space-4);">
                <div class="filter-group">
                    <label>ëª©ë¡ì—ì„œ ìˆ¨ê¸¸ í•­ëª© (ì—´)</label>
                    <select id="excludeSortColumn" onchange="updateExcludeValueOptions(); applyFilters();">
                        <option value="">ì„ íƒ ì•ˆí•¨</option>
                        <option value="status">ìƒíƒœ</option>
                        <option value="priority">ìš°ì„ ìˆœìœ„</option>
                        <option value="owner">ë‹´ë‹¹ì</option>
                        <option value="line_classification">ë¼ì¸ ë¶„ë¥˜</option>
                    </select>
                </div>
                <div class="filter-group" style="min-width: 200px;">
                    <label>ìˆ¨ê¸¸ ê°’ (Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ì„ íƒ)</label>
                    <select id="excludeSortValue" multiple size="4" onchange="applyFilters();" style="min-height: 80px;">
                    </select>
                </div>
                <div class="filter-group" id="excludeSelectedDisplay" style="display: none;">
                    <label>ì„ íƒëœ ìˆ¨ê¹€ í•­ëª©</label>
                    <div id="excludeSelectedTags" style="display: flex; flex-wrap: wrap; gap: 4px;"></div>
                </div>
            </div>
        </div>

        <!-- í…Œì´ë¸” -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-title">
                    <span id="resultCount">0</span>ê°œì˜ ì´ìŠˆ
                </div>
                <div class="table-actions">
                    <div class="view-toggle" role="group" aria-label="ë³´ê¸° ëª¨ë“œ ì„ íƒ">
                        <button type="button" class="view-btn" data-view="matrix" onclick="switchView('matrix')">ë§¤íŠ¸ë¦­ìŠ¤</button>
                        <button type="button" class="view-btn" data-view="card" onclick="switchView('card')">ì¹´ë“œí˜•</button>
                        <button type="button" class="view-btn active" data-view="table" onclick="switchView('table')">í…Œì´ë¸”í˜•</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label for="itemsPerPageSelect" style="font-size: var(--font-sm); color: var(--color-gray-600);">í‘œì‹œ:</label>
                        <select id="itemsPerPageSelect" onchange="changeItemsPerPage(this.value)" style="padding: 4px 8px; border: 1px solid var(--color-gray-300); border-radius: var(--border-radius-base); font-size: var(--font-sm);">
                            <option value="10">10ê°œ</option>
                            <option value="20" selected>20ê°œ</option>
                            <option value="50">50ê°œ</option>
                            <option value="100">100ê°œ</option>
                            <option value="all">ì „ì²´</option>
                        </select>
                    </div>
                    <button class="btn btn-outline btn-sm" onclick="exportToCSV()">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <div class="matrix-controls">
                <button type="button" onclick="toggleDomainSections(true)">ëª¨ë‘ í¼ì¹˜ê¸°</button>
                <button type="button" onclick="toggleDomainSections(false)">ëª¨ë‘ ì ‘ê¸°</button>
            </div>
            <div id="matrixView" class="matrix-container" aria-live="polite">
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <div class="empty-state-icon">â³</div>
                    <p>ë©”íŠ¸ë¦­ìŠ¤ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</p>
                </div>
            </div>
            <div class="table-wrapper hidden" id="tableView">
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortBy('priority')" style="width: 80px; text-align: center;">ìš°ì„ ìˆœìœ„ <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('title')" style="min-width: 280px;">ID Â· ì œëª© <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('line_classification')" style="width: 140px;">ë¼ì¸ Â· ë¶„ë¥˜ <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('status')" style="width: 100px;">ìƒíƒœ <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('owner')" style="width: 100px;">ë‹´ë‹¹ì <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('target_date')" style="width: 180px;">ì¼ì • (ìš”ì²­â†’ëª©í‘œ) <span class="sort-icon">â†•ï¸</span></th>
                            <th onclick="sortBy('updated_at')" style="width: 120px;">ìµœê·¼ ë³€ê²½ <span class="sort-icon">â†•ï¸</span></th>
                            <th style="width: 80px; text-align: center;">ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody id="issueTableBody">
                        <tr>
                            <td colspan="8" class="loading">
                                â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="cardView" class="card-grid hidden" aria-live="polite"></div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div class="pagination" id="pagination" style="display: none;">
                <button id="prevBtn" onclick="changePage(-1)">â—€ ì´ì „</button>
                <span class="pagination-info" id="pageInfo">1 / 1</span>
                <button id="nextBtn" onclick="changePage(1)">ë‹¤ìŒ â–¶</button>
            </div>
        </div>
    </div>

    <script src="../../shared/scripts/utils.js"></script>
    <script src="../scripts/config-loader.js"></script>
    <script src="../scripts/punchlist.js"></script>
    <script>
        let allIssues = [];
        let filteredIssues = [];
        let currentPage = 1;
        let itemsPerPage = 20;
        let sortColumn = 'id';
        let sortDirection = 'desc';
        let categoryConfig = null;
        let currentView = 'table';
        const MATRIX_MAX_ITEMS = 4;
        const DOMAIN_ORDER = ['ê¸°ê³„', 'ì „ê¸°', 'ì œì–´'];
        const STATS_STORAGE_KEY = 'punchlist_stats_snapshot';
        const USER_SETTINGS_KEY = 'punchlist_user_settings';
        let statsSnapshotCache = null;

        // ì‚¬ìš©ì ì„¤ì • ì €ì¥
        function saveUserSettings() {
            const excludeSelect = document.getElementById('excludeSortValue');
            const excludeValues = Array.from(excludeSelect.selectedOptions).map(opt => opt.value);

            const settings = {
                currentView,
                itemsPerPage,
                excludeColumn: document.getElementById('excludeSortColumn').value,
                excludeValues
            };

            try {
                localStorage.setItem(USER_SETTINGS_KEY, JSON.stringify(settings));
            } catch (error) {
                console.warn('ì‚¬ìš©ì ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ìš©ì ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadUserSettings() {
            try {
                const raw = localStorage.getItem(USER_SETTINGS_KEY);
                if (!raw) return null;
                return JSON.parse(raw);
            } catch (error) {
                console.warn('ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ì‚¬ìš©ì ì„¤ì • ì ìš©
        function applyUserSettings() {
            const settings = loadUserSettings();
            if (!settings) return;

            // ë·° ëª¨ë“œ ì ìš©
            if (settings.currentView) {
                currentView = settings.currentView;
            }

            // í‘œì‹œ ê°œìˆ˜ ì ìš©
            if (settings.itemsPerPage) {
                itemsPerPage = settings.itemsPerPage;
                const itemsSelect = document.getElementById('itemsPerPageSelect');
                if (itemsSelect) {
                    const value = settings.itemsPerPage === 9999 ? 'all' : settings.itemsPerPage.toString();
                    itemsSelect.value = value;
                }
            }

            // ìˆ¨ê¹€ í•„í„° ì ìš© (ì´ìŠˆ ë¡œë“œ í›„ ì ìš©)
            return settings;
        }

        // ìˆ¨ê¹€ í•„í„° ì„¤ì • ì ìš© (ì´ìŠˆ ë¡œë“œ í›„ í˜¸ì¶œ)
        function applyExcludeSettings(settings) {
            if (!settings || !settings.excludeColumn) return;

            const columnSelect = document.getElementById('excludeSortColumn');
            columnSelect.value = settings.excludeColumn;
            updateExcludeValueOptions();

            if (settings.excludeValues && settings.excludeValues.length > 0) {
                const valueSelect = document.getElementById('excludeSortValue');
                Array.from(valueSelect.options).forEach(opt => {
                    opt.selected = settings.excludeValues.includes(opt.value);
                });
            }
        }

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', async () => {
            const savedSettings = applyUserSettings();
            await initFilters();
            updateViewToggle();
            await loadIssues();

            // ìˆ¨ê¹€ í•„í„° ì„¤ì • ì ìš© (ì´ìŠˆ ë¡œë“œ í›„)
            if (savedSettings) {
                applyExcludeSettings(savedSettings);
                applyFilters();
            }
        });

        function updateViewToggle() {
            const tableWrapper = document.getElementById('tableView');
            const cardWrapper = document.getElementById('cardView');
            const matrixWrapper = document.getElementById('matrixView');
            const matrixControls = document.querySelector('.matrix-controls');

            if (tableWrapper) {
                tableWrapper.classList.toggle('hidden', currentView !== 'table');
            }

            if (cardWrapper) {
                cardWrapper.classList.toggle('hidden', currentView !== 'card');
            }

            if (matrixWrapper) {
                matrixWrapper.classList.toggle('hidden', currentView !== 'matrix');
            }
            if (matrixControls) {
                matrixControls.classList.toggle('hidden', currentView !== 'matrix');
            }

            document.querySelectorAll('.view-btn').forEach(btn => {
                const view = btn.getAttribute('data-view');
                btn.classList.toggle('active', view === currentView);
            });
        }

        function switchView(view) {
            if (currentView === view) return;
            currentView = view;
            renderTable();
            saveUserSettings();
        }

        function handleOverdueCardClick(event) {
            event?.preventDefault();
            const overdueButton = document.querySelector('.preset-btn[data-preset="overdue"]');
            applyPreset('overdue', overdueButton);
            if (overdueButton) {
                overdueButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function loadStatsSnapshot() {
            if (statsSnapshotCache) return statsSnapshotCache;
            if (typeof localStorage === 'undefined') return null;
            try {
                const raw = localStorage.getItem(STATS_STORAGE_KEY);
                statsSnapshotCache = raw ? JSON.parse(raw) : null;
                return statsSnapshotCache;
            } catch (error) {
                console.warn('ì´ì „ í†µê³„ ìŠ¤ëƒ…ìƒ· ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        function saveStatsSnapshot(snapshot) {
            if (typeof localStorage === 'undefined') return;
            try {
                localStorage.setItem(STATS_STORAGE_KEY, JSON.stringify(snapshot));
                statsSnapshotCache = snapshot;
            } catch (error) {
                console.warn('í†µê³„ ìŠ¤ëƒ…ìƒ· ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        function updateStatCard(valueId, deltaId, currentValue, previousValue) {
            const valueEl = document.getElementById(valueId);
            if (valueEl) {
                valueEl.textContent = currentValue;
            }
            const deltaEl = document.getElementById(deltaId);
            if (!deltaEl) return;

            if (typeof previousValue !== 'number') {
                deltaEl.textContent = '-';
                deltaEl.classList.remove('positive', 'negative');
                return;
            }

            const delta = currentValue - previousValue;
            if (!delta) {
                deltaEl.textContent = 'ë³€í™” ì—†ìŒ';
                deltaEl.classList.remove('positive', 'negative');
                return;
            }

            const directionClass = delta > 0 ? 'positive' : 'negative';
            deltaEl.classList.remove('positive', 'negative');
            deltaEl.classList.add(directionClass);
            const symbol = delta > 0 ? 'â–²' : 'â–¼';
            deltaEl.textContent = `${symbol} ${Math.abs(delta)}`;
        }

        function getSubcategoriesForDomain(domain) {
            if (categoryConfig && Array.isArray(categoryConfig.categories)) {
                const matched = categoryConfig.categories.find(cat => cat.name === domain);
                if (matched && Array.isArray(matched.subcategories)) {
                    return matched.subcategories.map(sub => sub.name);
                }
            }

            const fallback = PunchListAPI.CATEGORIES && PunchListAPI.CATEGORIES[domain];
            if (Array.isArray(fallback) && fallback.length > 0) {
                return fallback;
            }

            return ['ê¸°íƒ€'];
        }

        function buildMatrixIssueList(issues) {
            if (!issues || issues.length === 0) {
                return '<div class="matrix-empty">ë“±ë¡ëœ ì´ìŠˆ ì—†ìŒ</div>';
            }

            const displayed = issues.slice(0, MATRIX_MAX_ITEMS).map(issue => {
                const statusBadge = `<span class="badge badge-status-${issue.status}">${issue.status}</span>`;
                const priorityIcons = {
                    'ê¸´ê¸‰': 'ğŸš¨',
                    'ë†’ìŒ': 'âš ï¸',
                    'ë³´í†µ': 'ğŸ“Œ',
                    'ë‚®ìŒ': 'ğŸ“'
                };
                const priorityIcon = priorityIcons[issue.priority] || 'ğŸ“Œ';

                return `
                    <div class="matrix-issue" onclick="window.open('detail.html?id=${issue.id}', '_blank')">
                        <div class="matrix-issue-header">
                            <span class="matrix-issue-id">${issue.id}</span>
                            ${statusBadge}
                        </div>
                        <div class="matrix-issue-title" title="${issue.title}">${issue.title}</div>
                        <div class="matrix-issue-meta">
                            <span>${issue.owner || '-'}</span>
                            <span class="matrix-priority">${priorityIcon} ${issue.priority}</span>
                        </div>
                    </div>
                `;
            }).join('');

            if (issues.length > MATRIX_MAX_ITEMS) {
                return `
                    ${displayed}
                    <div class="matrix-more">+${issues.length - MATRIX_MAX_ITEMS}ê±´ ë”ë³´ê¸°</div>
                `;
            }

            return displayed;
        }

        // í•„í„° ì´ˆê¸°í™”
        async function initFilters() {
            // ë¶„ë¥˜ ì˜µì…˜
            categoryConfig = await configLoader.loadCategories();
            const categorySelect = document.getElementById('filterCategory');
            categoryConfig.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = `${cat.icon} ${cat.name}`;
                categorySelect.appendChild(option);
            });

            const lineSelect = document.getElementById('filterLine');
            if (lineSelect) {
                (PunchListAPI.LINE_TYPES || []).forEach(line => {
                    const option = document.createElement('option');
                    option.value = line;
                    option.textContent = line;
                    lineSelect.appendChild(option);
                });
            }

            // ë‹´ë‹¹ì ì˜µì…˜
            await PunchListAPI.ensureOwnersLoaded();
            const ownerNames = PunchListAPI.getOwnerNames();
            const ownerSelect = document.getElementById('filterOwner');
            ownerNames.forEach(owner => {
                const option = document.createElement('option');
                option.value = owner;
                option.textContent = owner;
                ownerSelect.appendChild(option);
            });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('filterCategory').addEventListener('change', updateSubcategories);
            document.getElementById('searchInput').addEventListener('input', debounce(applyFilters, 500));
            document.getElementById('filterLine').addEventListener('change', applyFilters);
        }

        // ì„¸ë¶€ë¶„ë¥˜ ì—…ë°ì´íŠ¸
        async function updateSubcategories() {
            const category = document.getElementById('filterCategory').value;
            const subcategorySelect = document.getElementById('filterSubcategory');

            subcategorySelect.innerHTML = '<option value="">ì „ì²´</option>';

            if (!category) return;

            if (!categoryConfig) {
                categoryConfig = await configLoader.loadCategories();
            }
            const categoryData = categoryConfig.categories.find(c => c.name === category);

            if (categoryData && categoryData.subcategories) {
                categoryData.subcategories.forEach(sub => {
                    const option = document.createElement('option');
                    option.value = sub.name;
                    option.textContent = sub.name;
                    subcategorySelect.appendChild(option);
                });
            }
        }

        function refreshLineFilterOptions(issues) {
            const lineSelect = document.getElementById('filterLine');
            if (!lineSelect) return;

            const existing = new Set(Array.from(lineSelect.options).map(option => option.value));

            (issues || []).forEach(issue => {
                const line = issue && issue.line_classification;
                if (line && !existing.has(line)) {
                    const option = document.createElement('option');
                    option.value = line;
                    option.textContent = line;
                    lineSelect.appendChild(option);
                    existing.add(line);
                }
            });
        }

        // ì´ìŠˆ ë¡œë“œ
        async function loadIssues() {
            try {
                allIssues = await PunchListAPI.loadAllIssues();
                refreshLineFilterOptions(allIssues);
                applyFilters();
            } catch (error) {
                console.error('ì´ìŠˆ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('issueTableBody').innerHTML = `
                    <tr>
                        <td colspan="11" class="empty-state">
                            <div class="empty-state-icon">âš ï¸</div>
                            <p>ì´ìŠˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                            <p style="font-size: var(--font-sm); margin-top: var(--space-2);">
                                Google Sheets ì—°ë™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                            </p>
                        </td>
                    </tr>
                `;
            }
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const filters = {
                line: document.getElementById('filterLine').value,
                category: document.getElementById('filterCategory').value,
                subcategory: document.getElementById('filterSubcategory').value,
                status: document.getElementById('filterStatus').value,
                priority: document.getElementById('filterPriority').value,
                owner: document.getElementById('filterOwner').value,
                search: document.getElementById('searchInput').value
            };

            filteredIssues = PunchListAPI.filterIssues(allIssues, filters);

            // ìˆ¨ê¹€ í•„í„° ì ìš© (ë‹¤ì¤‘ ì„ íƒ ì§€ì›)
            const excludeColumn = document.getElementById('excludeSortColumn').value;
            const excludeSelect = document.getElementById('excludeSortValue');
            const excludeValues = Array.from(excludeSelect.selectedOptions).map(opt => opt.value);
            if (excludeColumn && excludeValues.length > 0) {
                filteredIssues = filteredIssues.filter(issue => !excludeValues.includes(issue[excludeColumn]));
            }
            updateExcludeSelectedDisplay(excludeValues);

            sortIssues();
            currentPage = 1;
            renderTable();
            updatePagination();
            updateStats(allIssues);
            saveUserSettings();
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterSubcategory').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterPriority').value = '';
            document.getElementById('filterOwner').value = '';
            document.getElementById('filterLine').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('excludeSortColumn').value = '';

            // ë‹¤ì¤‘ ì„ íƒ ì´ˆê¸°í™”
            const excludeValueSelect = document.getElementById('excludeSortValue');
            excludeValueSelect.innerHTML = '';
            Array.from(excludeValueSelect.options).forEach(opt => opt.selected = false);
            updateExcludeSelectedDisplay([]);

            document.getElementById('filterSubcategory').innerHTML = '<option value="">ì „ì²´</option>';

            // í”„ë¦¬ì…‹ ë²„íŠ¼ í™œì„±í™” ì´ˆê¸°í™”
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));

            applyFilters();
        }

        // í•„í„° í”„ë¦¬ì…‹ ì ìš©
        function applyPreset(presetType, triggerElement = null) {
            // ë¨¼ì € ëª¨ë“  í•„í„° ì´ˆê¸°í™”
            resetFilters();

            // í”„ë¦¬ì…‹ ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            if (triggerElement) {
                triggerElement.classList.add('active');
            } else if (presetType === 'overdue' || presetType === 'urgent-b' || presetType === 'this-week') {
                const presetButton = document.querySelector(`.preset-btn[data-preset="${presetType}"]`);
                if (presetButton) {
                    presetButton.classList.add('active');
                }
            }

            const today = new Date();
            const weekLater = new Date(today);
            weekLater.setDate(weekLater.getDate() + 7);

            switch(presetType) {
                case 'urgent-b':
                    // ê¸´ê¸‰ ì´ìŠˆ (Bë¼ì¸)
                    document.getElementById('filterPriority').value = 'ê¸´ê¸‰';
                    document.getElementById('filterLine').value = 'Bë¼ì¸';
                    break;

                case 'overdue':
                    // ì§€ì—° ì¤‘ì¸ ì´ìŠˆ - ì™„ë£Œë˜ì§€ ì•Šì€ + ëª©í‘œì¼ ì§€ë‚œ ì´ìŠˆ
                    // ì´ ê²½ìš° JavaScript í•„í„°ë§ìœ¼ë¡œ ì²˜ë¦¬
                    filteredIssues = allIssues.filter(issue => {
                        return issue.status !== 'ì™„ë£Œ' && PunchListAPI.isOverdue(issue);
                    });
                    sortIssues();
                    currentPage = 1;
                    renderTable();
                    updatePagination();
                    updateStats(allIssues);
                    return;

                case 'this-week':
                    // ì´ë²ˆ ì£¼ ë§ˆê° - ëª©í‘œì¼ì´ ì˜¤ëŠ˜ë¶€í„° 7ì¼ ì´ë‚´
                    filteredIssues = allIssues.filter(issue => {
                        const targetDate = new Date(issue.target_date);
                        return targetDate >= today && targetDate <= weekLater;
                    });
                    sortIssues();
                    currentPage = 1;
                    renderTable();
                    updatePagination();
                    updateStats(allIssues);
                    return;
            }

            applyFilters();
        }

        // ì •ë ¬
        function sortBy(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            document.querySelectorAll('th').forEach(th => th.classList.remove('sorted'));
            const thElement = event.target.closest('th');
            if (thElement) {
                thElement.classList.add('sorted');
            }


            sortIssues();
            renderTable();
        }

        function sortIssues() {
            const excludeColumn = document.getElementById('excludeSortColumn').value;
            const excludeValue = document.getElementById('excludeSortValue').value;
            filteredIssues = PunchListAPI.sortIssues(filteredIssues, sortColumn, sortDirection, { excludeColumn, excludeValue });
        }
        
        function updateExcludeValueOptions() {
            const column = document.getElementById('excludeSortColumn').value;
            const valueSelect = document.getElementById('excludeSortValue');
            valueSelect.innerHTML = '';

            if (!column) {
                updateExcludeSelectedDisplay([]);
                return;
            }

            let options = [];
            switch (column) {
                case 'status':
                    options = PunchListAPI.STATUSES;
                    break;
                case 'priority':
                    options = PunchListAPI.PRIORITIES;
                    break;
                case 'owner':
                    options = PunchListAPI.getOwnerNames();
                    break;
                case 'line_classification':
                    options = PunchListAPI.LINE_TYPES;
                    break;
            }

            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.textContent = opt;
                valueSelect.appendChild(option);
            });
            updateExcludeSelectedDisplay([]);
        }

        function updateExcludeSelectedDisplay(selectedValues) {
            const displayContainer = document.getElementById('excludeSelectedDisplay');
            const tagsContainer = document.getElementById('excludeSelectedTags');

            if (!selectedValues || selectedValues.length === 0) {
                displayContainer.style.display = 'none';
                tagsContainer.innerHTML = '';
                return;
            }

            displayContainer.style.display = 'block';
            tagsContainer.innerHTML = selectedValues.map(val =>
                `<span style="background: #fee2e2; color: #991b1b; padding: 2px 8px; border-radius: 12px; font-size: 12px; display: inline-flex; align-items: center; gap: 4px;">
                    ğŸš« ${val}
                    <button type="button" onclick="removeExcludeValue('${val}')" style="background: none; border: none; cursor: pointer; padding: 0; font-size: 14px; line-height: 1;">Ã—</button>
                </span>`
            ).join('');
        }

        function removeExcludeValue(value) {
            const valueSelect = document.getElementById('excludeSortValue');
            Array.from(valueSelect.options).forEach(opt => {
                if (opt.value === value) {
                    opt.selected = false;
                }
            });
            applyFilters();
        }

        // í…Œì´ë¸”/ì¹´ë“œ/ë§¤íŠ¸ë¦­ìŠ¤ ë Œë”ë§
        function renderTable() {
            const tbody = document.getElementById('issueTableBody');
            const cardWrapper = document.getElementById('cardView');
            const matrixContainer = document.getElementById('matrixView');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageIssues = filteredIssues.slice(start, end);
            const matrixIssues = filteredIssues;

            document.getElementById('resultCount').textContent = filteredIssues.length;

            if (pageIssues.length === 0) {
                const emptyState = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;

                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </td>
                    </tr>
                `;

                if (cardWrapper) {
                    cardWrapper.innerHTML = emptyState;
                }

                if (matrixContainer) {
                    matrixContainer.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-state-icon">ğŸ“­</div>
                            <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                }

                updateViewToggle();
                return;
            }

            const priorityIcons = {
                'ê¸´ê¸‰': 'ğŸš¨',
                'ë†’ìŒ': 'âš ï¸',
                'ë³´í†µ': 'ğŸ“Œ',
                'ë‚®ìŒ': 'ğŸ“'
            };

            const renderedIssues = pageIssues.map(issue => {
                const isOverdue = PunchListAPI.isOverdue(issue);
                const isRecent = PunchListAPI.isRecentlyUpdated(issue);

                const priorityClass = `priority-${issue.priority}`;
                const rowClasses = [priorityClass];
                if (isRecent) rowClasses.push('recent-update');
                const rowClassAttr = ` class="${rowClasses.join(' ')}"`;

                const priorityIcon = priorityIcons[issue.priority] || 'ğŸ“Œ';

                const lineCell = issue.line_classification
                    ? PunchListAPI.getLineBadge(issue.line_classification)
                    : '<span class="line-badge" style="background: #e5e7eb; color: #4b5563;">ë¯¸ì§€ì •</span>';

                const updatedLabel = PunchListAPI.formatDateTime(issue.updated_at);
                const recentIndicator = isRecent
                    ? '<span class="recent-indicator" title="ìµœê·¼ 72ì‹œê°„ ë‚´ ì—…ë°ì´íŠ¸">ğŸ†•</span>'
                    : '';

                const requestDate = PunchListAPI.formatDate(issue.request_date);
                const targetDate = PunchListAPI.formatDate(issue.target_date);
                const scheduleClass = isOverdue ? 'schedule-overdue' : 'schedule-date';

                const tableRow = `
                    <tr${rowClassAttr} onclick="window.open('detail.html?id=${issue.id}', '_blank')" style="cursor: pointer;" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°">
                        <td class="priority-cell">
                            <div class="priority-indicator">
                                <span class="priority-icon">${priorityIcon}</span>
                                <span class="priority-text">${issue.priority}</span>
                            </div>
                        </td>
                        <td class="issue-cell">
                            <div class="issue-id">${issue.id}</div>
                            <div class="issue-title">${issue.title}</div>
                            <div class="issue-tags">
                                ${issue.category ? `<span class="tag">${issue.category}</span>` : ''}
                            </div>
                        </td>
                        <td>
                            <div class="line-category-cell">
                                ${lineCell}
                                <span class="category-text">${issue.subcategory || '-'}</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge badge-status-${issue.status}">${issue.status}</span>
                        </td>
                        <td>${issue.owner || '-'}</td>
                        <td>
                            <div class="schedule-cell">
                                <span class="schedule-date">${requestDate}</span>
                                <span class="schedule-arrow">â†’</span>
                                <span class="${scheduleClass}">${targetDate}${isOverdue ? ' âš ï¸' : ''}</span>
                            </div>
                        </td>
                        <td>
                            ${updatedLabel}
                            ${recentIndicator}
                        </td>
                        <td class="action-cell">
                            <button class="action-btn" onclick="event.stopPropagation(); window.open('detail.html?id=${issue.id}', '_blank')">
                                ìƒì„¸
                            </button>
                        </td>
                    </tr>
                `;

                const cardTags = [
                    lineCell,
                    issue.category ? `<span class="tag">${issue.category}</span>` : '',
                    issue.subcategory ? `<span class="tag">${issue.subcategory}</span>` : ''
                ].filter(Boolean).join('');

                const card = `
                    <article class="issue-card ${priorityClass}">
                        <div class="card-header">
                            <div>
                                <div class="card-id">${issue.id}</div>
                                <div class="card-title">${issue.title}</div>
                            </div>
                            <div class="card-priority card-priority-${issue.priority}">
                                <span>${priorityIcon}</span>
                                <span>${issue.priority}</span>
                            </div>
                        </div>
                        <div class="card-tags">
                            ${cardTags || '<span class="tag">ë¯¸ë¶„ë¥˜</span>'}
                        </div>
                        <div class="card-meta">
                            <div>
                                <strong>ìƒíƒœ</strong>
                                <span class="badge badge-status-${issue.status}">${issue.status}</span>
                            </div>
                            <div>
                                <strong>ë‹´ë‹¹ì</strong>
                                <span>${issue.owner || '-'}</span>
                            </div>
                            <div>
                                <strong>ì¼ì •</strong>
                                <div class="card-dates">
                                    <span>${requestDate}</span>
                                    <span class="schedule-arrow">â†’</span>
                                    <span class="${scheduleClass}">${targetDate}${isOverdue ? ' âš ï¸' : ''}</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="card-updated">
                                ìµœê·¼ ë³€ê²½: ${updatedLabel} ${recentIndicator}
                            </span>
                            <div class="card-actions">
                                <button class="action-btn" onclick="event.stopPropagation(); window.open('detail.html?id=${issue.id}', '_blank')">
                                    ìƒì„¸
                                </button>
                            </div>
                        </div>
                    </article>
                `;

                return { table: tableRow, card };
            });

            tbody.innerHTML = renderedIssues.map(item => item.table).join('');

            if (cardWrapper) {
                cardWrapper.innerHTML = renderedIssues.map(item => item.card).join('');
            }

            renderMatrixView(matrixIssues);
            updateViewToggle();
        }

        function renderMatrixView(issues) {
            const matrixContainer = document.getElementById('matrixView');
            if (!matrixContainer) return;

            const matrixData = {};
            DOMAIN_ORDER.forEach(domain => {
                matrixData[domain] = {};
            });

            (issues || []).forEach(issue => {
                const domain = issue.category || 'ë¯¸ì§€ì •';
                const subcategory = issue.subcategory || 'ê¸°íƒ€';

                if (!matrixData[domain]) {
                    matrixData[domain] = {};
                }
                if (!matrixData[domain][subcategory]) {
                    matrixData[domain][subcategory] = [];
                }
                matrixData[domain][subcategory].push(issue);
            });

            const extraDomains = Object.keys(matrixData).filter(domain => !DOMAIN_ORDER.includes(domain));
            const orderedDomains = [...DOMAIN_ORDER, ...extraDomains];

            const matrixHtml = orderedDomains.map(domain => {
                const domainData = matrixData[domain] || {};
                const configuredSubs = getSubcategoriesForDomain(domain);
                const existingSubs = Object.keys(domainData);
                const mergedSubs = Array.from(new Set([...configuredSubs, ...existingSubs]));

                const domainTotal = existingSubs.reduce((sum, key) => sum + (domainData[key]?.length || 0), 0);

                const cells = mergedSubs.map(sub => {
                    const issuesInSub = domainData[sub] || [];
                    const highlightHMI = (sub || '').toUpperCase().includes('HMI');
                    const cellClasses = ['matrix-cell'];
                    if (highlightHMI) cellClasses.push('matrix-cell-hmi');

                    return `
                        <div class="${cellClasses.join(' ')}">
                            <div class="matrix-cell-header">
                                <span>${sub}</span>
                                <span class="matrix-count">${issuesInSub.length}</span>
                            </div>
                            <div class="matrix-issue-list">
                                ${buildMatrixIssueList(issuesInSub)}
                            </div>
                        </div>
                    `;
                }).join('');

                const openAttr = domainTotal > 0 ? ' open' : '';

                return `
                    <details class="matrix-column"${openAttr} data-domain="${domain}">
                        <summary class="matrix-column-header">
                            <span>${domain}</span>
                            <span>${domainTotal}ê±´</span>
                        </summary>
                        <div class="matrix-subgrid">
                            ${cells}
                        </div>
                    </details>
                `;
            }).join('');

            matrixContainer.innerHTML = matrixHtml;
        }

        function toggleDomainSections(expand = true) {
            document.querySelectorAll('#matrixView .matrix-column').forEach(section => {
                if (typeof section.open === 'boolean') {
                    section.open = expand;
                }
            });
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(targetIssues = allIssues) {
            const stats = PunchListAPI.calculateStats(targetIssues || []);
            const byStatus = stats.byStatus || {};
            const previous = loadStatsSnapshot() || {};
            const previousByStatus = previous.byStatus || {};

            updateStatCard('totalCount', 'totalDelta', stats.total || 0, typeof previous.total === 'number' ? previous.total : undefined);
            updateStatCard('verifyingCount', 'verifyingDelta', byStatus['ê²€ì¦ì¤‘'] || 0, previousByStatus['ê²€ì¦ì¤‘']);
            updateStatCard('pendingCount', 'pendingDelta', byStatus['ë³´ë¥˜'] || 0, previousByStatus['ë³´ë¥˜']);
            updateStatCard('newCount', 'newDelta', byStatus['ì‹ ê·œ'] || 0, previousByStatus['ì‹ ê·œ']);
            updateStatCard('completeCount', 'completeDelta', byStatus['ì™„ë£Œ'] || 0, previousByStatus['ì™„ë£Œ']);
            updateStatCard('progressCount', 'progressDelta', byStatus['ì§„í–‰ì¤‘'] || 0, previousByStatus['ì§„í–‰ì¤‘']);

            const overdueCount = stats.overdue || 0;
            const overduePercent = stats.total ? Math.round((overdueCount / stats.total) * 100) : 0;
            updateStatCard('overdueCount', 'overdueDelta', overdueCount, typeof previous.overdue === 'number' ? previous.overdue : undefined);
            document.getElementById('overduePercent').textContent = `${overduePercent}%`;

            saveStatsSnapshot({
                total: stats.total || 0,
                overdue: overdueCount,
                byStatus: {
                    'ê²€ì¦ì¤‘': byStatus['ê²€ì¦ì¤‘'] || 0,
                    'ë³´ë¥˜': byStatus['ë³´ë¥˜'] || 0,
                    'ì‹ ê·œ': byStatus['ì‹ ê·œ'] || 0,
                    'ì™„ë£Œ': byStatus['ì™„ë£Œ'] || 0,
                    'ì§„í–‰ì¤‘': byStatus['ì§„í–‰ì¤‘'] || 0
                }
            });
        }

        // í˜ì´ì§€ë„¤ì´ì…˜
        function updatePagination() {
            const totalPages = Math.ceil(filteredIssues.length / itemsPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';
            document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }

        function changePage(delta) {
            const totalPages = Math.ceil(filteredIssues.length / itemsPerPage);
            const newPage = currentPage + delta;

            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderTable();
                updatePagination();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function changeItemsPerPage(value) {
            if (value === 'all') {
                itemsPerPage = filteredIssues.length || 9999;
            } else {
                itemsPerPage = parseInt(value, 10);
            }
            currentPage = 1;
            renderTable();
            updatePagination();
            saveUserSettings();
        }

        // CSV ë‚´ë³´ë‚´ê¸°
        function exportToCSV() {
            const headers = ['ID', 'ì œëª©', 'ë¼ì¸', 'ë¶„ë¥˜', 'ì„¸ë¶€ë¶„ë¥˜', 'ìš°ì„ ìˆœìœ„', 'ìƒíƒœ', 'ë‹´ë‹¹ì', 'ìš”ì²­ì¼', 'ëª©í‘œì¼', 'ìµœê·¼ ë³€ê²½'];
            const rows = filteredIssues.map(issue => [
                issue.id,
                issue.title,
                issue.line_classification || '',
                issue.category,
                issue.subcategory,
                issue.priority,
                issue.status,
                issue.owner,
                issue.request_date,
                issue.target_date,
                issue.updated_at || ''
            ]);

            const csv = [headers, ...rows]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `punchlist_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Debounce í•¨ìˆ˜
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
    </script>
</body>
</html>
