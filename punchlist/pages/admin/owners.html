<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹´ë‹¹ì ê´€ë¦¬ - S25016 í€ì¹˜ë¦¬ìŠ¤íŠ¸</title>

    <link rel="stylesheet" href="../../../shared/styles/variables.css">
    <link rel="stylesheet" href="../../../shared/styles/reset.css">
    <link rel="stylesheet" href="../../../shared/styles/components.css">

    <style>
        body {
            background: var(--color-gray-50);
            padding: var(--space-5);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: var(--color-white);
            padding: var(--space-6);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--space-6);
        }

        .owners-table {
            width: 100%;
            border-collapse: collapse;
        }

        .owners-table th,
        .owners-table td {
            padding: var(--space-3);
            text-align: left;
            border-bottom: 1px solid var(--color-gray-200);
        }

        .owners-table th {
            background: var(--color-gray-100);
            font-weight: var(--font-semibold);
        }

        .owners-table tr:hover {
            background: var(--color-gray-50);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            padding: var(--space-6);
            max-width: 500px;
            width: 90%;
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-group label {
            display: block;
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-2);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--color-gray-300);
            border-radius: var(--border-radius-base);
        }

        .button-group {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .badge-role {
            display: inline-block;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--border-radius-base);
            font-size: var(--font-sm);
            font-weight: var(--font-semibold);
        }

        .badge-role.ê´€ë¦¬ì {
            background: #dc2626;
            color: white;
        }

        .badge-role.ë‹´ë‹¹ì {
            background: #3b82f6;
            color: white;
        }

        .badge-role.í˜‘ë ¥ì—…ì²´ {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>ğŸ‘¥ ë‹´ë‹¹ì ê´€ë¦¬</h1>
                <p style="color: var(--color-gray-600); margin-top: var(--space-2);">
                    í€ì¹˜ë¦¬ìŠ¤íŠ¸ ë‹´ë‹¹ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤
                </p>
            </div>
            <div style="display: flex; gap: var(--space-3);">
                <button class="btn btn-primary" onclick="openAddOwnerModal()">
                    â• ë‹´ë‹¹ì ì¶”ê°€
                </button>
                <a href="../../index.html" class="btn btn-outline">
                    â† ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>

        <div class="card">
            <table class="owners-table">
                <thead>
                    <tr>
                        <th>ì´ë¦„</th>
                        <th>ì—­í• </th>
                        <th>ë¶€ì„œ</th>
                        <th>ì—°ë½ì²˜</th>
                        <th>ì´ë©”ì¼</th>
                        <th>ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="ownersTableBody">
                    <!-- ë™ì  ìƒì„± -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ë‹´ë‹¹ì ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="ownerModal">
        <div class="modal-content">
            <h2 id="ownerModalTitle">ë‹´ë‹¹ì ì¶”ê°€</h2>
            <form id="ownerForm" onsubmit="handleOwnerSubmit(event)">
                <div class="form-group">
                    <label>ì´ë¦„ <span style="color: red;">*</span></label>
                    <input type="text" id="ownerName" required>
                </div>
                <div class="form-group">
                    <label>ì—­í• </label>
                    <select id="ownerRole">
                        <option value="ë‹´ë‹¹ì">ë‹´ë‹¹ì</option>
                        <option value="ê´€ë¦¬ì">ê´€ë¦¬ì</option>
                        <option value="í˜‘ë ¥ì—…ì²´">í˜‘ë ¥ì—…ì²´</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¶€ì„œ</label>
                    <input type="text" id="ownerDepartment" placeholder="ì˜ˆ: ìƒì‚°ê¸°ìˆ íŒ€">
                </div>
                <div class="form-group">
                    <label>ì—°ë½ì²˜</label>
                    <input type="tel" id="ownerPhone" placeholder="010-1234-5678">
                </div>
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="ownerEmail" placeholder="example@company.com">
                </div>
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    <button type="button" class="btn btn-outline" onclick="closeModal()">
                        ì·¨ì†Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="../../../shared/scripts/utils.js"></script>
    <script src="../../scripts/punchlist.js"></script>
    <script>
        let owners = [];

        // í˜ì´ì§€ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', () => {
            loadOwners();
        });

        // ë‹´ë‹¹ì ë¡œë“œ
        function loadOwners() {
            const stored = localStorage.getItem('punchlist_owners');
            if (stored) {
                owners = JSON.parse(stored);
            } else {
                // ê¸°ë³¸ ë‹´ë‹¹ì (PunchListAPIì—ì„œ ê°€ì ¸ì˜´)
                owners = PunchListAPI.OWNERS.map(name => ({
                    id: name.toLowerCase().replace(/\s+/g, '-'),
                    name: name,
                    role: 'ë‹´ë‹¹ì',
                    department: '',
                    phone: '',
                    email: ''
                }));
            }
            renderOwners();
        }

        // ë‹´ë‹¹ì ë Œë”ë§
        function renderOwners() {
            const tbody = document.getElementById('ownersTableBody');
            tbody.innerHTML = '';

            owners.forEach(owner => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${owner.name}</strong></td>
                    <td><span class="badge-role ${owner.role}">${owner.role}</span></td>
                    <td>${owner.department || '-'}</td>
                    <td>${owner.phone || '-'}</td>
                    <td>${owner.email || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="editOwner('${owner.id}')" title="ìˆ˜ì •">
                            âœï¸
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="deleteOwner('${owner.id}')" title="ì‚­ì œ">
                            ğŸ—‘ï¸
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ë‹´ë‹¹ì ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
        function openAddOwnerModal() {
            document.getElementById('ownerModalTitle').textContent = 'ë‹´ë‹¹ì ì¶”ê°€';
            document.getElementById('ownerForm').reset();
            delete document.getElementById('ownerForm').dataset.editId;
            openModal();
        }

        // ë‹´ë‹¹ì ìˆ˜ì •
        function editOwner(id) {
            const owner = owners.find(o => o.id === id);
            if (!owner) return;

            document.getElementById('ownerModalTitle').textContent = 'ë‹´ë‹¹ì ìˆ˜ì •';
            document.getElementById('ownerName').value = owner.name;
            document.getElementById('ownerRole').value = owner.role;
            document.getElementById('ownerDepartment').value = owner.department || '';
            document.getElementById('ownerPhone').value = owner.phone || '';
            document.getElementById('ownerEmail').value = owner.email || '';
            document.getElementById('ownerForm').dataset.editId = id;
            openModal();
        }

        // ë‹´ë‹¹ì ì‚­ì œ
        function deleteOwner(id) {
            if (!confirm('ì´ ë‹´ë‹¹ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            owners = owners.filter(o => o.id !== id);
            saveOwners();
            renderOwners();
        }

        // ë‹´ë‹¹ì í¼ ì œì¶œ
        function handleOwnerSubmit(e) {
            e.preventDefault();

            const name = document.getElementById('ownerName').value;
            const role = document.getElementById('ownerRole').value;
            const department = document.getElementById('ownerDepartment').value;
            const phone = document.getElementById('ownerPhone').value;
            const email = document.getElementById('ownerEmail').value;
            const editId = e.target.dataset.editId;

            if (editId) {
                // ìˆ˜ì •
                const owner = owners.find(o => o.id === editId);
                if (owner) {
                    owner.name = name;
                    owner.role = role;
                    owner.department = department;
                    owner.phone = phone;
                    owner.email = email;
                }
            } else {
                // ì¶”ê°€
                const newId = name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now();
                owners.push({
                    id: newId,
                    name: name,
                    role: role,
                    department: department,
                    phone: phone,
                    email: email
                });
            }

            saveOwners();
            renderOwners();
            closeModal();
        }

        // ë‹´ë‹¹ì ì €ì¥
        function saveOwners() {
            localStorage.setItem('punchlist_owners', JSON.stringify(owners));
            alert('âœ… ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openModal() {
            document.getElementById('ownerModal').classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('ownerModal').classList.remove('active');
        }
    </script>
</body>
</html>
