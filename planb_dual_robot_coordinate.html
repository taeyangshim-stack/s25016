<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlanB — 듀얼 로봇 좌표계 구조 분석</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
    --bg-deep: #f0f2f5;
    --bg: #f7f8fa;
    --surface: #ffffff;
    --surface-hover: #f0f4ff;
    --border: #e2e6ef;
    --border-active: #b0c4ff;
    --text-primary: #1a2035;
    --text-secondary: #5a6580;
    --text-muted: #8892a8;
    --cyan: #2563eb;
    --cyan-dim: rgba(37, 99, 235, 0.07);
    --green: #16a34a;
    --green-dim: rgba(22, 163, 74, 0.07);
    --red: #dc2626;
    --red-dim: rgba(220, 38, 38, 0.06);
    --amber: #d97706;
    --amber-dim: rgba(217, 119, 6, 0.07);
    --violet: #7c3aed;
    --violet-dim: rgba(124, 58, 237, 0.07);
    --radius: 12px;
    --radius-sm: 8px;
    --radius-xs: 6px;
    --ease: cubic-bezier(0.4, 0, 0.2, 1);
    --font-mono: 'IBM Plex Mono', 'SF Mono', monospace;
    --font-body: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    font-family: var(--font-body);
    background: var(--bg-deep);
    min-height: 100vh;
    color: var(--text-primary);
    line-height: 1.7;
}

body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: radial-gradient(circle, rgba(37,99,235,0.04) 1px, transparent 1px);
    background-size: 32px 32px;
    pointer-events: none;
    z-index: 0;
}

.shell {
    position: relative;
    z-index: 1;
    max-width: 960px;
    margin: 0 auto;
    padding: 16px;
}

/* ── Header ── */
.header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    padding: 32px 8px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 28px;
}
.header-left { display: flex; flex-direction: column; gap: 4px; }
.header-tag { font-family: var(--font-mono); font-size: 0.72em; color: var(--cyan); text-transform: uppercase; letter-spacing: 0.15em; font-weight: 600; opacity: 0.8; }
.header h1 { font-family: var(--font-mono); font-size: 1.5em; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em; }
.header-sub { font-size: 0.85em; color: var(--text-secondary); margin-top: 2px; }
.back-link { font-family: var(--font-mono); font-size: 0.82em; color: var(--cyan); text-decoration: none; padding: 6px 14px; background: var(--cyan-dim); border-radius: 999px; border: 1px solid rgba(37,99,235,0.15); transition: all 0.2s var(--ease); white-space: nowrap; }
.back-link:hover { background: rgba(37,99,235,0.12); border-color: var(--cyan); }

/* ── Section Heading ── */
.section-title {
    font-family: var(--font-mono);
    font-size: 1.05em;
    font-weight: 700;
    color: var(--text-primary);
    margin: 32px 0 16px;
    padding: 10px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--cyan);
    border-radius: var(--radius-sm);
}
.section-title.amber { border-left-color: var(--amber); }
.section-title.green { border-left-color: var(--green); }
.section-title.red { border-left-color: var(--red); }
.section-title.violet { border-left-color: var(--violet); }

/* ── Card ── */
.card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 16px;
}
.card-header {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    font-family: var(--font-mono);
    font-size: 0.88em;
    font-weight: 600;
    color: var(--text-primary);
}
.card-body { padding: 20px; }
.card-body ul { padding-left: 20px; margin: 8px 0; }
.card-body li { font-size: 0.92em; margin-bottom: 6px; color: var(--text-primary); }

/* ── Subtitle ── */
h3 {
    font-family: var(--font-mono);
    font-size: 0.9em;
    font-weight: 600;
    color: var(--cyan);
    margin: 20px 0 8px;
}

/* ── Table ── */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
    font-size: 0.88em;
}
th {
    background: var(--bg);
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-weight: 600;
    font-size: 0.88em;
    padding: 10px 14px;
    text-align: left;
    border: 1px solid var(--border);
}
td {
    padding: 9px 14px;
    border: 1px solid var(--border);
    color: var(--text-primary);
}
tr:nth-child(even) { background: var(--bg); }

.ok { color: var(--green); font-weight: 600; }
.ng { color: var(--red); font-weight: 600; }
.warn { color: var(--amber); font-weight: 600; }

/* ── Code / Pre ── */
code {
    background: var(--cyan-dim);
    color: var(--cyan);
    padding: 2px 7px;
    border-radius: var(--radius-xs);
    font-family: var(--font-mono);
    font-size: 0.88em;
    font-weight: 500;
}
pre {
    background: #1e293b;
    color: #e2e8f0;
    border: 1px solid #334155;
    border-radius: var(--radius-sm);
    padding: 16px 20px;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.82em;
    line-height: 1.6;
    margin: 12px 0;
}
pre code { background: none; color: inherit; padding: 0; font-size: 1em; }

/* ── Diagram ── */
.diagram {
    background: #1e293b;
    color: #7dd3fc;
    border: 1px solid #334155;
    border-radius: var(--radius-sm);
    padding: 20px;
    margin: 12px 0;
    font-family: var(--font-mono);
    font-size: 0.78em;
    line-height: 1.45;
    white-space: pre;
    overflow-x: auto;
}

/* ── Note boxes ── */
.note {
    padding: 14px 18px;
    margin: 12px 0;
    border-radius: var(--radius-sm);
    font-size: 0.92em;
    line-height: 1.7;
}
.note-green { background: var(--green-dim); border-left: 3px solid var(--green); }
.note-amber { background: var(--amber-dim); border-left: 3px solid var(--amber); }
.note-red { background: var(--red-dim); border-left: 3px solid var(--red); }
.note-cyan { background: var(--cyan-dim); border-left: 3px solid var(--cyan); }

/* ── Animation ── */
.shell > * { animation: fadeUp 0.4s var(--ease) both; }
.shell > *:nth-child(2) { animation-delay: 0.05s; }
.shell > *:nth-child(3) { animation-delay: 0.10s; }

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
    .header { flex-direction: column; align-items: flex-start; gap: 12px; }
    .shell { padding: 12px; }
    pre, .diagram { font-size: 0.75em; }
}
</style>
</head>
<body>
<div class="shell">
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <span class="header-tag">S25016 // Plan B</span>
            <h1>듀얼 로봇 좌표계 구조 분석</h1>
            <span class="header-sub">Robot1/Robot2 TCP 검증 | RAPID v1.9.48 / v1.9.43 | 2026-02-21</span>
        </div>
        <a class="back-link" href="index.html">&larr; Back</a>
    </div>

    <!-- 1. 물리적 구성 -->
    <div class="section-title">1. 물리적 구성</div>
    <div class="card">
        <div class="card-header">갠트리 + 듀얼 로봇 배치</div>
        <div class="card-body">
<div class="diagram">              Floor 좌표계 (WobjFloor)
              원점: 바닥면 기준
              X: 갠트리 이동 방향 (Beam 따라)
              Y: 갠트리 횡방향
              Z: 상향 (바닥→천장)

  갠트리 HOME 위치 (Floor 좌표): [9500, 5300, 2100]

                        R축 센터
                          |
         Robot1 Base      |      Robot2 Base
          (-488mm)        |       (+488mm)
              |           |           |
              v           v           v
  ========[ROB1]=======[ R ]=======[ROB2]========  &lt;- 갠트리 빔 (Z=2100)
              |                       |
              |   (거꾸로 매달림)      |   (거꾸로 매달림)
              v                       v
           tWeld1                  tWeld2
              \                     /
               \                   /
                \                 /
                 v               v
                  ---- TCP ----        &lt;- R축 센터, Z=1100 (1000mm 아래)
                   만남점 (용접점)

  Floor Z=2100 ─── 갠트리 빔
  Floor Z=1100 ─── TCP 만남점 (빔에서 1000mm 아래)
  Floor Z=0    ─── 바닥</div>
        </div>
    </div>

    <!-- 2. Robot1 좌표계 -->
    <div class="section-title">2. Robot1 좌표계 (갠트리 연동)</div>
    <div class="card">
        <div class="card-header">Robot1 + GantryRob = 하나의 연동 로봇</div>
        <div class="card-body">
            <ul>
                <li><strong>MOC.cfg 설정:</strong> <code>base_frame_coordinated "GantryRob"</code></li>
                <li><strong>Base 위치:</strong> R축 센터에서 488mm 오프셋 (LOCKED_EAW_11 length=0.488)</li>
                <li><strong>좌표계 원점:</strong> 로봇 베이스가 아닌 <strong>R축 센터</strong>에 위치</li>
                <li><strong>base_frame_orient:</strong> <code>[1, 0, 0, ~0]</code> (항등, GantryRob이 회전 처리)</li>
            </ul>

            <h3>Robot1 좌표축 방향 (vs Floor)</h3>
            <table>
                <tr><th>Robot1 축</th><th>Floor 좌표 방향</th><th>설명</th></tr>
                <tr><td>X축</td><td>Floor -X 방향</td><td>로봇 좌측 (통상과 다름: 정면이 Y축)</td></tr>
                <tr><td>Y축</td><td>Floor -Y 방향</td><td>로봇 정면 (통상 X인데 여기서는 Y)</td></tr>
                <tr><td>Z축</td><td>Floor <strong>-Z</strong> 방향</td><td>거꾸로 매달림 &rarr; Z 부호 반전</td></tr>
            </table>

            <div class="note note-green">
                <strong>TCP [0, 0, 1000] 의미:</strong><br>
                Robot1 좌표계에서 Z방향으로 1000mm = Floor 기준 <strong>아래로</strong> 1000mm<br>
                &rarr; Floor Z = 2100 - 1000 = <strong>1100mm</strong> (R축 센터 수직 하방)
            </div>

            <h3>WobjFloor 정의 (Robot1용)</h3>
<pre><code>PERS wobjdata WobjFloor := [FALSE, TRUE, "",
    [[-9500, 5300, 2100], [0, 1, 0, 0]],   ! uframe: 갠트리HOME + 180&deg; Y회전
    [[0, 0, 0], [1, 0, 0, 0]]];            ! oframe: 항등

! 회전 [0, 1, 0, 0] = 180&deg; Y축 회전
!   Robot1 좌표 &rarr; Floor 좌표 변환:
!   Floor_X = -(Rob1_X) + 9500
!   Floor_Y = Rob1_Y + 5300
!   Floor_Z = -(Rob1_Z) + 2100</code></pre>
        </div>
    </div>

    <!-- 3. Robot2 좌표계 -->
    <div class="section-title red">3. Robot2 좌표계 (갠트리 미연동)</div>
    <div class="card">
        <div class="card-header">Robot2 = 독립 로봇 (갠트리와 계산으로 연동)</div>
        <div class="card-body">
            <div class="note note-red">
                <strong>ABB 제약:</strong> Robot2는 GantryRob과 <code>base_frame_coordinated</code> 설정 불가.<br>
                RAPID 코드에서 계산으로 좌표 변환을 구현해야 함.
            </div>

            <ul>
                <li><strong>MOC.cfg 설정:</strong> <code>base_frame_orient [0, 0.707107, 0.707107, 0]</code> (base_frame_coordinated 없음)</li>
                <li><strong>Base 위치:</strong> R축 센터에서 488mm 오프셋 (Robot1 반대편)</li>
                <li><strong>좌표계 원점:</strong> 로봇 <strong>베이스</strong>에 위치 (Robot1과 다름!)</li>
                <li><strong>Robot1과 마주봄:</strong> Robot1이 -Y를 보면, Robot2는 +Y를 봄</li>
            </ul>

            <h3>Robot2 좌표축 방향 (vs Floor)</h3>
            <table>
                <tr><th>Robot2 축</th><th>Floor 좌표 방향</th><th>설명</th></tr>
                <tr><td>X축</td><td>Floor +X 방향</td><td>Floor과 동일</td></tr>
                <tr><td>Y축</td><td>Floor +Y 방향</td><td>로봇 정면, Floor과 동일</td></tr>
                <tr><td>Z축</td><td>Floor <strong>+Z</strong> 방향</td><td>물리적으로 거꾸로지만 좌표계는 <strong>상향</strong></td></tr>
            </table>

            <div class="note note-cyan">
                <strong>핵심 차이:</strong> Robot2는 물리적으로 거꾸로 매달려 있지만,
                좌표계 방향은 Floor 좌표계와 <strong>동일</strong>합니다.
                (Robot1은 Z가 반전, Robot2는 Z가 동일)
            </div>

            <h3>Robot2 TCP [0, 488, -1000] 의미</h3>
<pre><code>Robot2 좌표계 기준 (원점 = Robot2 베이스):
  X = 0      : 좌우 중립
  Y = 488    : 정면(+Y) 방향 488mm = R축 센터 방향
  Z = -1000  : 아래로 1000mm (Floor Z와 동일 방향이므로 -가 아래)

Floor 좌표 기준:
  X = 9500 (갠트리 X)
  Y = 4812 + 488 = 5300 (Robot2 베이스 Y + 488mm = R축 센터 Y)
  Z = 1100 (2100 - 1000 = TCP 높이)</code></pre>
        </div>
    </div>

    <!-- 4. 좌표계 차이 원인 분석 -->
    <div class="section-title amber">4. 좌표계 차이 원인 분석</div>
    <div class="card">
        <div class="card-header">CRobT(\WObj:=WobjFloor) 측정 결과 (2026-02-21)</div>
        <div class="card-body">
            <table>
                <tr><th></th><th>Robot1 tWeld1</th><th>Robot2 tWeld2</th><th>차이</th><th>원인</th></tr>
                <tr><td><strong>X</strong></td><td>9500.002</td><td>9500.001</td><td class="ok">0.001mm</td><td>정상 (일치)</td></tr>
                <tr><td><strong>Y</strong></td><td>5300.044</td><td>4812.008</td><td class="ng">488mm</td><td>Robot1: R축센터 기준 / Robot2: 베이스 기준</td></tr>
                <tr><td><strong>Z</strong></td><td>1100.018</td><td>3100.006</td><td class="ng">2000mm</td><td>Robot1: Z반전 / Robot2: Z동일</td></tr>
            </table>

            <h3>Y 차이 (488mm)</h3>
            <div class="note note-amber">
                <strong>Robot1:</strong> 좌표 원점 = R축 센터 (베이스에서 488mm)<br>
                <strong>Robot2:</strong> 좌표 원점 = 베이스 (R축 센터에서 488mm)<br>
                &rarr; 동일 물리점이지만 기준점이 다르므로 Y값이 488mm 차이
            </div>

            <h3>Z 차이 (2000mm)</h3>
            <div class="note note-amber">
                <strong>Robot1:</strong> Z축이 Floor과 <strong>반대</strong> &rarr; Floor Z = 2100 - Rob1_Z<br>
                <strong>Robot2:</strong> Z축이 Floor과 <strong>동일</strong> &rarr; Floor Z = Rob2_base_Z + Rob2_Z<br>
                &rarr; 같은 WobjFloor 적용 시 Z에 2000mm 차이 발생
            </div>

            <h3>MOC.cfg 관련 파라미터</h3>
<pre><code>! GantryRob 5번째 축 (R축 바디에서 로봇 베이스까지의 오프셋)
LOCKED_EAW_11: length = 0.488 (488mm)
               theta_home_position = -3.14159 (-180&deg;)
               lock_joint_in_hardware / ipol / servo (고정 축)

! Robot1 base frame
ROB_1: base_frame_orient = [1, 0, 0, ~0]  (항등)
       base_frame_coordinated = "GantryRob"

! Robot2 base frame
ROB_2: base_frame_orient = [~0, 0.707107, 0.707107, ~0]
       (base_frame_coordinated 없음!)</code></pre>
        </div>
    </div>

    <!-- 5. WobjFloor_Rob2 보정 계산 -->
    <div class="section-title violet">5. WobjFloor_Rob2 보정 계산</div>
    <div class="card">
        <div class="card-header">Robot2 전용 Floor 좌표계 보정</div>
        <div class="card-body">
            <h3>현재 (잘못된 값)</h3>
<pre><code>PERS wobjdata WobjFloor_Rob2 := [FALSE, TRUE, "",
    [[-9500, 5300, 2100], [1, 0, 0, 0]],    ! 항등 회전 (오류!)
    [[0, 0, 0], [1, 0, 0, 0]]];</code></pre>

            <h3>수학적 보정</h3>
<pre><code>두 로봇 "world" 프레임 오프셋 (측정 기반):
  p_world_1 - p_world_2 = (0, 488, 2000)

WobjFloor_Rob2 보정:
  회전: WobjFloor과 동일 = [0, 1, 0, 0] (180&deg; Y축)
  위치: t_floor - world_offset
      = [-9500, 5300, 2100] - [0, -488, -2000]
      = [-9500, 4812, 100]</code></pre>

            <h3>보정된 값</h3>
<pre><code>PERS wobjdata WobjFloor_Rob2 := [FALSE, TRUE, "",
    [[-9500, 4812, 100], [0, 1, 0, 0]],     ! Y-488, Z-2000, 180&deg; Y회전
    [[0, 0, 0], [1, 0, 0, 0]]];</code></pre>

            <div class="note note-cyan">
                <strong>검증 필요:</strong> 이 값은 갠트리 HOME (R=0) 기준 측정에서 도출.<br>
                R축 회전 시에도 정상 동작하는지 추가 검증 필요 (R=45&deg;, R=90&deg; 등).
            </div>
        </div>
    </div>

    <!-- 6. 488mm 오프셋 문제 -->
    <div class="section-title red">6. 488mm 오프셋 문제 — 원인 및 수정 (2026-02-21)</div>
    <div class="card">
        <div class="card-header">문제: UI에서 Robot2 Y = 4812 (정상값 5300에서 488mm 부족)</div>
        <div class="card-body">
            <h3>원인 추적</h3>
            <p style="font-size:0.92em; margin-bottom:12px;">UI에 TCP 값을 제공하는 실제 코드는 <strong>TASK7</strong>의 <code>CalcCurrentTcp(\R2)</code> (Static.mod):</p>
<pre><code>! TASK7 Static.mod — UI 데이터 소스 (TASK8 아님!)
pR2 := CRobT(\taskname:="T_ROB2"\Tool:=tWeld2\WObj:=wobj0);
gantryAngle := MonitorPosition.monExt.eax_d;

nRotX := (pR2.trans.x * Cos(gantryAngle)) - (pR2.trans.y * Sin(gantryAngle));
nRotY := (pR2.trans.x * Sin(gantryAngle)) + (pR2.trans.y * Cos(gantryAngle));

result.trans.x := GantryX + nRotX;
result.trans.y := GantryY - nRotY;    &larr; 여기서 문제 발생
result.trans.z := GantryZ + pR2.trans.z;</code></pre>

            <div class="note note-red">
                <strong>근본 원인:</strong><br>
                <code>CRobT(T_ROB2, tWeld2, wobj0)</code>의 <code>pR2.y = 488</code>은
                Robot2 베이스에서 R-축 중심까지의 거리(LOCKED_EAW_11 = 488mm).<br>
                이 값을 <strong>R-축 중심 기준으로 변환하지 않고</strong> 그대로 회전 계산에 사용하여,<br>
                <code>result.y = 5300 - 488 = 4812</code>가 됨.
            </div>

            <h3>수정 내용</h3>
<pre><code>! 수정 전 (오류)
nRotX := (pR2.trans.x * Cos(R)) - (pR2.trans.y * Sin(R));
nRotY := (pR2.trans.x * Sin(R)) + (pR2.trans.y * Cos(R));

! 수정 후 (정상) — pR2.y에서 488mm 차감하여 R-축 중심 기준으로 변환
nRotX := (pR2.trans.x * Cos(R)) - ((pR2.trans.y - 488) * Sin(R));
nRotY := (pR2.trans.x * Sin(R)) + ((pR2.trans.y - 488) * Cos(R));</code></pre>

            <div class="note note-green">
                <strong>왜 488을 빼는가?</strong><br>
                pR2.y에는 Robot2 베이스&rarr;R축 중심 거리 488mm가 포함됨.<br>
                회전 공식은 R-축 중심을 기준으로 해야 하므로, 488mm를 빼서
                "R-축 중심 기준 오프셋"으로 변환한 뒤 회전을 적용해야 정확함.<br>
                <br>
                <strong>Robot1은 왜 정상?</strong><br>
                Robot1은 <code>WobjFloor</code>로 직접 CRobT를 호출하며, 갠트리 조정(coordinated)이므로
                ABB 컨트롤러가 LOCKED_EAW_11 오프셋을 자동 처리함.
            </div>
        </div>
    </div>

    <!-- 7. 수정 후 검증 결과 -->
    <div class="section-title green">7. 수정 후 검증 결과 (2026-02-21)</div>
    <div class="card">
        <div class="card-header">R-축 회전 각도별 TCP 비교</div>
        <div class="card-body">
            <table>
                <tr><th>R-축</th><th>Robot1 X</th><th>Robot1 Y</th><th>Robot2 X</th><th>Robot2 Y</th><th>XY 차이</th><th>상태</th></tr>
                <tr><td><strong>0&deg;</strong></td><td>9500.00</td><td>5300.04</td><td>9500.00</td><td>5300.00</td><td>0.04mm</td><td class="ok">PASS</td></tr>
                <tr><td><strong>30&deg;</strong></td><td>9499.99</td><td>5300.03</td><td>9500.00</td><td>5300.00</td><td>0.03mm</td><td class="ok">PASS</td></tr>
                <tr><td><strong>90&deg;</strong></td><td>9499.97</td><td>5300.00</td><td>9500.00</td><td>5300.00</td><td>0.03mm</td><td class="ok">PASS</td></tr>
                <tr><td><strong>-45&deg;</strong></td><td>9500.03</td><td>5300.03</td><td>9500.00</td><td>5300.00</td><td>0.04mm</td><td class="ok">PASS</td></tr>
            </table>

            <div class="note note-green">
                <strong>검증 완료:</strong> 모든 R-축 각도에서 Robot1/Robot2 TCP가 <strong>0.04mm 이내</strong>로 일치.<br>
                TCP가 R-축 중심 (9500, 5300)에 고정되어, 회전해도 위치 변동 없음 확인.
            </div>

            <h3>수정 파일 목록</h3>
            <table>
                <tr><th>파일</th><th>변경</th><th>커밋</th></tr>
                <tr><td>TASK7/PROGMOD/Static.mod</td><td>CalcCurrentTcp: pR2.y - 488 보정 추가</td><td><code>5d106a6</code></td></tr>
                <tr><td>TASK8/PROGMOD/Head_Data.mod</td><td>wobjRotCtr2 origin [488,0,0]&rarr;[0,0,0]</td><td><code>c865acc</code></td></tr>
            </table>
        </div>
    </div>

    <!-- 8. 회전(Orientation) 보정 — 원인 및 수정 (2026-02-21) -->
    <div class="section-title red">8. 회전(Orientation) 보정 — R-축 회전 미반영 수정 (2026-02-21)</div>
    <div class="card">
        <div class="card-header">문제: R-축 회전 시 Robot2 Rx 고정, Robot1만 변동</div>
        <div class="card-body">
            <h3>증상</h3>
            <table>
                <tr><th>R-축</th><th>Robot1 Rx</th><th>Robot2 Rx</th><th>상태</th></tr>
                <tr><td>0&deg;</td><td>90.00</td><td>-90.00</td><td class="ok">정상</td></tr>
                <tr><td>30&deg;</td><td>60.00</td><td><strong>-90.00</strong></td><td class="warn">변동 없음!</td></tr>
                <tr><td>-30&deg;</td><td>120.00</td><td><strong>-90.00</strong></td><td class="warn">변동 없음!</td></tr>
            </table>
            <p style="margin-top:8px;">Robot1은 갠트리 조정(coordinated)이므로 R-축 회전이 자동 반영. Robot2는 미조정(독립)이므로 수동 보정 필요.</p>

            <h3>원인 분석 (v2.0.2 진단 로그)</h3>
<pre><code>! RAPID EulerZYX 분해 결과 (t_bg_diag.txt)
pR2.rot = [0.54167, -0.45453, -0.45453, -0.54167]
EulerZYX: Z=-90.0000  Y=-80.0018  X=0.0000

! Robot2는 갠트리 미조정 → wobj0 기준 CRobT
! R-축 회전에도 쿼터니언 불변 → UI에 반영 안됨</code></pre>

            <div class="note note-red">
                <strong>근본 원인:</strong><br>
                Robot2의 <code>CRobT(\WObj:=wobj0)</code> 쿼터니언은 R-축 회전과 무관하게 고정.<br>
                Robot1은 <code>WobjFloor</code>(갠트리 조정)로 읽으므로 R-축 보정이 자동 적용되지만,<br>
                Robot2는 <code>wobj0</code>(로봇 베이스 고정)이므로 R-축 회전이 반영되지 않음.
            </div>

            <h3>수정 — EulerZYX Z축 보정</h3>
<pre><code>! 수정 전 (회전 미보정)
result.rot := pR2.rot;  ! R-축 회전 무관하게 고정

! 수정 후 (v2.0.2) — gantryAngle만큼 Z Euler 보정
result.rot := OrientZYX(
    EulerZYX(\Z, pR2.rot) - gantryAngle,   ! Z: -90 - R
    EulerZYX(\Y, pR2.rot),                  ! Y: -80 (불변)
    EulerZYX(\X, pR2.rot));                 ! X: 0 (불변)</code></pre>

            <div class="note note-green">
                <strong>원리:</strong><br>
                Robot1의 Rx = 90 - R (갠트리 자동 보정).<br>
                Robot2의 Rx도 동일하게 보정: EulerZYX(\Z) - gantryAngle = -90 - R<br>
                → UI에서 Robot2 Rx = -(90 + R) 으로 Robot1과 대칭 표시.
            </div>
        </div>
    </div>

    <!-- 9. 최종 검증 결과 -->
    <div class="section-title green">9. 최종 검증 결과 — 위치 + 회전 (v2.0.2, 2026-02-21)</div>
    <div class="card">
        <div class="card-header">R-축 회전 각도별 TCP 위치 + 회전 비교</div>
        <div class="card-body">
            <h3>위치 (mm)</h3>
            <table>
                <tr><th>R-축</th><th>Robot1 X</th><th>Robot1 Y</th><th>Robot2 X</th><th>Robot2 Y</th><th>XY 차이</th><th>상태</th></tr>
                <tr><td><strong>0&deg;</strong></td><td>9500.00</td><td>5300.06</td><td>9500.00</td><td>5300.00</td><td>0.06mm</td><td class="ok">PASS</td></tr>
                <tr><td><strong>30&deg;</strong></td><td>9499.98</td><td>5300.05</td><td>9500.00</td><td>5300.00</td><td>0.05mm</td><td class="ok">PASS</td></tr>
                <tr><td><strong>-30&deg;</strong></td><td>9500.03</td><td>5300.05</td><td>9500.00</td><td>5300.00</td><td>0.06mm</td><td class="ok">PASS</td></tr>
            </table>

            <h3>회전 (&deg;)</h3>
            <table>
                <tr><th>R-축</th><th>Robot1 Rx</th><th>Robot1 Rz</th><th>Robot2 Rx</th><th>Robot2 Rz</th><th>Rx 대칭</th><th>상태</th></tr>
                <tr><td><strong>0&deg;</strong></td><td>90.00</td><td>0.00</td><td>-90.00</td><td>0.00</td><td>|90|=|&minus;90| &check;</td><td class="ok">PASS</td></tr>
                <tr><td><strong>30&deg;</strong></td><td>60.00</td><td>0.00</td><td>-60.00</td><td>0.00</td><td>|60|=|&minus;60| &check;</td><td class="ok">PASS</td></tr>
                <tr><td><strong>-30&deg;</strong></td><td>120.00</td><td>0.00</td><td>-120.00</td><td>0.00</td><td>|120|=|&minus;120| &check;</td><td class="ok">PASS</td></tr>
            </table>

            <div class="note note-green">
                <strong>검증 완료:</strong><br>
                &bull; <strong>위치:</strong> 모든 R-축 각도에서 Robot1/Robot2 TCP 0.06mm 이내 일치<br>
                &bull; <strong>회전:</strong> Robot1 Rx = 90 - R, Robot2 Rx = -(90 + R) 완벽 대칭<br>
                &bull; <strong>Ry = -80&deg;</strong> 고정 (양쪽 동일), <strong>Rz = 0&deg;</strong> 유지<br>
                &bull; 488mm 위치 오프셋 + R-축 회전 보정 모두 정상 동작 확인
            </div>

            <h3>수정 파일 목록</h3>
            <table>
                <tr><th>파일</th><th>버전</th><th>변경</th></tr>
                <tr><td>TASK7/PROGMOD/Static.mod</td><td>v2.0.2</td><td>CalcCurrentTcp: 488mm 위치 보정 + EulerZYX 회전 보정 + 버전 로깅</td></tr>
                <tr><td>TASK8/PROGMOD/Head_Data.mod</td><td>v1.9.41</td><td>wobjRotCtr2 origin [488,0,0]&rarr;[0,0,0]</td></tr>
                <tr><td>TASK1/PROGMOD/VersionModule.mod</td><td>v2.0.1</td><td>TASK_BG_VERSION 업데이트</td></tr>
            </table>

            <h3>진단 로그 (v2.0.2)</h3>
<pre><code>! HOME:/t_bg_version.txt
T_BG Static (v2.0.2) Date=2026-02-21 Time=22:18:45

! HOME:/t_bg_diag.txt (자동 기록, 1회)
pR2.rot=[0.54167,-0.45453,-0.45453,-0.54167]
gantryAngle=0.00
EulerZYX: Z=-90.0000 Y=-80.0018 X=0.0000
monPose1.rot=[0.38310,0.55658,-0.32156,0.66337]
monPose2.rot=[0.54167,-0.45453,-0.45453,-0.54167]</code></pre>
        </div>
    </div>

    <!-- 10. UI 표시값 현황 -->
    <div class="section-title green">10. UI 표시값 최종 현황 (v2.0.2)</div>
    <div class="card">
        <div class="card-header">상위 시스템(UI)에서 수신하는 TCP 값 — R=0° 기준</div>
        <div class="card-body">
            <table>
                <tr><th></th><th>Robot1</th><th>Robot2</th><th>상태</th></tr>
                <tr><td><strong>X (mm)</strong></td><td>9500.00</td><td>9500.00</td><td class="ok">정상</td></tr>
                <tr><td><strong>Y (mm)</strong></td><td>5300.06</td><td>5300.00</td><td class="ok">정상 (488mm 보정 완료)</td></tr>
                <tr><td><strong>Z (mm)</strong></td><td>1100.00</td><td>1100.00</td><td class="ok">정상</td></tr>
                <tr><td><strong>Rx (&deg;)</strong></td><td>90.00</td><td>-90.00</td><td class="ok">대칭 (R-축 회전 보정 완료)</td></tr>
                <tr><td><strong>Ry (&deg;)</strong></td><td>-80.00</td><td>-80.00</td><td class="ok">동일</td></tr>
                <tr><td><strong>Rz (&deg;)</strong></td><td>0.00</td><td>0.00</td><td class="ok">동일</td></tr>
            </table>
        </div>
    </div>
</div>
</body>
</html>
