# ABB RAPID 좌표계 분석 결과

**작성일**: 2025-12-11
**프로젝트**: SpGantry 듀얼 로봇 시스템
**버전**: v2.3.0

---

## 질문 답변

### 1. 로봇1과 로봇2 모두 적용되었는가?

✅ **예, 모두 적용되었습니다.**

- **TASK1 (Robot1)**: `CheckNewerHome_World` 프로시저 추가 (Line 1055)
- **TASK2 (Robot2)**: `CheckNewerHome_World` 프로시저 추가 (Line 1142)

**출력 파일**:
- `HOME:/world_coords_newer_home_robot1.txt`
- `HOME:/world_coords_newer_home_robot2.txt`

---

### 2. 월드 좌표계가 아닌 다른 좌표계가 있는가?

✅ **예, ABB RAPID는 여러 좌표계를 지원합니다.**

#### ABB RAPID 좌표계 체계:

```
World Coordinate System (전역)
  │
  ├─> Robot1 Base Coordinate System
  │    └─> WobjFloor (플로어 좌표계)
  │         └─> wobj0 (작업 객체 좌표계)
  │
  └─> Robot2 Base Coordinate System
       └─> WobjFloor (플로어 좌표계)
            └─> wobj0 (작업 객체 좌표계)
```

#### 주요 좌표계 설명:

| 좌표계 | 영문명 | 용도 | CRobT 사용법 |
|--------|--------|------|--------------|
| **월드 좌표계** | World Coordinate System | 전역 기준, 절대 위치 | `CRobT(\Tool:=tool0)` |
| **로봇 베이스** | Robot Base Coordinate | 각 로봇의 기준점 | 계산으로 변환 |
| **플로어 좌표계** | WobjFloor | 작업 공간 바닥 기준 | `CRobT(\Tool:=tool0\WObj:=WobjFloor)` |
| **작업 객체** | wobj0, wobj1, ... | 작업물 기준 | `CRobT(\Tool:=tool0\WObj:=wobj0)` |
| **툴 좌표계** | Tool Coordinate | TCP 기준 | tool0, tWeld1 등 |

---

### 3. 정반 좌표계나 플로어 좌표계가 있는가?

✅ **예, `WobjFloor` 좌표계가 정의되어 있습니다.**

#### WobjFloor 정의 (TASK1 & TASK2 동일):

```rapid
PERS wobjdata WobjFloor:=[
    FALSE,              ! robhold - 로봇이 작업물을 들고 있지 않음
    TRUE,               ! ufprog - 사용자 프레임 사용
    "",                 ! ufmec - 외부 메커니즘 없음
    [[-9500,5300,2100], ! uframe.trans - 사용자 프레임 위치 (mm)
     [0,1,0,0]],        ! uframe.rot - 180° Y축 회전
    [[0,0,0],           ! oframe.trans - 객체 프레임 위치
     [1,0,0,0]]         ! oframe.rot - 회전 없음
];
```

#### WobjFloor 좌표계 분석:

**User Frame (플로어 기준점)**:
- X = -9500 mm
- Y = 5300 mm
- Z = 2100 mm
- 회전: [0,1,0,0] → 180도 Y축 회전 (뒤집힌 상태)

**Object Frame**:
- 원점: [0,0,0] (User Frame 기준)
- 회전 없음: [1,0,0,0]

**용도**:
- 작업 공간의 **바닥(플로어)** 기준 좌표계
- "정반 좌표계"라고도 부를 수 있음
- 모든 작업물이 놓이는 공통 기준면

---

## 현재 시스템의 좌표계 구성

### Robot1 좌표계 관계:

```
World (0, 0, 0)
  └─> Robot1 Base (World 기준 위치)
       ├─> WobjFloor [-9500, 5300, 2100] (World 기준)
       │    └─> wobj0 [-488, 0, 0] (Robot1 Base 기준)
       └─> TCP (현재 도구 위치)
```

**좌표 변환**:
- `World → Robot1 Base`: 시스템 정의 변환
- `Robot1 Base → wobj0`: X축 -488mm 오프셋
- `Robot1 Base → WobjFloor`: World 기준 [-9500, 5300, 2100]

### Robot2 좌표계 관계:

```
World (0, 0, 0)
  └─> Robot2 Base (World 기준 위치)
       ├─> WobjFloor [-9500, 5300, 2100] (World 기준)
       │    └─> wobj0 [0, 0, 0] (Robot2 Base = wobj0)
       └─> TCP (현재 도구 위치)
```

**좌표 변환**:
- `World → Robot2 Base`: 시스템 정의 변환
- `Robot2 Base = wobj0`: 오프셋 없음
- `Robot2 Base → WobjFloor`: World 기준 [-9500, 5300, 2100]

---

## CRobT 함수 사용법 정리

### 1. World 좌표계로 TCP 읽기:
```rapid
robtarget world_pose;
world_pose := CRobT(\Tool:=tool0);
! WObj 파라미터 없음 → World 좌표계
```

### 2. wobj0 좌표계로 TCP 읽기:
```rapid
robtarget wobj_pose;
wobj_pose := CRobT(\Tool:=tool0\WObj:=wobj0);
! wobj0 기준 좌표
```

### 3. WobjFloor 좌표계로 TCP 읽기:
```rapid
robtarget floor_pose;
floor_pose := CRobT(\Tool:=tool0\WObj:=WobjFloor);
! 플로어(정반) 기준 좌표
```

### 4. Robot Base 좌표계 계산:
```rapid
! Robot1 Base 좌표
robtarget wobj_pose;
wobj_pose := CRobT(\Tool:=tool0\WObj:=wobj0);
robot1_base_x := wobj_pose.trans.x + 488;  ! wobj0 → Robot1 Base

! Robot2 Base 좌표
robtarget robot2_pose;
robot2_pose := CRobT(\Tool:=tool0\WObj:=wobj0);
robot2_base_x := robot2_pose.trans.x;  ! wobj0 = Robot2 Base
```

---

## 좌표계 선택 가이드

### 언제 어떤 좌표계를 사용할까?

| 상황 | 권장 좌표계 | 이유 |
|------|------------|------|
| 두 로봇 간 절대 위치 비교 | **World** | 공통 기준점 |
| 작업물 기준 용접/작업 | **wobj0** | 작업물 중심 |
| 바닥/정반 기준 측정 | **WobjFloor** | 작업 공간 바닥 기준 |
| 개별 로봇 제어 | **Robot Base** | 각 로봇 독립 제어 |
| confdata 분석 | **wobj0** | 로봇 자세 분석 |
| 정밀 측정/캘리브레이션 | **WobjFloor** 또는 **World** | 고정 기준면 |

---

## 현재 구현된 프로시저

### v2.3.0 - CheckNewerHome_World

**기능**: 세 가지 좌표계로 TCP 출력
1. World (전역 좌표계)
2. wobj0 (작업 객체 좌표계)
3. Robot Base (로봇 베이스 좌표계)

**테스트 경로**: (310, 0, 1050) → (350, 0, 1050) in Robot Base

### 추가 가능한 프로시저 (제안)

#### CheckNewerHome_Floor
```rapid
PROC CheckNewerHome_Floor()
    ! WobjFloor 좌표계로 TCP 출력
    VAR robtarget floor_pose;
    floor_pose := CRobT(\Tool:=tool0\WObj:=WobjFloor);
    ! 플로어 기준 좌표 출력
ENDPROC
```

**용도**:
- 작업 공간 바닥 기준 위치 확인
- 정반 기준 측정
- 두 로봇의 플로어 기준 위치 비교

---

## 좌표계 변환 수식

### Robot1 좌표 변환:

```
World ↔ Robot1 Base: (시스템 정의)
Robot1 Base ↔ wobj0: X_wobj0 = X_base - 488
Robot1 Base ↔ WobjFloor: (World 기준 변환)
```

### Robot2 좌표 변환:

```
World ↔ Robot2 Base: (시스템 정의)
Robot2 Base = wobj0: X_wobj0 = X_base (직접)
Robot2 Base ↔ WobjFloor: (World 기준 변환)
```

---

## 결론

### ✅ 확인된 사항:

1. **로봇1/로봇2 모두 적용**: `CheckNewerHome_World` 프로시저 구현 완료
2. **다양한 좌표계 존재**: World, Robot Base, wobj0, WobjFloor, Tool 등
3. **플로어 좌표계 있음**: `WobjFloor` 정의됨 (위치: [-9500, 5300, 2100])

### 📋 권장사항:

1. **WobjFloor 활용 고려**: 정반 기준 측정 시 유용
2. **좌표계별 프로시저 추가**: CheckNewerHome_Floor 등
3. **좌표 변환 검증**: World ↔ WobjFloor 변환 확인

### 🔍 추가 조사 필요:

1. WobjFloor의 정확한 캘리브레이션 상태
2. World 좌표계의 원점 위치 (실제 공간 어디인지)
3. 두 로봇의 World 기준 베이스 위치

---

**문서 끝**
