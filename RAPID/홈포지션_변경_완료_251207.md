# 홈 포지션 변경 완료

**작업일**: 2025-12-07
**작업자**: SP 심태양
**프로젝트**: S25016 SpGantry 1200
**사유**: 로봇 간섭 문제 회피

---

## 🎯 변경 사항

### 홈 포지션 수정

**이전 홈 포지션**:
```
[0, 0, 0, 0, -90, 0]

로봇1축: 0°
로봇2축: 0°
로봇3축: 0°
로봇4축: 0°
로봇5축: -90°
로봇6축: 0°
```

**새 홈 포지션** (간섭 회피):
```
[0, -45, 0, 0, -45, 0]

로봇1축: 0°
로봇2축: -45°
로봇3축: 0°
로봇4축: 0°
로봇5축: -45°
로봇6축: 0°
```

**변경 이유**:
- ❌ 이전: 로봇1과 로봇2가 홈 포지션에서 간섭 발생
- ✅ 개선: 축2, 축5를 -45°로 조정하여 간섭 회피

---

## ✅ 수정된 파일 (3개)

### 1. HomePositionTest.mod (TASK2) ✅

**파일**: `RAPID/TASK2/PROGMOD/HomePositionTest.mod`

**버전**: v1.0_251205 → **v1.1_251207**

**주요 변경**:

```rapid
! 이전
MoveAbsJ [[0,0,0,0,-90,0],[0,0,0,0,0,0]], v100, fine, tWeld2;

! 수정 후
MoveAbsJ [[0,-45,0,0,-45,0],[0,0,0,0,0,0]], v100, fine, tWeld2;
```

**헤더 업데이트**:
```rapid
! Module: HomePositionTest (TASK2 - Robot2)
! Version: v1.1_251207
! Last Modified: 2025-12-07
!
! Description:
! - Move Robot2 to home position [0,-45,0,0,-45,0]
!
! Change History:
! v1.1_251207 (2025-12-07) - Changed home position to avoid interference
!                          - New position: [0,-45,0,0,-45,0]
!                          - Previous: [0,0,0,0,-90,0]
```

---

### 2. FloorMonitor_Task2.mod (TASK2) ✅

**파일**: `RAPID/TASK2/PROGMOD/FloorMonitor_Task2.mod`

**버전**: v1.1_251205 (변경 없음, 내용만 수정)

**주요 변경**:

출력 파일 내용 수정 (Line 143-144):
```rapid
Write logfile, "Home Position: [0, -45, 0, 0, -45, 0]";
Write logfile, "  Note: Changed to avoid robot interference";
```

**위치**: 결과 파일 헤더 섹션

---

### 3. MonitorFloorCoordinates.mod (TASK1) ✅

**파일**: `RAPID/TASK1/PROGMOD/MonitorFloorCoordinates.mod`

**버전**: v2.0_251205 (변경 없음, 내용만 수정)

**주요 변경**:

1. **로봇 이동 명령** (Line 173):
```rapid
! 이전
MoveAbsJ [[0, 0, 0, 0, -90, 0], [0, 0, 0, 0, 0, 0]], v100, fine, tWeld1;

! 수정 후
MoveAbsJ [[0, -45, 0, 0, -45, 0], [0, 0, 0, 0, 0, 0]], v100, fine, tWeld1;
```

2. **출력 파일 내용** (Line 408-409):
```rapid
Write logfile, "Home Position: [0, -45, 0, 0, -45, 0]";
Write logfile, "  Note: Changed to avoid robot interference";
```

---

## 📊 변경 영향 분석

### 영향받는 기능

| 기능 | 영향 | 조치 필요 |
|------|------|----------|
| 홈 위치 이동 | ✅ 간섭 해결 | 없음 |
| TCP 측정 | ⚠️ 좌표값 변경됨 | 재측정 필요 |
| WobjFloor 테스트 | ⚠️ 기준 위치 변경 | 재테스트 필요 |
| 이전 측정 데이터 | ❌ 비교 불가 | 새로 측정 |

### 예상 좌표값 변화

**Robot2 예상 변화**:

```
이전 홈 [0,0,0,0,-90,0]:
  tool0 (World): ???
  tool0 (WobjFloor): [9951.000, 5300.000, 1128.900]

새 홈 [0,-45,0,0,-45,0]:
  tool0 (World): ??? (변경됨)
  tool0 (WobjFloor): ??? (재측정 필요)
```

**TCP 오프셋은 동일**:
- ✅ tWeld1: [319.99, 0, 331.83] mm (변경 없음)
- ✅ tWeld2: [319.99, 0, 331.83] mm (변경 없음)
- ✅ tWeldTest1/2: [300, 0, 300] mm (변경 없음)

**상대 위치 관계**:
- ✅ Robot1 ↔ Robot2 분리 거리: 976mm (변경 없음)
- ✅ TCP 오프셋: 변경 없음
- ⚠️ 절대 좌표: 변경됨 (재측정 필요)

---

## 🔍 주의사항

### 1. 이전 데이터와 비교 불가

**이전 테스트 결과** (홈 [0,0,0,0,-90,0]):
```
HOME:/floor_coordinates_at_home_task2.txt (2025-12-05)
Robot2 tool0: [9951.000, 5300.000, 1128.900]
Robot2 tWeld2: [10270.990, 5300.000, 797.070]
```

**새 측정 결과** (홈 [0,-45,0,0,-45,0]):
```
Robot2 tool0: ??? (재측정 필요)
Robot2 tWeld2: ??? (재측정 필요)
```

⚠️ **절대 좌표값이 다르므로 직접 비교하지 마세요**

---

### 2. TCP 오프셋은 동일

**검증 방법**:
```
tool0 위치를 A라고 하면,
tWeld 위치 = A + TCP 오프셋

TCP 오프셋 = tWeld - tool0
           = 변하지 않음 (홈 포지션과 무관)
```

**검증 예시** (테스트 모드):
```
Robot2 tool0 X = A mm
Robot2 tWeldTest2 X = B mm

차이 = B - A
     = 300 mm (예상)

→ 홈 포지션이 바뀌어도 차이는 300mm로 동일
```

---

### 3. 재테스트 필요

**테스트 순서**:
```
1. RobotStudio에서 모듈 재로드
2. Program Check 실행
3. 새 홈 포지션으로 이동 테스트
   % MoveToHomeAndCheckTCP
4. 간섭 확인 (시뮬레이션 또는 실제)
5. TCP 측정
   % MonitorFloorAtHome_Task2 \UseTestTCP
6. TCP 오프셋 검증 (300mm 또는 319.99mm)
```

---

## 📋 출력 파일 예시

### 새 홈 포지션 결과 파일

**HOME:/floor_coordinates_at_home_task2.txt**:
```
========================================
Floor Coordinates at Home Position (TASK2)
========================================

Program Version: v1.1_251205
Module: FloorMonitor_Task2
Procedure: MonitorFloorAtHome_Task2

TCP Mode: TEST MODE
  TCP Offset: [300.00, 0, 300.00] mm

Date: 2025-12-07
Time: HH:MM:SS

Executed from: TASK2
Home Position: [0, -45, 0, 0, -45, 0]
  Note: Changed to avoid robot interference

========================================
System Configuration
========================================

... (설정 정보)

========================================
Robot2 - tool0 (Flange)
========================================
  X = ??? mm  (새 측정값)
  Y = ??? mm
  Z = ??? mm

========================================
Robot2 - tWeldTest2 (Torch)
========================================
  X = ??? mm  (새 측정값)
  Y = ??? mm
  Z = ??? mm
  TCP offset: [300.00, 0, 300.00] mm
```

---

## 🚀 다음 단계

### 즉시 실행

```
□ RobotStudio 열기
□ 수정된 파일 재로드 (또는 RobotStudio 재시작)
□ Program Check 실행
□ 새 홈 포지션 테스트
  % MoveToHomeAndCheckTCP
□ 간섭 확인
  - Robot1과 Robot2 동시 홈 위치 확인
  - 충돌 여부 확인
□ TCP 측정 (테스트 모드)
  % MonitorFloorAtHome_Task2 \UseTestTCP
□ 결과 검증
  - TCP 오프셋 = 300mm 확인
  - 새 좌표값 기록
```

---

## ⚠️ 간섭 검증 체크리스트

### 시뮬레이션 확인

```
□ Robot1 홈 [0,-45,0,0,-45,0] 이동
□ Robot2 홈 [0,-45,0,0,-45,0] 이동
□ 동시 홈 위치 확인
□ 로봇 간 최소 거리 측정
□ 안전 거리 확보 확인 (권장: 100mm 이상)
```

### 실제 로봇 확인 (주의!)

```
□ 시뮬레이션 먼저 완료 (필수)
□ 저속 모드 설정 (v10)
□ Robot1 단독 홈 이동
□ Robot2 단독 홈 이동
□ 양 로봇 동시 홈 이동 (저속)
□ 간섭 없음 확인
□ 정상 속도(v100) 테스트
```

---

## 📚 관련 문서

### 업데이트 필요 문서

1. **다음단계_실행가이드_251207.md**
   - [ ] 홈 포지션 `[0,0,0,0,-90,0]` → `[0,-45,0,0,-45,0]` 변경
   - [ ] 예상 좌표값 재계산

2. **작업_점검_및_진행계획_251205.md**
   - [ ] 홈 포지션 정보 업데이트

3. **TCP_선택기능_가이드_251205.md**
   - [ ] 홈 포지션 명시

---

## 📊 비교표

### 홈 포지션 비교

| 항목 | 이전 | 새로운 | 변경 |
|------|------|--------|------|
| 축1 | 0° | 0° | - |
| 축2 | 0° | **-45°** | ✅ |
| 축3 | 0° | 0° | - |
| 축4 | 0° | 0° | - |
| 축5 | -90° | **-45°** | ✅ |
| 축6 | 0° | 0° | - |

### 영향 범위

| 대상 | 영향 | 조치 |
|------|------|------|
| Robot1 | 홈 위치 변경 | 재테스트 |
| Robot2 | 홈 위치 변경 | 재테스트 |
| TCP 정의 | 영향 없음 | 조치 불필요 |
| WobjFloor | 영향 없음 | 조치 불필요 |
| 절대 좌표 | 값 변경됨 | 재측정 |
| 상대 거리 | 영향 없음 | 조치 불필요 |

---

## ✨ 요약

**변경 완료**:
- ✅ HomePositionTest.mod (TASK2) - v1.1_251207
- ✅ FloorMonitor_Task2.mod (TASK2) - 출력 내용 수정
- ✅ MonitorFloorCoordinates.mod (TASK1) - 이동 명령 및 출력 수정

**새 홈 포지션**:
- `[0, -45, 0, 0, -45, 0]`
- 로봇 간섭 문제 해결

**다음 단계**:
1. RobotStudio에서 테스트
2. 간섭 없음 확인
3. TCP 측정 재실행
4. 새 기준 데이터 확립

---

**작업 완료**: 2025-12-07
**상태**: ✅ RAPID 코드 수정 완료
**다음**: RobotStudio에서 간섭 검증 및 재측정
