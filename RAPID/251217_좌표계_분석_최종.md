# ì¢Œí‘œê³„ ë¶„ì„ ë° Robot2 ì¢Œí‘œ ë³€í™˜ ì„¤ê³„

**ì‘ì„±ì¼**: 2025-12-17
**ë²„ì „**: v2.0 (MOC.cfg ë¶„ì„ ì™„ë£Œ)

---

## ğŸ¯ í•µì‹¬ ë°œê²¬ì‚¬í•­

### 1. MOC.cfg ë¶„ì„ ê²°ê³¼

#### ROB_1 (Robot1) - Line 89-98
```cfg
-name "ROB_1"
-base_frame_coordinated "GantryRob"   â† â­ ê° íŠ¸ë¦¬ì— coordinated!
```
âœ… **Robot1ì€ GantryRobì— coordinatedë˜ì–´ ìˆìŒ**
- base_frame ìœ„ì¹˜ ëª…ì‹œ ì—†ìŒ â†’ default (0, 0, 0) in GantryRob frame

#### ROB_2 (Robot2) - Line 100-109
```cfg
-name "ROB_2"
-base_frame_pos_x 0.488
-base_frame_pos_y -0.374568
-base_frame_pos_z 1.4
-base_frame_orient_u0 0
-base_frame_orient_u2 1
```
âŒ **Robot2ëŠ” GantryRobì— coordinatedë˜ì§€ ì•ŠìŒ!**
- base_frame ìœ„ì¹˜: (0.488, -0.374568, 1.4) meters
- ì˜¤ë¦¬ì—”í…Œì´ì…˜: u0=0, u2=1 â†’ **180ë„ íšŒì „**

#### GantryRob - Line 111-115
```cfg
-name "GantryRob"
-use_joint_0 "M1DM3"   ! X1 axis
-use_joint_1 "M2DM3"   ! Y axis
-use_joint_2 "M3DM3"   ! Z axis
-use_joint_3 "M4DM3"   ! R axis (rotation)
-use_joint_4 "LOCKED_EAW_11"  ! locked at 488mm
-base_frame_orient_u0 0.5
-base_frame_orient_u1 0.5
-base_frame_orient_u2 -0.5
-base_frame_orient_u3 0.5
```
**Quaternion (0.5, 0.5, -0.5, 0.5) = Zì¶• ê¸°ì¤€ 90ë„ íšŒì „!**

#### LOCKED_EAW_11 - Line 469-470
```cfg
-name "LOCKED_EAW_11"
-length 0.488
-theta_home_position -3.14159  ! -180ë„
```
**ê¸¸ì´ = 488mm (ì‚¬ìš©ì ì •ë³´ì™€ ì¼ì¹˜!)**

---

## ğŸ“ ë¬¼ë¦¬ì  êµ¬ì¡° (Floor ì¢Œí‘œê³„ ê¸°ì¤€)

### ì‚¬ìš©ì ì œê³µ ì •ë³´

```
Floor ì¢Œí‘œê³„ (ì •ë°˜ ì¢Œí‘œê³„):
                    â†‘ +Y
                    â”‚
        Robot1      â”‚      Robot2
         Base       â”‚       Base
          â”‚         â”‚         â”‚
          â”œâ”€ 488mm â”€â”¼â”€ 488mm â”€â”¤
          â”‚         â”‚         â”‚
          â”‚    R-axis center  â”‚
          â”‚    (ê° íŠ¸ë¦¬ íšŒì „ ì¤‘ì‹¬)â”‚
          â”‚         â”‚         â”‚
     +Yë°©í–¥        ì›ì       -Yë°©í–¥
    (+488mm)      (0,0)    (-488mm)
          â”‚         â”‚         â”‚
    Robot1 wobj0=   â”‚    Robot2 wobj0=
    Rì¶• ì¤‘ì‹¬        â”‚    Robot2 Base
   (Robot Base-488) â”‚   (Rì¶• ì¤‘ì‹¬-488)
```

### Robot1 ì¢Œí‘œê³„

- **Robot1 wobj0** = Rì¶• íšŒì „ ì¤‘ì‹¬ (Floor ì¢Œí‘œ ê¸°ì¤€)
- **Robot1 Base** = wobj0 + 488mm (+Y ë°©í–¥)
- Robot1ì˜ ê²½ìš°: **wobj0 ê¸°ì¤€ìœ¼ë¡œ ë¡œë´‡ì€ -488mm ë–¨ì–´ì ¸ ìˆìŒ**

### Robot2 ì¢Œí‘œê³„

- **Robot2 Base** = Rì¶• ì¤‘ì‹¬ - 488mm (-Y ë°©í–¥ in Floor)
- **Robot2 wobj0** = Robot2 Base (ë™ì¼ ìœ„ì¹˜!)
- Robot2 wobj0 â‰  Rì¶• ì¤‘ì‹¬

### ì¢Œí‘œê³„ ë°©í–¥ ê´€ê³„ (ì‚¬ìš©ì ì œê³µ)

```
Robot1 wobj0 â†” Robot2 wobj0:
- Xì¶•: ê°™ì€ ë°©í–¥, ë°˜ëŒ€ ë¶€í˜¸ (ë¯¸ëŸ¬ ëŒ€ì¹­)
- Yì¶•: ê°™ì€ ë°©í–¥, ë°˜ëŒ€ ë¶€í˜¸ (ë¯¸ëŸ¬ ëŒ€ì¹­)
- Zì¶•: ê°™ì€ ë°©í–¥ (ë™ì¼)
```

**ê²°ë¡ **: Robot1ê³¼ Robot2ëŠ” **Floor Yì¶• ê¸°ì¤€ ë¯¸ëŸ¬ ëŒ€ì¹­**

---

## ğŸ” ì¢Œí‘œê³„ ë³€í™˜ ë§¤í•‘

### Gantry â†’ World ì¢Œí‘œê³„ (v3.1.1 í…ŒìŠ¤íŠ¸ ê¸°ì¤€)

v3.1.1 í…ŒìŠ¤íŠ¸ ê²°ê³¼:
- Gantry Xì¶• ì´ë™ â†’ World **Y** ë³€í™”
- Gantry Yì¶• ì´ë™ â†’ World **X** ë³€í™”
- Gantry Zì¶• ì´ë™ â†’ World **Z** ë³€í™” (1:1 ì§ì ‘ ë§¤í•‘)

**Gantry base_frame quaternion (0.5, 0.5, -0.5, 0.5) = Zì¶• ê¸°ì¤€ 90ë„ íšŒì „ í™•ì¸!**

### MOC.cfgì™€ ì‚¬ìš©ì ì •ë³´ í†µí•©

#### Floor ì¢Œí‘œê³„ ê¸°ì¤€ (ì‹¤ì œ ê¸°ê³„ êµ¬ì¡°)

```
Floor X: â† â†’ (ì‘ì—…ë¬¼ ë°©í–¥?)
Floor Y: â†‘ (Robot1) â†“ (Robot2)
Floor Z: â¬† (ìˆ˜ì§ ìœ„)
```

#### Gantry ì¢Œí‘œê³„ (GantryRob base_frame)

```
Gantry X: M1DM3 (ì£¼ì¶•) + ELM_X (ë³´ì¡°ì¶•, ë™ê¸°)
Gantry Y: M2DM3
Gantry Z: M3DM3
Gantry R: M4DM3 (íšŒì „)
```

#### World ì¢Œí‘œê³„ (ABB ì»¨íŠ¸ë¡¤ëŸ¬ ê¸°ì¤€)

```
World = Gantry 90ë„ íšŒì „
World X = Gantry Y
World Y = Gantry X
World Z = Gantry Z
```

---

## ğŸ¯ Robot2 ì¢Œí‘œ ë³€í™˜ ì„¤ê³„

### í•µì‹¬ ë¬¸ì œ

1. **Robot2ëŠ” GantryRobì— coordinatedë˜ì§€ ì•ŠìŒ** (MOC.cfg í™•ì¸)
2. **Robot2ê°€ `CJointT()` ì‹¤í–‰ ì‹œ ê° íŠ¸ë¦¬ ì™¸ë¶€ì¶• í¬í•¨ ì—¬ë¶€ ë¶ˆëª…**
3. **í…ŒìŠ¤íŠ¸ë¡œ í™•ì¸ í•„ìš”**

### ì‹œë‚˜ë¦¬ì˜¤ A: Robot2ê°€ ì™¸ë¶€ì¶• ì½ê¸° **ë¶ˆê°€ëŠ¥**

**ì˜ˆìƒ**: Robot2ëŠ” ë…ë¦½ì ì¸ mechanical unitì´ë¯€ë¡œ ê° íŠ¸ë¦¬ ì •ë³´ ì—†ìŒ

**í•´ê²°ì±…**: TASK1ìœ¼ë¡œë¶€í„° ê° íŠ¸ë¦¬ ìœ„ì¹˜ ê³µìœ 

```rapid
! TASK1ì—ì„œ ì—…ë°ì´íŠ¸
TASK PERS num shared_gantry_x;  ! Gantry X1
TASK PERS num shared_gantry_y;  ! Gantry Y
TASK PERS num shared_gantry_z;  ! Gantry Z
TASK PERS num shared_gantry_r;  ! Gantry R

! TASK2ì—ì„œ ì½ê¸°
PROC GetRobot2WorldPosition()
    VAR robtarget tcp_local;
    VAR robtarget tcp_world;
    VAR num gx, gy, gz, gr;

    ! 1. TASK1ìœ¼ë¡œë¶€í„° ê° íŠ¸ë¦¬ ìœ„ì¹˜
    gx := shared_gantry_x;
    gy := shared_gantry_y;
    gz := shared_gantry_z;
    gr := shared_gantry_r;

    ! 2. Robot2 ë¡œì»¬ TCP (wobj0 ê¸°ì¤€ = Robot2 Base ê¸°ì¤€)
    tcp_local := CRobT(\Tool:=tool0\WObj:=wobj0);

    ! 3. World ì¢Œí‘œ ë³€í™˜
    tcp_world := TransformRobot2ToWorld(tcp_local, gx, gy, gz, gr);

    RETURN tcp_world;
ENDPROC
```

### ì¢Œí‘œ ë³€í™˜ ë¡œì§

#### Step 1: Robot2 ë¡œì»¬ â†’ Floor ì¢Œí‘œê³„

```
Robot2 wobj0 = Robot2 Base (Floor ì¢Œí‘œê³„ ê¸°ì¤€)

Robot2 Base in Floor = Rì¶• ì¤‘ì‹¬ + Gantry offset - 488mm Y

Floor ì¢Œí‘œ:
  Floor_X = tcp_local.X (Robot2 wobj0 X)
  Floor_Y = tcp_local.Y - 488mm (Robot2 wobj0 Y - ëŒ€ì¹­ ì˜¤í”„ì…‹)
  Floor_Z = tcp_local.Z + Gantry_Z
```

**ì£¼ì˜**: Robot1ê³¼ Robot2ì˜ X, Yì¶•ì´ **ë°˜ëŒ€ ë¶€í˜¸**ì´ë¯€ë¡œ ë³€í™˜ í•„ìš”!

#### Step 2: Floor â†’ Gantry ì´ë™ ì ìš©

```
Gantry ì´ë™ ì ìš©:
  Gantry_Floor_X = Gantry_Y (90ë„ íšŒì „)
  Gantry_Floor_Y = Gantry_X (90ë„ íšŒì „)
  Gantry_Floor_Z = Gantry_Z (ì§ì ‘ ë§¤í•‘)
```

#### Step 3: Gantry â†’ World

```
World_X = Gantry_Floor_X = Gantry_Y
World_Y = Gantry_Floor_Y = Gantry_X
World_Z = Gantry_Floor_Z = Gantry_Z
```

### ì¢Œí‘œ ë³€í™˜ ìˆ˜ì‹ (ê°„ëµí™”)

```rapid
FUNC robtarget TransformRobot2ToWorld(robtarget robot2_local, num gx, num gy, num gz, num gr)
    VAR robtarget world_tcp;

    ! Robot2 wobj0 = Robot2 Base
    ! Robot2 Base = Rì¶• ì¤‘ì‹¬ - 488mm (Floor Y ë°©í–¥)
    ! Robot1ê³¼ Robot2ëŠ” Yì¶• ê¸°ì¤€ ë¯¸ëŸ¬ ëŒ€ì¹­

    ! 1. Robot2 ë¡œì»¬ ì¢Œí‘œ (wobj0 ê¸°ì¤€)
    VAR num r2_local_x := robot2_local.trans.x;
    VAR num r2_local_y := robot2_local.trans.y;
    VAR num r2_local_z := robot2_local.trans.z;

    ! 2. Floor ì¢Œí‘œë¡œ ë³€í™˜
    !    Robot2 wobj0 X, Yì¶•ì€ Robot1 wobj0ì™€ ë°˜ëŒ€ ë¶€í˜¸
    !    Rì¶• ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
    VAR num floor_x := -r2_local_x;  ! Xì¶• ë¯¸ëŸ¬ ëŒ€ì¹­
    VAR num floor_y := -r2_local_y - 488;  ! Yì¶• ë¯¸ëŸ¬ ëŒ€ì¹­ + Rì¶• ì˜¤í”„ì…‹
    VAR num floor_z := r2_local_z;  ! Zì¶• ë™ì¼

    ! 3. Gantry ì´ë™ ì ìš© (Rì¶• ì¤‘ì‹¬ ê¸°ì¤€)
    !    Gantry X â†’ Floor Y
    !    Gantry Y â†’ Floor X
    floor_x := floor_x + gy * 1000;  ! Gantry Y â†’ Floor X (meters â†’ mm)
    floor_y := floor_y + gx * 1000;  ! Gantry X â†’ Floor Y (meters â†’ mm)
    floor_z := floor_z + gz * 1000;  ! Gantry Z â†’ Floor Z (meters â†’ mm)

    ! 4. Floor â†’ World (90ë„ íšŒì „)
    !    World X = Floor Y
    !    World Y = Floor X
    !    World Z = Floor Z
    world_tcp.trans.x := floor_y;  ! Floor Y â†’ World X
    world_tcp.trans.y := floor_x;  ! Floor X â†’ World Y
    world_tcp.trans.z := floor_z;  ! Floor Z â†’ World Z

    ! 5. Rì¶• íšŒì „ ì ìš© (ì¶”ê°€ êµ¬í˜„ í•„ìš”)
    !    gr ê°ë„ë§Œí¼ íšŒì „ ë³€í™˜

    ! 6. ì˜¤ë¦¬ì—”í…Œì´ì…˜ (ì¿¼í„°ë‹ˆì–¸ ë³€í™˜)
    world_tcp.rot := robot2_local.rot;  ! ì¼ë‹¨ ë‹¨ìˆœí™”

    RETURN world_tcp;
ENDFUNC
```

**ì£¼ì˜**: ìœ„ ìˆ˜ì‹ì€ **ê°„ëµí™”ëœ ë²„ì „**ì…ë‹ˆë‹¤. ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ê²€ì¦ ë° ë³´ì • í•„ìš”!

---

## âš ï¸ ë¶ˆí™•ì‹¤ì„± ë° í™•ì¸ í•„ìš” ì‚¬í•­

### 1. MOC.cfg Robot2 Base Frame ìœ„ì¹˜

```cfg
-base_frame_pos_x 0.488
-base_frame_pos_y -0.374568  â† ì´ ê°’ì´ -488mmê°€ ì•„ë‹Œ ì´ìœ ?
-base_frame_pos_z 1.4
```

**ì§ˆë¬¸**:
- ì´ ê°’ì€ ì–´ë–¤ ì¢Œí‘œê³„ ê¸°ì¤€ì¸ê°€ìš”?
- -0.374568m â‰  -0.488m ì°¨ì´ ì„¤ëª… í•„ìš”

**ê°€ì„¤**:
- World ì¢Œí‘œê³„ ê¸°ì¤€?
- ê° íŠ¸ë¦¬ í™ˆ ìœ„ì¹˜ì—ì„œì˜ ì˜¤í”„ì…‹?

### 2. Gantry ì¢Œí‘œê³„ â†’ Floor ì¢Œí‘œê³„ ë§¤í•‘

**í˜„ì¬ ê°€ì •** (v3.1.1 í…ŒìŠ¤íŠ¸ ê¸°ì¤€):
- Gantry X â†’ World Y
- Gantry Y â†’ World X
- Gantry Z â†’ World Z

**í™•ì¸ í•„ìš”**:
- Floor ì¢Œí‘œê³„ ì •ì˜ê°€ Worldì™€ ë™ì¼í•œê°€?
- ì•„ë‹ˆë©´ FloorëŠ” ë³„ë„ ì¢Œí‘œê³„ì¸ê°€?

### 3. Robot2 wobj0 ì •í™•í•œ ì •ì˜

**ì‚¬ìš©ì ì •ë³´**:
- Robot2 wobj0 = Robot2 Base

**í™•ì¸ í•„ìš”**:
- EIO.cfgì—ì„œ Robot2 wobj0 ì‹¤ì œ ì •ì˜ í™•ì¸
- WobjFloorì™€ì˜ ê´€ê³„ í™•ì¸

---

## ğŸ§ª ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ë‹¨ê³„

### Test 1: Robot2 ì™¸ë¶€ì¶• ì½ê¸° ê°€ëŠ¥ ì—¬ë¶€ (ìµœìš°ì„ )

**íŒŒì¼**: `test_robot2_capabilities.mod` â†’ TASK2

```rapid
TestRobot2_ReadExternalAxes()
â†’ ê²°ê³¼: /HOME/robot2_external_axes_test.txt
```

**ì˜ˆìƒ ì‹œë‚˜ë¦¬ì˜¤**:
- **A**: ê° íŠ¸ë¦¬ ì™¸ë¶€ì¶• í¬í•¨ â†’ ìµœì„ 
- **B**: ì™¸ë¶€ì¶• = 9E9 (undefined) â†’ TASK1 ê³µìœ  í•„ìš”

### Test 2: PERS ë³€ìˆ˜ ê³µìœ  (TASK1 â†” TASK2)

**TASK1**: `task1_shared_variables.mod` ë¡œë“œ
- `UpdateSharedGantryPosition()` ì‹¤í–‰

**TASK2**: shared_gantry_x ì½ê¸° ì‹œë„

### Test 3: ì¢Œí‘œ ë³€í™˜ ê²€ì¦

**ê° íŠ¸ë¦¬ ì´ë™ í…ŒìŠ¤íŠ¸**:
1. Gantry X=0, Y=0, Z=0, R=0
2. Gantry X=0.1m, Y=0, Z=0, R=0
3. Gantry X=0, Y=0.1m, Z=0, R=0
4. Gantry X=0, Y=0, Z=0.1m, R=0

**ê° ìœ„ì¹˜ì—ì„œ ê¸°ë¡**:
- Robot1 World ì¢Œí‘œ
- Robot2 ë¡œì»¬ ì¢Œí‘œ (wobj0 ê¸°ì¤€)
- Robot2 ê³„ì‚°ëœ World ì¢Œí‘œ
- **ë¹„êµ ë¶„ì„**

---

## ğŸ“‹ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### 1ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì¦‰ì‹œ)
- [ ] TASK2ì— `test_robot2_capabilities.mod` ë¡œë“œ
- [ ] `TestRobot2_ReadExternalAxes()` ì‹¤í–‰
- [ ] ê²°ê³¼ íŒŒì¼ í™•ì¸ ë° ê³µìœ 

### 2ë‹¨ê³„: PERS ë³€ìˆ˜ ê³µìœ  í™•ì¸
- [ ] TASK1ì— `task1_shared_variables.mod` ë¡œë“œ
- [ ] TASK2ì—ì„œ ê³µìœ  ë³€ìˆ˜ ì½ê¸° í…ŒìŠ¤íŠ¸

### 3ë‹¨ê³„: ì¢Œí‘œ ë³€í™˜ êµ¬í˜„
- [ ] í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ë”°ë¼ ë³€í™˜ ë¡œì§ êµ¬í˜„
- [ ] ê²€ì¦ í…ŒìŠ¤íŠ¸ (ì—¬ëŸ¬ ê° íŠ¸ë¦¬ ìœ„ì¹˜)
- [ ] ì˜¤ì°¨ ë¶„ì„ ë° ë³´ì •

### 4ë‹¨ê³„: í˜‘ì—… ìš©ì ‘ êµ¬í˜„
- [ ] ë™ì  work object ë°©ì‹ êµ¬í˜„
- [ ] í˜‘ì—… ìš©ì ‘ í”„ë¡œì‹œì € ê°œë°œ

---

## ğŸ“ ì²¨ë¶€ íŒŒì¼

1. MOC.cfg (Line 100-109: ROB_2 ì„¤ì •)
2. test_robot2_capabilities.mod (í…ŒìŠ¤íŠ¸ ì½”ë“œ)
3. task1_shared_variables.mod (ê³µìœ  ë³€ìˆ˜)

---

**ì‘ì„±ì**: Claude Code
**ë²„ì „**: v2.0 (MOC.cfg ë¶„ì„ í¬í•¨)
**ë‹¤ìŒ ì•¡ì…˜**: Test 1 ì‹¤í–‰ ë° ê²°ê³¼ ë¶„ì„
