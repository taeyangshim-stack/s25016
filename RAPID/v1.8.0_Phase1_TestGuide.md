# v1.8.0 Phase 1 - R-axis Rotation Test Guide

## üéØ Overview

Phase 1 implements config-based R-axis rotation testing for the SpGantry dual-robot system.

**Version**: v1.8.0
**Date**: 2026-01-03
**Status**: Ready for Testing

---

## üìã What's New in Phase 1

### 1. TEST_MODE System
- **TEST_MODE=0**: Single position test (backward compatible with v1.7.51)
- **TEST_MODE=1**: R-axis rotation test (**NEW** in Phase 1)
- **TEST_MODE=2**: Complex motion (placeholder for Phase 2)
- **TEST_MODE=3**: Custom multi-position (placeholder for Phase 3)

### 2. Config-based R-axis Testing
- Dynamic angle configuration via config.txt
- Support for up to 10 R angles per test
- Default angles: -90¬∞, -45¬∞, 0¬∞, 45¬∞, 90¬∞
- R-axis range: ¬±100¬∞ (MOC.cfg limit)

### 3. Enhanced Logging
- Test mode identification in logs
- R angle configuration display
- Robot1/Robot2 Floor TCP coordinates at each angle

---

## üöÄ Quick Start

### Prerequisites
1. Robot1 and Robot2 at HOME position
2. RobotStudio Virtual Controller running
3. TASK1 and TASK2 loaded with v1.8.0 code

### Step 1: Configure Test

**Location**: `HOME/config.txt`

```ini
# Set TEST_MODE to 1 for R-axis rotation test
TEST_MODE=1

# Configure number of R angles to test
NUM_R_ANGLES=5

# Define R angles (degrees)
R_ANGLE_1=-90
R_ANGLE_2=-45
R_ANGLE_3=0
R_ANGLE_4=45
R_ANGLE_5=90
```

### Step 2: Copy config.txt

```powershell
# PowerShell
Copy-Item "HOME_config.txt" `
  "C:\Users\user\Documents\RobotStudio\Projects\SP_Gatry20251127\Virtual Controllers\SpGantry_1200_526406\HOME\config.txt"
```

Or manually copy:
```
Source: s25016/RAPID/SpGantry_1200_526406_BACKUP_2025-12-18/HOME_config.txt
Target: Virtual Controllers/SpGantry_1200_526406/HOME/config.txt
```

### Step 3: Load RAPID Modules

**TASK1**:
```
Load: RAPID/SpGantry_1200_526406_BACKUP_2025-12-18/RAPID/TASK1/PROGMOD/MainModule.mod
```

**TASK2**:
```
Load: RAPID/SpGantry_1200_526406_BACKUP_2025-12-18/RAPID/TASK2/PROGMOD/Rob2_MainModule.mod
```

### Step 4: Run Test

```rapid
! In RobotStudio FlexPendant
! TASK1 -> PP to Main -> Start
```

**Program flow:**
1. Read TEST_MODE from config.txt
2. Initialize Robot1 (SetRobot1InitialPosition)
3. Wait for Robot2 initialization (flag-based sync)
4. Execute TestGantryRotation() (TEST_MODE=1)
5. Return to HOME

### Step 5: Check Results

**Log files** (in HOME directory):
- `main_process.txt` - Main execution log
- `gantry_rotation_test.txt` - R-axis test results ‚≠ê
- `robot1_init_position.txt` - Robot1 initialization
- `robot2_init_position.txt` - Robot2 initialization

---

## üìä Expected Results

### Console Output

```
TEST_MODE=1
========================================
MAIN: Starting Test (MODE=1)...
========================================
MAIN: R-axis Rotation Test
Reading config.txt for R angles...
NUM_R_ANGLES=5
R_ANGLE_1=-90.0
R_ANGLE_2=-45.0
R_ANGLE_3=0.0
R_ANGLE_4=45.0
R_ANGLE_5=90.0
========================================
Starting Multiple R-axis Rotation Test
========================================
----------------------------------------
Test 1/5: R = -90.0 degrees
----------------------------------------
Robot1 Floor: [9500.0, 5300.0, 1100.0]
Robot2 Floor: [9500.0, 5300.0, 1100.0]
...
========================================
R-axis Rotation Test Complete!
Results saved to gantry_rotation_test.txt
========================================
```

### gantry_rotation_test.txt

```
========================================
Gantry R-axis Rotation Test (v1.8.0)
========================================
Date: 2026-01-03
Time: HH:MM:SS

Test Configuration:
  Gantry Position (Physical): [0, 0, 0]
  Gantry Position (Floor): [-9500, 5300, 2100]
  Number of R angles: 5
  R angles (degrees):
    R_ANGLE_1 = -90.0
    R_ANGLE_2 = -45.0
    R_ANGLE_3 = 0.0
    R_ANGLE_4 = 45.0
    R_ANGLE_5 = 90.0

Floor Coordinate System:
  X+ = right (material flow direction)
  Y+ = up
  Z+ = vertical up
  R=0: Gantry parallel to Y-axis (perpendicular to X-axis)
  Robot1 at Y+, Robot2 at Y-

Test 1: R = -90.0 deg
--------------------
Gantry (Physical): [0, 0, 0, -90.0]
Gantry (Floor): [-9500, 5300, 2100, -90.0]

Robot1 Floor TCP:
  X = 9500.00 mm
  Y = 5300.00 mm
  Z = 1100.00 mm

Robot2 Floor TCP:
  X = 9500.00 mm
  Y = 5300.00 mm
  Z = 1100.00 mm

...
```

---

## ‚úÖ Validation Checklist

### Pre-Test
- [ ] Virtual Controller running
- [ ] config.txt copied to HOME directory
- [ ] TEST_MODE=1 in config.txt
- [ ] NUM_R_ANGLES and R_ANGLE_1~5 configured
- [ ] Robot1/Robot2 at HOME position

### During Test
- [ ] TEST_MODE=1 displayed on console
- [ ] 5 R angles read correctly
- [ ] "Starting Multiple R-axis Rotation Test" message
- [ ] Test 1/5, 2/5, 3/5, 4/5, 5/5 progress displayed
- [ ] Robot1/Robot2 Floor coordinates displayed
- [ ] No errors (41617 should not occur)

### Post-Test
- [ ] "R-axis Rotation Test Complete!" message
- [ ] gantry_rotation_test.txt created
- [ ] main_process.txt shows TEST_MODE=1
- [ ] Robots returned to HOME position

### Results Validation
- [ ] Robot1/Robot2 Floor TCP coordinates logged for all R angles
- [ ] Coordinates are reasonable (within workspace)
- [ ] No NaN or extreme values
- [ ] Floor coordinate format correct

---

## üîç Troubleshooting

### Issue: TEST_MODE not found
**Symptom**: Default TEST_MODE=0, single position test runs
**Cause**: config.txt not copied or TEST_MODE line missing
**Solution**:
1. Check config.txt exists in HOME directory
2. Verify TEST_MODE=1 line is present
3. Reload program and retry

### Issue: R angles not read correctly
**Symptom**: "NUM_R_ANGLES=0" or angles show as 0.0
**Cause**: Config parsing error or missing parameters
**Solution**:
1. Check NUM_R_ANGLES is set (e.g., NUM_R_ANGLES=5)
2. Verify R_ANGLE_1~5 lines exist
3. Ensure no extra spaces in config.txt

### Issue: Error 41617 (Write frequency)
**Symptom**: "Too intense frequency of Write Instructions"
**Cause**: Rapid consecutive Write operations
**Solution**: Already mitigated with `WaitTime 0.05` in code
- If still occurs, ignore (program continues)

### Issue: Robots not at HOME
**Symptom**: "WARNING: Gantry not at HOME!" or "WARNING: Robot1 NOT at initial position!"
**Cause**: Robots not initialized before test
**Solution**:
1. Run SetRobot1InitialPosition (TASK1)
2. Run SetRobot2InitialPosition (TASK2)
3. Retry test

### Issue: TEST_MODE=2 or 3 error
**Symptom**: "ERROR: TEST_MODE=2 not implemented"
**Cause**: Phase 2/3 not implemented yet
**Solution**: Use TEST_MODE=0 or 1 only

---

## üìê Test Customization

### Example 1: 3 Angles Only
```ini
TEST_MODE=1
NUM_R_ANGLES=3
R_ANGLE_1=-45
R_ANGLE_2=0
R_ANGLE_3=45
```

### Example 2: Fine Resolution (15¬∞ steps)
```ini
TEST_MODE=1
NUM_R_ANGLES=7
R_ANGLE_1=-90
R_ANGLE_2=-60
R_ANGLE_3=-30
R_ANGLE_4=0
R_ANGLE_5=30
R_ANGLE_6=60
R_ANGLE_7=90
```

### Example 3: Asymmetric Test
```ini
TEST_MODE=1
NUM_R_ANGLES=6
R_ANGLE_1=-90
R_ANGLE_2=-75
R_ANGLE_3=-60
R_ANGLE_4=60
R_ANGLE_5=75
R_ANGLE_6=90
```

---

## üéØ Validation Criteria

### Success Criteria
1. ‚úÖ All R angles tested without errors
2. ‚úÖ Robot1/Robot2 Floor coordinates logged
3. ‚úÖ Coordinates within expected range (¬±10000mm)
4. ‚úÖ No runtime errors or STOP
5. ‚úÖ Robots return to HOME position

### Key Metrics
- **Coordinate accuracy**: Sub-millimeter expected (based on v1.7.51)
- **Robot1-Robot2 distance**: Should remain constant (~976mm) regardless of R angle
- **Execution time**: ~2-5 seconds per R angle
- **Total time**: <1 minute for 5 angles

---

## üöÄ Next Steps: Phase 2

**Phase 2 will add:**
- TEST_MODE=2: Complex motion (translation + rotation combined)
- Enhanced logging: WobjGantry quaternion details
- R-axis calculation verification

**To enable Phase 2:**
1. Set TEST_MODE=2 in config.txt
2. Configure COMPLEX_POS_1~3 parameters
3. Run main() procedure

---

## üìû Support

**Issues**: Report to s25016 project team
**Documentation**: See v1.7.51_handoff.html
**CHANGELOG**: See CHANGELOG.md v1.8.0

---

**Generated**: 2026-01-03
**Version**: v1.8.0 Phase 1
**Status**: ‚úÖ Ready for Testing
