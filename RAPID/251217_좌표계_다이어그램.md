================================================================
  갠트리 듀얼 로봇 시스템 좌표계 다이어그램
================================================================

┌─────────────────────────────────────────────────────────────┐
│  1. 평면도 (위에서 본 모습) - Floor 좌표계 기준               │
└─────────────────────────────────────────────────────────────┘

                    ↑ Floor +Y
                    │
        ┌───────────┼───────────┐
        │  Robot1   │  Robot2   │
        │   Base    │   Base    │
        │     ●     │     ●     │
        │     │     │     │     │
        ├─────┼─────┼─────┼─────┤
        │  488mm    │  488mm    │
        │     │     │     │     │
        │     │   ● R-axis center (갠트리 회전 중심)
        │     │     │     │     │
        │     │     │     │     │
        │  Robot1   │  Robot2   │
        │  wobj0    │  wobj0    │
        │   (※)    │   (Robot2 Base와 동일)
        │           │           │
    ────┼───────────┼───────────┼──── Floor +X
        │           │           │

※ Robot1 wobj0 = R-axis center (Robot1 Base - 488mm)

Robot1과 Robot2의 좌표계 방향:
  Robot1 wobj0 X: →    Robot2 wobj0 X: ← (반대 부호)
  Robot1 wobj0 Y: ↑    Robot2 wobj0 Y: ↓ (반대 부호)
  Robot1 wobj0 Z: ⊙    Robot2 wobj0 Z: ⊙ (같은 방향)

미러 대칭: Floor Y축 기준


┌─────────────────────────────────────────────────────────────┐
│  2. Gantry 좌표계 vs Floor 좌표계 (90도 회전 관계)           │
└─────────────────────────────────────────────────────────────┘

Floor 좌표계:
        ↑ Floor +Y
        │
        │
        │
    ────┼──────→ Floor +X
        │
        ⊙ Floor +Z (화면 밖으로)

Gantry 좌표계 (Floor 대비 Z축 기준 90도 회전):
        ↑ Gantry +X
        │
        │
        │
    ────┼──────→ Gantry +Y
        │
        ⊙ Gantry +Z (Floor +Z와 동일)

관계:
  Gantry X → Floor Y
  Gantry Y → Floor X
  Gantry Z → Floor Z


┌─────────────────────────────────────────────────────────────┐
│  3. World 좌표계 vs Gantry 좌표계 (v3.1.1 테스트 결과)      │
└─────────────────────────────────────────────────────────────┘

v3.1.1 테스트 결과:
  - Gantry X축 0→0.2m 이동 → World Y 변화
  - Gantry Y축 0→0.2m 이동 → World X 변화
  - Gantry Z축 0→0.2m 이동 → World Z 변화

결론:
  World X = Gantry Y
  World Y = Gantry X
  World Z = Gantry Z

즉, World = Gantry (90도 회전)


┌─────────────────────────────────────────────────────────────┐
│  4. 통합 좌표계 변환 체인                                    │
└─────────────────────────────────────────────────────────────┘

Robot2 wobj0 → Floor → Gantry → World

Step 1: Robot2 wobj0 → Floor
  Robot2 wobj0 = Robot2 Base
  Robot2 Base = R-axis center - 488mm (Floor Y 방향)

  Floor X = -Robot2 wobj0 X  (미러 대칭)
  Floor Y = -Robot2 wobj0 Y - 488mm  (미러 대칭 + 오프셋)
  Floor Z = Robot2 wobj0 Z

Step 2: Floor → Gantry (역변환)
  Gantry X = Floor Y
  Gantry Y = Floor X
  Gantry Z = Floor Z

Step 3: Gantry → World
  World X = Gantry Y
  World Y = Gantry X
  World Z = Gantry Z


┌─────────────────────────────────────────────────────────────┐
│  5. 갠트리 이동 시 좌표 변화 예시                            │
└─────────────────────────────────────────────────────────────┘

갠트리 홈 위치 (X=0, Y=0, Z=0, R=0):

  R-axis center (Floor): (0, 0, 0)
  Robot1 Base (Floor): (0, +488mm, 0)
  Robot2 Base (Floor): (0, -488mm, 0)
  Robot1 wobj0 (Floor): (0, 0, 0) = R-axis center
  Robot2 wobj0 (Floor): (0, -488mm, 0) = Robot2 Base

갠트리 X축 +100mm 이동:

  Gantry: (X=0.1m, Y=0, Z=0, R=0)

  R-axis center (Floor): (0, +100mm, 0)  ← Gantry X → Floor Y
  Robot1 Base (Floor): (0, +588mm, 0)
  Robot2 Base (Floor): (0, -388mm, 0)
  Robot1 wobj0 (Floor): (0, +100mm, 0)
  Robot2 wobj0 (Floor): (0, -388mm, 0)

  World 좌표:
  World X = Floor Y = +100mm
  World Y = Floor X = 0
  World Z = Floor Z = 0

갠트리 Y축 +100mm 이동:

  Gantry: (X=0, Y=0.1m, Z=0, R=0)

  R-axis center (Floor): (+100mm, 0, 0)  ← Gantry Y → Floor X
  Robot1 Base (Floor): (+100mm, +488mm, 0)
  Robot2 Base (Floor): (+100mm, -488mm, 0)

  World 좌표:
  World X = Floor Y = 0
  World Y = Floor X = +100mm
  World Z = Floor Z = 0


┌─────────────────────────────────────────────────────────────┐
│  6. Robot2 좌표 변환 로직 (최종 수식)                        │
└─────────────────────────────────────────────────────────────┘

입력:
  - robot2_local: Robot2 로컬 TCP (wobj0 기준)
  - gx, gy, gz, gr: 갠트리 위치 (meters)

출력:
  - world_tcp: Robot2 TCP의 World 좌표

변환 수식:

  // 1. Robot2 로컬 → Floor (미러 대칭 + 오프셋)
  floor_x = -robot2_local.X
  floor_y = -robot2_local.Y - 488mm
  floor_z = robot2_local.Z

  // 2. Gantry 이동 적용
  floor_x = floor_x + (gy * 1000mm)  // Gantry Y → Floor X
  floor_y = floor_y + (gx * 1000mm)  // Gantry X → Floor Y
  floor_z = floor_z + (gz * 1000mm)  // Gantry Z → Floor Z

  // 3. Floor → World (90도 회전)
  world_tcp.X = floor_y  // Floor Y → World X
  world_tcp.Y = floor_x  // Floor X → World Y
  world_tcp.Z = floor_z  // Floor Z → World Z

  // 4. R축 회전 적용 (추가 구현 필요)
  // gr 각도만큼 Z축 기준 회전 변환


┌─────────────────────────────────────────────────────────────┐
│  7. 검증 예시                                                │
└─────────────────────────────────────────────────────────────┘

시나리오: 갠트리 홈 위치에서 Robot2 TCP 위치 확인

조건:
  - Gantry: (X=0, Y=0, Z=0, R=0)
  - Robot2 joints: [0, -15, 0, 0, -75, 0]
  - Robot2 TCP (wobj0 기준): (310, 0, 1050) mm  ← 예상값

변환 계산:

  // 1. Robot2 로컬 → Floor
  floor_x = -310mm = -310mm
  floor_y = -0mm - 488mm = -488mm
  floor_z = 1050mm

  // 2. Gantry 이동 (홈 위치이므로 0)
  floor_x = -310mm + 0 = -310mm
  floor_y = -488mm + 0 = -488mm
  floor_z = 1050mm

  // 3. Floor → World
  world_x = floor_y = -488mm  ← ?
  world_y = floor_x = -310mm  ← ?
  world_z = floor_z = 1050mm

이 값을 Robot1 World 좌표와 비교하여 검증!

Robot1 World 좌표 (v3.1.1 테스트):
  World X = -179.193mm
  World Y = -0.003mm
  World Z = 1071.130mm

차이 분석 필요!


================================================================
  메모 및 확인 사항
================================================================

1. MOC.cfg Robot2 base_frame_pos_y = -0.374568m 의미?
   - 이게 -488mm가 아닌 이유?
   - World 좌표계 기준인가?

2. v3.1.1 테스트에서 Robot1 World 좌표:
   - X = -179.193mm (예상: 0 근처)
   - Y = -0.003mm (예상: 0 근처)
   - Z = 1071.130mm (예상: 1050mm + offset)

   이 오프셋의 의미?

3. Robot2 테스트 필수:
   - CJointT() 실행 시 외부축 포함 여부
   - 갠트리 홈 위치에서 Robot2 World 좌표
   - Robot1과 비교

================================================================
