# TCP 선택 기능 사용 가이드

**작성일**: 2025-12-05
**작업자**: SP 심태양
**버전**: v1.1_251205

---

## 🎯 개요

FloorMonitor_Task2 모듈에 **TCP 선택 기능**이 추가되었습니다.

### 핵심 기능

1. **테스트 모드**: 간소화된 정수 TCP 값 [300, 0, 300] 사용
2. **운영 모드**: 실제 TCP 값 [319.99, 0, 331.83] 사용
3. **파라미터로 선택**: 프로시저 호출 시 결정

---

## 📋 TCP 값 비교

| 항목 | 운영 모드 (기본) | 테스트 모드 | 비고 |
|------|------------------|-------------|------|
| TCP X | 319.99 mm | 300 mm | ⭐ 계산 용이 |
| TCP Y | 0 mm | 0 mm | 동일 |
| TCP Z | 331.83 mm | 300 mm | ⭐ 계산 용이 |
| 도구 | tWeld1/tWeld2 | tWeldTest1/tWeldTest2 | 별도 정의 |

**테스트 모드 장점**:
- ✅ 정수 값으로 암산 가능
- ✅ 결과 검증 간편
- ✅ 오차 파악 용이

---

## 🚀 사용 방법

### 방법 1: 운영 모드 (기본)

**프로시저 호출**:
```rapid
% MonitorFloorAtHome_Task2
```

**사용 TCP**:
- Robot2: tWeld2 [319.99, 0, 331.83] mm

**출력**:
```
TCP Mode: PRODUCTION MODE
  TCP Offset: [319.99, 0, 331.83] mm
```

### 방법 2: 테스트 모드

**프로시저 호출**:
```rapid
% MonitorFloorAtHome_Task2 \UseTestTCP
```

**사용 TCP**:
- Robot2: tWeldTest2 [300, 0, 300] mm

**출력**:
```
TCP Mode: TEST MODE
  TCP Offset: [300.00, 0, 300.00] mm
```

---

## 📊 출력 파일 차이

### 운영 모드 출력

```
========================================
Floor Coordinates at Home Position (TASK2)
========================================

Program Version: v1.1_251205
Module: FloorMonitor_Task2
Procedure: MonitorFloorAtHome_Task2

TCP Mode: PRODUCTION MODE
  TCP Offset: [319.99, 0, 331.83] mm

Date: 2025-12-05
Time: 18:30:45

...

Tool Definitions (Current Mode: PRODUCTION MODE):
  tWeld1 (Robot1):
    tframe.trans: [319.99, 0, 331.83] mm
    tframe.rot: [1, 0, 0, 0] (quaternion)
    Note: Production values

  tWeld2 (Robot2):
    tframe.trans: [319.99, 0, 331.83] mm
    tframe.rot: [1, 0, 0, 0] (quaternion)
    Note: Production values

...

Robot2 tWeld2 (WobjFloor) - PRODUCTION MODE:
  X = 10270.990 mm
  Y = 5300.000 mm
  Z = 797.070 mm
  TCP offset: [319.99, 0, 331.83] mm
```

### 테스트 모드 출력

```
========================================
Floor Coordinates at Home Position (TASK2)
========================================

Program Version: v1.1_251205
Module: FloorMonitor_Task2
Procedure: MonitorFloorAtHome_Task2

TCP Mode: TEST MODE
  TCP Offset: [300.00, 0, 300.00] mm

Date: 2025-12-05
Time: 18:45:20

...

Tool Definitions (Current Mode: TEST MODE):
  tWeldTest1 (Robot1):
    tframe.trans: [300, 0, 300] mm
    tframe.rot: [1, 0, 0, 0] (quaternion)
    Note: Simplified for testing

  tWeldTest2 (Robot2):
    tframe.trans: [300, 0, 300] mm
    tframe.rot: [1, 0, 0, 0] (quaternion)
    Note: Simplified for testing

...

Robot2 tWeldTest2 (WobjFloor) - TEST MODE:
  X = 10251.000 mm  (예상: 9951 + 300 = 10251)
  Y = 5300.000 mm
  Z = ??? mm  (WobjFloor Z축 방향에 따라)
  TCP offset: [300.00, 0, 300.00] mm
```

---

## 🔍 검증 예시

### 테스트 모드로 검증하기

**목적**: TCP 오프셋이 정확하게 적용되는지 확인

**절차**:

1. **테스트 모드로 실행**:
   ```rapid
   % MonitorFloorAtHome_Task2 \UseTestTCP
   ```

2. **Robot2 tool0 확인**:
   ```
   Robot2 tool0 (WobjFloor):
     X = 9951.000 mm
     Y = 5300.000 mm
     Z = 1128.900 mm
   ```

3. **Robot2 tWeldTest2 확인**:
   ```
   Robot2 tWeldTest2 (WobjFloor) - TEST MODE:
     X = 10251.000 mm  (예상)
     Y = 5300.000 mm
     Z = ??? mm
     TCP offset: [300.00, 0, 300.00] mm
   ```

4. **수동 계산 검증**:
   ```
   dX = 10251.000 - 9951.000 = 300.000 mm ✅
   예상 TCP X = 300 mm ✅
   ```

**간편한 계산**:
- 소수점 없이 정수만 다룸
- 암산으로 즉시 확인 가능

---

## 🛠️ 필요한 파일

### 1. TCPConfig_Task2.mod (새로 생성됨)

**위치**: `RAPID/TASK2/PROGMOD/TCPConfig_Task2.mod`

**내용**:
```rapid
MODULE TCPConfig_Task2
    ! Test TCP definitions
    PERS tooldata tWeldTest1 := [TRUE,[[300,0,300],[1,0,0,0]],[1,[0,0,1],[1,0,0,0],0,0,0]];
    PERS tooldata tWeldTest2 := [TRUE,[[300,0,300],[1,0,0,0]],[1,[0,0,1],[1,0,0,0],0,0,0]];
ENDMODULE
```

**로드 방법**:
1. RobotStudio에서 TASK2 열기
2. Controller > RAPID > T_ROB2 > Program Modules
3. Load Module... > TCPConfig_Task2.mod 선택

### 2. FloorMonitor_Task2.mod (수정됨)

**버전**: v1.1_251205

**주요 변경**:
- 프로시저 시그니처: `PROC MonitorFloorAtHome_Task2(\switch UseTestTCP)`
- TCP 모드 선택 로직 추가
- 출력 파일에 TCP 모드 정보 표시

---

## 📝 RobotStudio에서 실행하기

### 준비 단계

1. **TCPConfig_Task2.mod 로드**:
   - TASK2 > Program Modules > Load Module...
   - `TCPConfig_Task2.mod` 선택

2. **Program Check**:
   - RAPID > Program Check
   - 오류 없음 확인

### 실행 단계

**운영 모드**:
```
1. TASK2 선택
2. PP to Main 클릭
3. 프로시저 실행:
   MonitorFloorAtHome_Task2

4. 결과 확인:
   HOME:/floor_coordinates_at_home_task2.txt
```

**테스트 모드**:
```
1. TASK2 선택
2. PP to Main 클릭
3. 프로시저 실행:
   MonitorFloorAtHome_Task2 \UseTestTCP

4. 결과 확인:
   HOME:/floor_coordinates_at_home_task2.txt
```

---

## 🎯 사용 시나리오

### 시나리오 1: 초기 검증

**상황**: 새로운 WobjFloor 좌표계 적용 후 검증

**방법**:
1. 테스트 모드로 실행
2. 정수 값으로 빠르게 오프셋 확인
3. 문제 없으면 운영 모드로 전환

### 시나리오 2: 정기 점검

**상황**: 로봇 정밀도 정기 점검

**방법**:
1. 운영 모드로 실행
2. 실제 TCP 값으로 측정
3. 이전 결과와 비교

### 시나리오 3: 트러블슈팅

**상황**: 측정값이 예상과 다를 때

**방법**:
1. 테스트 모드로 실행
2. 간단한 값으로 원인 파악
3. 설정 문제인지 측정 문제인지 구분

---

## ⚠️ 주의사항

### 1. Tool 정의 필요

**테스트 모드 사용 전에**:
- TCPConfig_Task2.mod 반드시 로드
- tWeldTest1, tWeldTest2 정의 확인

**오류 발생 시**:
```
Reference error: Reference to unknown entire data tWeldTest2
→ TCPConfig_Task2.mod가 로드되지 않음
```

### 2. 모드 확인

**출력 파일 확인**:
```
TCP Mode: TEST MODE
  TCP Offset: [300.00, 0, 300.00] mm
```

**잘못된 모드 사용 시**:
- 테스트 값으로 운영하면 정밀도 저하
- 운영 값으로 테스트하면 검증 복잡

### 3. Robot1 제한사항

**현재**:
- Robot1은 active tool만 읽음
- TASK2에서 tWeld1 직접 지정 불가

**향후 개선**:
- TASK1에서도 동일한 선택 기능 추가 가능

---

## 📚 추가 문서

- `TCP_검증_및_개선_제안_251205.md`: 문제 분석 및 개선 방안
- `설정정보_출력_추가_251205.md`: 설정 정보 출력 기능
- `최종_테스트_결과_분석_251205.md`: 이전 테스트 결과

---

## ✨ 요약

| 항목 | 내용 |
|------|------|
| 추가 파일 | TCPConfig_Task2.mod |
| 수정 파일 | FloorMonitor_Task2.mod (v1.1) |
| 선택 방법 | `\UseTestTCP` 파라미터 |
| 기본 모드 | 운영 모드 (실제 TCP) |
| 테스트 TCP | [300, 0, 300] mm |
| 운영 TCP | [319.99, 0, 331.83] mm |

**사용 예**:
- 운영: `MonitorFloorAtHome_Task2`
- 테스트: `MonitorFloorAtHome_Task2 \UseTestTCP`

---

**작성 완료**: 2025-12-05
**상태**: ✅ TCP 선택 기능 완료
**다음**: RobotStudio에서 테스트 실행
