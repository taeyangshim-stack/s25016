# MOC.cfg 설정 비교 분석 리포트

## 백업 버전 비교
- **구 버전**: 2025-11-21 백업 (문제 있는 설정)
- **신 버전**: 2025-12-18 백업 (수정된 설정)

---

## 📊 주요 변경 사항 요약

### 1. EXTCTL 유닛 완전 제거 ✅
**구 버전**: EXTCTL1, EXTCTL2, EXTCTL3 존재 (외부 제어 유닛)
**신 버전**: 모두 제거됨

**영향**: 불필요한 외부 제어 축 제거, 시스템 단순화

---

### 2. GantryRob 좌표계 방향 변경 🔄

#### 구 버전 (2025-11-21):
```
-base_frame_orient_u0 0.5
-base_frame_orient_u1 0.5
-base_frame_orient_u2 -0.5
-base_frame_orient_u3 0.5
```
**쿼터니언**: (x=0.5, y=0.5, z=-0.5, w=0.5)

#### 신 버전 (2025-12-18):
```
-base_frame_orient_u0 0
-base_frame_orient_u1 0.707107
-base_frame_orient_u3 0.707107
```
**쿼터니언**: (x=0, y=0.707107, z=0, w=0.707107)

**의미**:
- 신 버전: **90° Y축 회전** (더 직관적)
- Floor 좌표계와의 관계가 더 명확해짐

**좌표계 변환**:
```
신 버전 (90° Y축 회전):
  Gantry X → World Z
  Gantry Y → World Y
  Gantry Z → World -X
```

---

### 3. ROB_1 (Robot1) 베이스 프레임 정리 ✨

#### 구 버전:
```
-base_frame_orient_u1 -1.74574E-15
-base_frame_orient_u2 1.74574E-15
-base_frame_orient_u3 3.05684E-30
-base_frame_coordinated "GantryRob"
```

#### 신 버전:
```
-base_frame_orient_u3 3.05684E-30
-base_frame_coordinated "GantryRob"
```

**변경사항**: 거의 0에 가까운 불필요한 파라미터 제거
**결과**: ROB_1은 여전히 GantryRob에 좌표 연동됨 ✅

---

### 4. ROB_2 (Robot2) 베이스 프레임 대수술 🔧

#### 구 버전 (2025-11-21) - 문제 있는 설정:
```
-base_frame_pos_x 0.488
-base_frame_pos_y -0.374568
-base_frame_pos_z 1.4
-base_frame_orient_u0 0
-base_frame_orient_u2 1
```

**문제점**:
- World 좌표계에서 이해할 수 없는 위치
- X = 0.488m
- Y = -0.374568m (왜 이런 값?)
- Z = 1.4m (의미 불명)
- 180° Y축 회전 (u0=0, u2=1)

#### 신 버전 (2025-12-18) - 수정된 설정:
```
-base_frame_orient_u0 -4.32964E-17
-base_frame_orient_u1 0.707107
-base_frame_orient_u2 0.707107
-base_frame_orient_u3 4.32964E-17
```

**수정사항**:
1. **위치 파라미터 완전 제거**: 이제 (0, 0, 0)이 기본값
2. **방향만 정의**: 새로운 쿼터니언 방향

**새 쿼터니언 분석**:
- (x≈0, y=0.707107, z=0.707107, w≈0)
- **의미**: Y-Z 평면에서 복합 회전
- GantryRob 좌표계 변경에 맞춰 조정됨

---

## 🔍 왜 구 버전 값이 "이해할 수 없었나"?

### 구 버전 ROB_2 위치 분석 (World 좌표계):
```
X = 0.488m
Y = -0.374568m
Z = 1.4m
```

**문제**:
1. **X = 0.488m**: 이것은 사용자가 언급한 Floor Y = 488mm와 같은 값이지만,
   - 구 버전에서는 GantryRob가 다른 방향으로 회전되어 있어서
   - World X ≠ Floor Y 관계가 꼬여있었음

2. **Y = -0.374568m**: 의미 불명의 값
   - 아마도 잘못된 좌표 변환 결과

3. **Z = 1.4m**: 로봇 베이스 높이?
   - 하지만 이것도 좌표계 혼동으로 인한 잘못된 값

4. **180° 회전**: ROB_2가 ROB_1과 반대 방향을 보도록 설정
   - 하지만 GantryRob 좌표계와 맞지 않음

### 신 버전에서의 수정:
- **위치를 (0,0,0)으로 초기화**: 명확한 기준점
- **GantryRob 좌표계를 90° Y축 회전으로 재정의**: 더 직관적
- **ROB_2 방향을 새 좌표계에 맞게 조정**: 일관성 확보

---

## 📐 좌표계 변화 비교

### 구 버전 (2025-11-21) 좌표계:
```
GantryRob: 복잡한 3D 회전 (x=0.5, y=0.5, z=-0.5, w=0.5)
  ↓
ROB_1: GantryRob에 연동 ✅
  - 하지만 GantryRob 방향이 복잡함

ROB_2: World (0.488, -0.374568, 1.4) + 180° 회전 ❌
  - GantryRob와 연동 안됨
  - 이상한 위치값
```

### 신 버전 (2025-12-18) 좌표계:
```
GantryRob: 90° Y축 회전 (x=0, y=0.707107, z=0, w=0.707107)
  ↓
ROB_1: GantryRob에 연동 ✅
  - 명확한 90° Y축 회전

ROB_2: World (0, 0, 0) + 복합 회전
  - 위치는 원점 기준
  - GantryRob 좌표계에 정렬된 방향
```

---

## 🎯 실제 의미

### 문제 해결:
1. **좌표계 방향 통일**: GantryRob를 단순 90° Y축 회전으로 정의
2. **ROB_2 위치 정리**: 이상한 오프셋 제거, 원점 기준으로 변경
3. **불필요한 EXTCTL 제거**: 시스템 복잡도 감소

### 사용자 입장에서:
- **구 버전**: "World X = 0.488m, Y = -0.374568m, Z = 1.4m 이런 이해할 수 없는 값"
  - → 잘못된 좌표 변환과 복잡한 회전 때문

- **신 버전**: 명확한 90° Y축 회전, 원점 기준 정의
  - → 이해 가능하고 예측 가능한 좌표계

---

## 📋 다음 단계 권장사항

### 1. 신 버전 사용 ✅
```bash
작업 경로: /home/qwe/works/s25016/RAPID/SpGantry_1200_526406_BACKUP_2025-12-18
```

### 2. wobj0 확인 필요
신 버전에서 CheckWobj0 모듈 실행하여:
- TASK1 wobj0 정의 확인
- TASK2 wobj0 정의 확인
- World vs wobj0 좌표 차이 확인

### 3. 좌표계 테스트
신 버전 설정으로:
- TestRobot2_ReadExternalAxes 실행
- Robot2가 갠트리 외부축 읽을 수 있는지 확인
- TCP 좌표 World vs wobj0 비교

### 4. 협동 용접 좌표 변환 개발
새 좌표계 기준으로:
- Robot1 ↔ Robot2 좌표 변환 공식 재수립
- 488mm 오프셋 적용 방법 확인

---

## 🔧 기술적 상세 - 쿼터니언 변환

### GantryRob 쿼터니언 비교

#### 구 버전: (0.5, 0.5, -0.5, 0.5)
```
회전 행렬 변환:
[  0  0  1 ]     Gantry X → World Z
[  1  0  0 ]     Gantry Y → World X
[  0  1  0 ]     Gantry Z → World Y
```

#### 신 버전: (0, 0.707107, 0, 0.707107)
```
90° Y축 회전:
[  0  0 -1 ]     Gantry X → World -Z
[  0  1  0 ]     Gantry Y → World Y
[  1  0  0 ]     Gantry Z → World X
```

### ROB_2 쿼터니언 비교

#### 구 버전: (0, 0, 1, 0)
```
180° Y축 회전:
[ -1  0  0 ]     로봇이 뒤를 봄
[  0  1  0 ]
[  0  0 -1 ]
```

#### 신 버전: (≈0, 0.707107, 0.707107, ≈0)
```
복합 회전:
새 GantryRob 좌표계에 정렬된 방향
(정확한 회전 행렬은 GantryRob 회전과 조합하여 계산 필요)
```

---

## ✅ 결론

**구 버전 (2025-11-21) 문제점**:
1. ROB_2가 이상한 위치 (0.488, -0.374568, 1.4)에 있음
2. GantryRob 좌표계가 복잡한 3D 회전
3. ROB_2가 GantryRob에 연동 안됨
4. 좌표 변환 관계가 불명확

**신 버전 (2025-12-18) 개선사항**:
1. ROB_2 위치를 원점 (0, 0, 0)으로 정리 ✅
2. GantryRob를 단순 90° Y축 회전으로 정의 ✅
3. ROB_2 방향을 새 좌표계에 맞게 조정 ✅
4. EXTCTL 불필요 유닛 제거 ✅
5. 전체 좌표계 관계가 명확해짐 ✅

**권장**: 신 버전 (2025-12-18) 사용하고, wobj0 및 좌표 변환 테스트 진행

---

작성일: 2025-12-18
분석 대상: MOC.cfg 설정 파일 비교
